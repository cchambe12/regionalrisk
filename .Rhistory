rm(list=ls())
options(stringsAsFactors = FALSE)
###### 4 March 2019 - need to finish adding 90 cred intervals to plots! ######
## Libraries
library(rstan)
library(brms)
library(ggplot2)
library(egg)
library(RColorBrewer)
library(sjmisc)
library(sjPlot)
library(ggeffects)
library(broom)
################################################################################
################################ MODEL OUTPUT ##################################
setwd("~/Documents/git/regionalrisk")
load("orig_full.Rstan")
load("orig_full.Rdata")
bernorig<-as.data.frame(tidy(orig.full,robust = TRUE, prob=0.9))
write.csv(bernorig, file="analyses/output/orig_full_modeloutput_90.csv", row.names = FALSE)
modoutput <- read.csv("output/orig_full_modeloutput_90.csv", header=TRUE)
setwd("/Users/CatherineChamberlain/Documents/git/regionalrisk/analyses/")
modoutput <- read.csv("output/orig_full_modeloutput_90.csv", header=TRUE)
View(modoutput)
View(modoutput)
modoutput <- modoutput[(modoutput[c(2:7,43:47),1]),]
View(modoutput)
modoutput <- read.csv("output/orig_full_modeloutput_90.csv", header=TRUE)
modoutput <- modoutput[(modoutput[1,c(2:7,43:47)]),]
modoutput <- modoutput[(modoutput[c(2:7,43:47),"term"]),]
View(modoutput)
modoutput <- read.csv("output/orig_full_modeloutput_90.csv", header=TRUE)
modoutput <- read.csv("output/orig_full_modeloutput_90.csv", header=TRUE)
modoutput <- modoutput[c(2:7,43:47),"term"]
modoutput
modoutput <- read.csv("output/orig_full_modeloutput_90.csv", header=TRUE)
modoutput <- modoutput[modoutput(c(2:7,43:47),"term"),]
modoutput <- modoutput[(modoutput[c(2:7,43:47),"term"]),]
View(modoutput)
modoutput <- modoutput[(modoutput[c(2:7,43:47), ]),]
modoutput <- read.csv("output/orig_full_modeloutput_90.csv", header=TRUE)
modoutput <- modoutput[(modoutput[c(2:7,43:47), ]),]
modoutput <- read.csv("output/orig_full_modeloutput_90.csv", header=TRUE)
modoutput <- modoutput[c(2:7,43:47),]
View(modoutput)
modoutput <- subset(modoutput, select=c("term", "estimate", "lower", "upper"))
colnames(modoutput) = c("Term", "Model Estimate", "10\\%", "90\\%")
rm(list=ls())
options(stringsAsFactors = FALSE)
## Libraries
library(rstan)
library(brms)
library(ggplot2)
library(egg)
library(RColorBrewer)
setwd("~/Documents/git/regionalrisk")
#load("orig_full.Rdata")
#load("dvr_full.Rdata")
load("five_full.Rdata")
#modoutput<-as.data.frame(tidy(orig.full ,robust = TRUE, prob=0.9))
#modoutput<-as.data.frame(tidy(dvr.full ,robust = TRUE, prob=0.9))
modoutput<-as.data.frame(tidy(five.full ,robust = TRUE, prob=0.5))
modoutput<-modoutput[2:47,]
modoutput$term<-gsub(".*b_","",modoutput$term)
modoutput<-modoutput[!(modoutput$term=="sd_species__nao.z" | modoutput$term=="sd_species__mat.z" | modoutput$term=="sd_species__elev.z"
| modoutput$term=="sd_species__dist.z" | modoutput$term=="sd_species__space.z" | modoutput$term=="sd_species__cc.z" | modoutput$term=="sigma"
| modoutput$term=="speciesALNGLU" | modoutput$term=="speciesBETPEN" | modoutput$term=="speciesFAGSYL"
| modoutput$term=="speciesFRAEXC" | modoutput$term=="speciesQUEROB"),]
modoutput$Jvar<-NA
modoutput$Jvar<-ifelse(modoutput$term=="nao.z", 8, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="mat.z", 11, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="elev.z", 9, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="dist.z", 10, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="space.z", 7, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="cc.z", 6, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="nao.z:cc.z", 2, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="mat.z:cc.z", 5, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="elev.z:cc.z", 3, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="dist.z:cc.z", 4, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="space.z:cc.z", 1, modoutput$Jvar)
modoutput$species<-as.character(modoutput$species)
estimates<-c("Mean Spring Temperature", "Distance from Coast", "Elevation", "NAO Index", "Space Parameter", "Climate Change",
"Mean Spring Temperature \nx Climate Change", "Distance from Coast \nx Climate Change",
"Elevation x \nClimate Change", "NAO Index x \nClimate Change", "Space Parameter \nx Climate Change")
estimates<-rev(estimates)
modoutput <- modoutput[!is.na(modoutput$Jvar),]
regrisk<-ggplot(modoutput, aes(x=lower, xend=upper, y=Jvar, yend=Jvar)) +
geom_vline(xintercept=0, linetype="dotted") + geom_point(aes(x=estimate, y=Jvar), col="black") +
geom_segment(arrow = arrow(length = unit(0.00, "npc"))) +
guides(size=FALSE) +
scale_y_discrete(limits = sort(unique(modoutput$term)), labels=estimates) +
xlab("Change in Number of False Springs") + ylab("") + theme_linedraw() +
theme(legend.text=element_text(size=5), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="sans"), legend.position = "none",
legend.text.align = 0) +  #+ ggtitle("Original Parameters") +
coord_cartesian(xlim=c(-1, 1), ylim=c(1,11)) #+ ggtitle("A.")
###### Need to mess around with how to order it all...
quartz()
regrisk
regrisk<-ggplot(modoutput, aes(x=lower, xend=upper, y=Jvar, yend=Jvar)) +
geom_vline(xintercept=0, linetype="dotted") + geom_point(aes(x=estimate, y=Jvar), col="black") +
geom_segment(arrow = arrow(length = unit(0.00, "npc"))) +
guides(size=FALSE) +
scale_y_discrete(limits = sort(unique(modoutput$term)), labels=estimates) +
xlab("Change in Number of False Springs") + ylab("") + theme_linedraw() +
theme(legend.text=element_text(size=5), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="sans"), legend.position = "none",
legend.text.align = 0) +  #+ ggtitle("Original Parameters") +
coord_cartesian(xlim=c(-1.2, 1.2), ylim=c(1,11)) #+ ggtitle("A.")
regrisk
#load("orig_full.Rdata")
load("dvr_full.Rdata")
#modoutput<-as.data.frame(tidy(orig.full ,robust = TRUE, prob=0.9))
modoutput<-as.data.frame(tidy(dvr.full ,robust = TRUE, prob=0.9))
modoutput<-modoutput[2:47,]
modoutput$term<-gsub(".*b_","",modoutput$term)
modoutput<-modoutput[!(modoutput$term=="sd_species__nao.z" | modoutput$term=="sd_species__mat.z" | modoutput$term=="sd_species__elev.z"
| modoutput$term=="sd_species__dist.z" | modoutput$term=="sd_species__space.z" | modoutput$term=="sd_species__cc.z" | modoutput$term=="sigma"
| modoutput$term=="speciesALNGLU" | modoutput$term=="speciesBETPEN" | modoutput$term=="speciesFAGSYL"
| modoutput$term=="speciesFRAEXC" | modoutput$term=="speciesQUEROB"),]
modoutput$Jvar<-NA
modoutput$Jvar<-ifelse(modoutput$term=="nao.z", 8, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="mat.z", 11, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="elev.z", 9, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="dist.z", 10, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="space.z", 7, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="cc.z", 6, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="nao.z:cc.z", 2, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="mat.z:cc.z", 5, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="elev.z:cc.z", 3, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="dist.z:cc.z", 4, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="space.z:cc.z", 1, modoutput$Jvar)
modoutput$species<-as.character(modoutput$species)
estimates<-c("Mean Spring Temperature", "Distance from Coast", "Elevation", "NAO Index", "Space Parameter", "Climate Change",
"Mean Spring Temperature \nx Climate Change", "Distance from Coast \nx Climate Change",
"Elevation x \nClimate Change", "NAO Index x \nClimate Change", "Space Parameter \nx Climate Change")
estimates<-rev(estimates)
modoutput <- modoutput[!is.na(modoutput$Jvar),]
regrisk<-ggplot(modoutput, aes(x=lower, xend=upper, y=Jvar, yend=Jvar)) +
geom_vline(xintercept=0, linetype="dotted") + geom_point(aes(x=estimate, y=Jvar), col="black") +
geom_segment(arrow = arrow(length = unit(0.00, "npc"))) +
guides(size=FALSE) +
scale_y_discrete(limits = sort(unique(modoutput$term)), labels=estimates) +
xlab("Change in Number of False Springs") + ylab("") + theme_linedraw() +
theme(legend.text=element_text(size=5), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="sans"), legend.position = "none",
legend.text.align = 0) +  #+ ggtitle("Original Parameters") +
coord_cartesian(xlim=c(-1.2, 1.2), ylim=c(1,11)) #+ ggtitle("A.")
###### Need to mess around with how to order it all...
quartz()
regrisk
#modoutput<-as.data.frame(tidy(orig.full ,robust = TRUE, prob=0.9))
#modoutput<-as.data.frame(tidy(dvr.full ,robust = TRUE, prob=0.9))
modoutput<-as.data.frame(tidy(five.full ,robust = TRUE, prob=0.9))
modoutput<-modoutput[2:47,]
modoutput$term<-gsub(".*b_","",modoutput$term)
modoutput<-modoutput[!(modoutput$term=="sd_species__nao.z" | modoutput$term=="sd_species__mat.z" | modoutput$term=="sd_species__elev.z"
| modoutput$term=="sd_species__dist.z" | modoutput$term=="sd_species__space.z" | modoutput$term=="sd_species__cc.z" | modoutput$term=="sigma"
| modoutput$term=="speciesALNGLU" | modoutput$term=="speciesBETPEN" | modoutput$term=="speciesFAGSYL"
| modoutput$term=="speciesFRAEXC" | modoutput$term=="speciesQUEROB"),]
modoutput$Jvar<-NA
modoutput$Jvar<-ifelse(modoutput$term=="nao.z", 8, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="mat.z", 11, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="elev.z", 9, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="dist.z", 10, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="space.z", 7, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="cc.z", 6, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="nao.z:cc.z", 2, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="mat.z:cc.z", 5, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="elev.z:cc.z", 3, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="dist.z:cc.z", 4, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$term=="space.z:cc.z", 1, modoutput$Jvar)
modoutput$species<-as.character(modoutput$species)
estimates<-c("Mean Spring Temperature", "Distance from Coast", "Elevation", "NAO Index", "Space Parameter", "Climate Change",
"Mean Spring Temperature \nx Climate Change", "Distance from Coast \nx Climate Change",
"Elevation x \nClimate Change", "NAO Index x \nClimate Change", "Space Parameter \nx Climate Change")
estimates<-rev(estimates)
modoutput <- modoutput[!is.na(modoutput$Jvar),]
regrisk<-ggplot(modoutput, aes(x=lower, xend=upper, y=Jvar, yend=Jvar)) +
geom_vline(xintercept=0, linetype="dotted") + geom_point(aes(x=estimate, y=Jvar), col="black") +
geom_segment(arrow = arrow(length = unit(0.00, "npc"))) +
guides(size=FALSE) +
scale_y_discrete(limits = sort(unique(modoutput$term)), labels=estimates) +
xlab("Change in Number of False Springs") + ylab("") + theme_linedraw() +
theme(legend.text=element_text(size=5), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="sans"), legend.position = "none",
legend.text.align = 0) +  #+ ggtitle("Original Parameters") +
coord_cartesian(xlim=c(-1.2, 1.2), ylim=c(1,11)) #+ ggtitle("A.")
###### Need to mess around with how to order it all...
quartz()
regrisk
setwd("/Users/CatherineChamberlain/Documents/git/regionalrisk/analyses/")
modoutput <- read.csv("output/orig_full_modeloutput_90.csv", header=TRUE)
modoutput <- modoutput[c(2:7,43:47),]
modoutput <- subset(modoutput, select=c("term", "estimate", "lower", "upper"))
colnames(modoutput) = c("Term", "Model Estimate", "10\\%", "90\\%")
modoutput <- gsub("b_nao.z", "NAO Index", modoutput$Term)
modoutput <- gsub("b_mat.z", "Mean Spring \nTemperature", modoutput$Term)
modoutput <- gsub("b_elev.z", "Elevation", modoutput$Term)
modoutput <- gsub("b_dist.z", "Distance from \nCoast", modoutput$Term)
-0.48+0.35+0.42
(exp(0.29)-1)*100
(exp(0.14)-1)*100
bb <- read.csv("analyses/output/fs_newspace_orig.csv", header=TRUE)
setwd("~/Documents/git/regionalrisk")
bb <- read.csv("analyses/output/fs_newspace_orig.csv", header=TRUE)
mean(bb$mst)
range(bb$mst)
(log((-0.48)/(1+0.48)))*5
(exp(-0.48)-1)*5
(exp(-0.48)-1)*10
(exp(-0.48)-1)*5*100
(exp(-0.48)-1)*10*100
(exp(-0.48)/(1+0.48))*5
(exp(-0.48)/(1+0.48))*10
4.180969-2.090484
((exp(-0.48)-1)*100*10)/((exp(-0.48)-1)*100*5)
((exp(-0.48)-1)*100*5)/((exp(-0.48)-1)*100*-5)
exp(log(-0.48/1+0.48)*9)/(exp(log(-0.48/1+-.48)*8)
)
exp(log(-0.48/1+0.48)*9)/exp(log(-0.48/1+0.48)*8)
exp(log(-0.48/1+0.48))*9/exp(log(-0.48/1+0.48))*8
exp(log(-0.48/1+0.48))
exp(log(-0.48/1+0.48))+0.48*9
exp(log(-0.48/1+0.48))+0.48*9/exp(log(-0.48/1+0.48))+0.48*8
log(-0.48/1+0.48))+0.48*9 - log(-0.48/1+0.48))+0.48*8
log(-0.48/1+0.48))+0.48*9 - log(-0.48/1+0.48)+0.48*8
log(-0.48/1+0.48)+0.48*9 - log(-0.48/1+0.48)+0.48*8
log(0.48/1+0.48)+0.48*9 - log(0.48/1+0.48)+0.48*8
exp(8.16)
exp(0.48/1+0.48)*9 - exp(0.48/1+0.48)*8
exp(0.48/1+0.48)*9/exp(0.48/1+0.48)*8
(exp(0.48/1+0.48)-0.48*9)/(exp(0.48/1+0.48)-0.48*8)
(exp(-0.48/1+0.48)-0.48*9)/(exp(-0.48/1+0.48)-0.48*8)
(exp(0.14/1-0.14)+0.14*9)/(exp(0.14/1-0.14)+0.14*8)
(exp(0.4/1-0.4)+0.4*9)/(exp(0.4/1-0.4)+0.4*8)
(exp(0.19/1-0.19)+0.19*9)/(exp(0.19/1-0.19)+0.19*8)
(exp(0.14/1-0.14)+0.14*1)/(exp(0.14/1-0.14)+0.14*0)
exp(-0.48/1+0.48)/exp(-0.48/1+0.48)
(exp(-0.48/1+0.48)-0.48*9) - (exp(-0.48/1+0.48)-0.48*8)
(log(-0.48/1+0.48)-0.48*9) - (log(-0.48/1+0.48)-0.48*8)
log(-2)
load("~/Documents/git/regionalrisk/orig_full.Rdata")
orig.full
exp((-0.88)-0.48*9)/exp((-0.88)-0.48*8)
1-0.6187834
1-(exp((-0.88)-0.48*9)/exp((-0.88)-0.48*8))
1-(exp((-0.88)+0.14*1)/exp((-0.88)+0.14*0))
1-(exp((-0.88)+0.4*700)/exp((-0.88)+0.4*200))
(1-(exp((-0.88)+0.4*1000)/exp((-0.88)+0.4*500))) * 100
(exp((-0.88)-0.48*9)/exp((-0.88)-0.48*8) - 1) * 100
(exp((-0.88)+0.14*1)/exp((-0.88)+0.14*0) - 1) * 100
(exp((-0.88)+0.4*1000)/exp((-0.88)+0.4*500) - 1) * 100
(exp((-0.88)+0.4*200)/exp((-0.88)+0.4*0) - 1) * 100
(exp((-0.88)+0.4*1)/exp((-0.88)+0.4*0) - 1) * 100
(exp((-0.88)-0.48*1)/exp((-0.88)-0.48*0) - 1) * 100
(exp(-0.48)-1)*100
(exp(0.14)-1)*100
(exp(0.4)-1)*100
(exp(0.19)-1)*100
(exp(0.35)-1)*100
(exp(0.35)-1)*(exp(-0.48)-1)/(exp(0.42)-1)
(exp(0.35)*exp(-0.48)/exp(0.42))-1
-0.48+0.35
-0.13/-0.48
(exp(0.2708)-1)*100
-0.48+0.42
-0.06/-0.48
(exp(0.125)-1)*100
intrxnfunction <- function(x,y) { (exp((x+y)/(x))-1)*100}
intrxnfunction(0.40, -0.12)
0.4-0.12
0.28/0.4
exp(0.7)-1
exp(-0.48) + exp(0.35) + exp(0.42)
exp(3.5598)
exp(-0.48)*exp(0.35) /exp(0.42)
exp(0.5769498)-1
(exp(0.42)-1)*100
intrxnfunction <- function(x,y) { (exp(exp(x+y)/exp(x))-1)*100}
intrxnfunction(-0.48,0.42)
exp(-0.48+0.42)
exp(-0.48)
0.9417645/0.6187834
exp(1.521961)
1.22/1.14
intrxnfunction <- function(x,y) { (exp(x+y)/exp(x))-1)*100}
intrxnfunction <- function(x,y) { ((exp(x+y)/exp(x))-1)*100}
intrxnfunction(-0.48,0.42)
intrxnfunction(0.4,-0.12)
intrxnfunction(0.14,-0.83)
exp(-0.48)/(1+exp(-0.48))
2 + mean(bb$mst)
1*2*sd(bb$mst, na.rm = TRUE) + mean(bb$mst, na.rm=TRUE)
1*2*sd(bb$nao, na.rm = TRUE) + mean(bb$nao, na.rm=TRUE)
1*2*sd(bb$elev, na.rm = TRUE) + mean(bb$elev, na.rm=TRUE)
1*2*sd(bb$distkm, na.rm = TRUE) + mean(bb$distkm, na.rm=TRUE)
1*2*sd(bb$distkm) + mean(bb$distkm)
1*sd(bb$distkm) + mean(bb$distkm)
