#scale_y_continuous(breaks = sort(c(seq(min(5), max(35), length.out=5), 13.2, 16.9))) +
scale_fill_manual(name="Species", values=cols,
labels=chill.bars4$code) +
scale_x_discrete(labels=c("ACESAC"="Acer saccharinum",
"ALNRUG"="Alnus rugosa",
"BETPAP"="Betula papyrifera",
"BETPOP"="Betula populifolia",
"CORRAC"="Cornus racemosa",
"SALPUR"="Salix purpurea",
"SORAME"="Sorbus americana",
"VIBDEN"="Viburnum dentatum")) +
scale_alpha_manual(name="", values=c(0.1, 1), labels=chill.bars8$tx) +
guides(fill=FALSE) +
ggtitle("C. Eight weeks chilling") + coord_cartesian(xlim=c(1, 8), ylim=ylim, expand=TRUE)
quartz()
dvrbarplot <- grid.arrange(dvrbar4, dvrbar6, dvrbar8, ncol=3, widths=c(1, 1, 1.3))
ggsave(paste("figures/",x,"_speciesplot.png",sep=""),width=30, height=12,units="cm",bg = "white",dpi=500, plot=dvrbarplot)
## 29 May 2019 - Cat
# Hoping to disentangle species differences between treatments
rm(list=ls()) # remove everything currently held in the R memory
options(stringsAsFactors=FALSE)
graphics.off()
# Load libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(gridExtra)
library(RColorBrewer)
# Set Working Directory
setwd("~/Documents/git/chillfreeze/analyses")
chillfrz <- read.csv("output/clean_dvr_traits.csv", header=TRUE)
rmspp <- c("NYSSYL", "FAGGRA")
chillfrz <- chillfrz[!(chillfrz$species%in%rmspp),]
##### Now for some bar plots with error bars, ordered by day of budburst #####
#### THINGS TO CHANGE BASED ON DIFFERENT TRAITS/RESPONSE VARIABLES!!!! #####
x <- "reltough" ## name for response ## ht.diff, dvr, tough
#mu <- expression(mu)
ylab <- "Leaf toughness (mN/leaf age(days))" # expression(paste("Leaf thickness (", mu, "m)", sep="")) ### y axis label
ylim <- c(0.5,7) ## c(-5,85) for rgr60, #c(5,30) for dvr, c(0.1,1) for tough, c(0.01,0.3) for thick
chillfrz$x <- chillfrz$reltough
if(x=="meristem"){
meri <- subset(chillfrz, select=c(id, chill, x, tx, species))
meri <- meri[!is.na(meri$x),]
meri <- within(meri, { meritot <- as.numeric(ave(id, species, tx, chill, FUN=length))}) # total number of inds per group
meridmg <- meri[(meri$x==1),]
meridmg$meridmg <- as.numeric(ave(meridmg$x, meridmg$species, meridmg$tx, meridmg$chill, FUN=length))# dmg meristem observations per group
meridmg <- dplyr::select(meridmg, -id, -x)
meri <- dplyr::select(meri, -id, -x)
meri <- left_join(meri, meridmg)
meri$meridmg <- ifelse(is.na(meri$meridmg), 0, meri$meridmg)
meri$meriprop <- meri$meridmg/meri$meritot
chillfrz <- left_join(chillfrz, meri)
chillfrz$x <- chillfrz$meriprop
}
############################################################################
dvrbar <- subset(chillfrz, select=c("species", "chill", "x", "tx", "budburst"))
dvrbar <- na.omit(dvrbar)
dvrbar <- dvrbar[!duplicated(dvrbar),]
dvrbar$tx <-ifelse(dvrbar$tx==0, "control", "treatment")
dvrbar$species.name <- NA
dvrbar$species.name <- ifelse(dvrbar$species=="ACESAC", "Acer saccharinum", dvrbar$species.name)
dvrbar$species.name <- ifelse(dvrbar$species=="ALNRUG", "Alnus rugosa", dvrbar$species.name)
dvrbar$species.name <- ifelse(dvrbar$species=="BETPAP", "Betula papyrifera", dvrbar$species.name)
dvrbar$species.name <- ifelse(dvrbar$species=="BETPOP", "Betula populifolia", dvrbar$species.name)
dvrbar$species.name <- ifelse(dvrbar$species=="CORRAC", "Cornus racemosa", dvrbar$species.name)
dvrbar$species.name <- ifelse(dvrbar$species=="SALPUR", "Salix purpurea", dvrbar$species.name)
dvrbar$species.name <- ifelse(dvrbar$species=="SORAME", "Sorbus americana", dvrbar$species.name)
dvrbar$species.name <- ifelse(dvrbar$species=="VIBDEN", "Viburnum dentatum", dvrbar$species.name)
dvrbar$code <- reorder(dvrbar$species, dvrbar$budburst)
chill.bars4 <- dvrbar[(dvrbar$chill==1),]
chill.bars6 <- dvrbar[(dvrbar$chill==2),]
chill.bars8 <- dvrbar[(dvrbar$chill==3),]
chill.bars4$dvrmean <- ave(chill.bars4$x, chill.bars4$tx, chill.bars4$species)
chill.bars4$dvrsd <- ave(chill.bars4$x, chill.bars4$tx, chill.bars4$species, FUN=sd)
chill.bars4$ymin <- chill.bars4$dvrmean-chill.bars4$dvrsd
chill.bars4$ymax <- chill.bars4$dvrmean+chill.bars4$dvrsd
#chill.bars4$meancont <- mean(chill.bars4[x && chill.bars4$tx=="control"]) # 0.44
#chill.bars4$meantx <- mean(chill.bars4$rgr_prebudset[chill.bars4$tx=="treatment"]) # 0.38
cols <- colorRampPalette(brewer.pal(8,"Dark2"))(8)
dvrbar4 <- ggplot(chill.bars4, aes(x=code, y=dvrmean, fill=code, alpha=tx)) +
geom_bar(stat="identity", position=position_dodge()) +
geom_errorbar(aes(ymin=ymin, ymax=ymax),width = 0.2, position=position_dodge(0.9)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
legend.position = "none",
axis.text.x = element_text(face = "italic", angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")) +
xlab("") +
ylab(ylab) +
scale_fill_manual(name="Species", values=cols,
labels=chill.bars4$code) +
#geom_hline(aes(yintercept = meancont), col="black", alpha=0.3, linetype="dashed") +
#geom_hline(aes(yintercept = meantx), col="black", alpha=1, linetype="dashed") +
#scale_y_continuous(breaks = sort(c(seq(min(5), max(35), by=5), 16.0, 18.8))) +
scale_x_discrete(labels=c("ACESAC"="Acer saccharinum",
"ALNRUG"="Alnus rugosa",
"BETPAP"="Betula papyrifera",
"BETPOP"="Betula populifolia",
"CORRAC"="Cornus racemosa",
"SALPUR"="Salix purpurea",
"SORAME"="Sorbus americana",
"VIBDEN"="Viburnum dentatum")) +
scale_alpha_manual(name="Treatments", values=c(0.1, 1), labels=chill.bars4$tx) +
guides(fill=FALSE) +
ggtitle("A. Four weeks chilling")  + coord_cartesian(xlim=c(1, 8), ylim=ylim, expand=TRUE)
chill.bars6$dvrmean <- ave(chill.bars6$x, chill.bars6$tx, chill.bars6$species)
chill.bars6$dvrsd <- ave(chill.bars6$x, chill.bars6$tx, chill.bars6$species, FUN=sd)
chill.bars6$ymin <- chill.bars6$dvrmean-chill.bars6$dvrsd
chill.bars6$ymax <- chill.bars6$dvrmean+chill.bars6$dvrsd
#chill.bars6$meancont <- mean(chill.bars6$rgr_prebudset[chill.bars6$tx=="control"]) #15.4
#chill.bars6$meantx <- mean(chill.bars6$rgr_prebudset[chill.bars6$tx=="treatment"]) #17.5
dvrbar6 <- ggplot(chill.bars6, aes(x=code, y=dvrmean, fill=code, alpha=tx)) +
geom_bar(stat="identity", position=position_dodge()) +
geom_errorbar(aes(ymin=ymin, ymax=ymax),width = 0.2, position=position_dodge(0.9)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
legend.position = "none",
axis.text.x = element_text(face = "italic", angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")#,
#axis.title.y = element_blank(),
#axis.text.y = element_blank(),
#axis.ticks.y = element_blank()
) +
xlab("") +
ylab(ylab) +
#geom_hline(aes(yintercept = meancont), col="black", alpha=0.3, linetype="dashed") +
#geom_hline(aes(yintercept = meantx), col="black", alpha=1, linetype="dashed") +
#scale_y_continuous(breaks = sort(c(seq(min(5), max(35), length.out=5), 15.4, 17.5))) +
scale_fill_manual(name="Species", values=cols,
labels=chill.bars4$code) +
scale_x_discrete(labels=c("ACESAC"="Acer saccharinum",
"ALNRUG"="Alnus rugosa",
"BETPAP"="Betula papyrifera",
"BETPOP"="Betula populifolia",
"CORRAC"="Cornus racemosa",
"SALPUR"="Salix purpurea",
"SORAME"="Sorbus americana",
"VIBDEN"="Viburnum dentatum")) +
scale_alpha_manual(name="Treatments", values=c(0.1, 1), labels=chill.bars6$tx) +
guides(fill=FALSE) +
ggtitle("B. Six weeks chilling") + coord_cartesian(xlim=c(1, 8), ylim=ylim, expand=TRUE)
chill.bars8$dvrmean <- ave(chill.bars8$x, chill.bars8$tx, chill.bars8$species)
chill.bars8$dvrsd <- ave(chill.bars8$x, chill.bars8$tx, chill.bars8$species, FUN=sd)
chill.bars8$ymin <- chill.bars8$dvrmean-chill.bars8$dvrsd
chill.bars8$ymax <- chill.bars8$dvrmean+chill.bars8$dvrsd
#chill.bars8$meancont <- mean(chill.bars8$rgr_prebudset[chill.bars8$tx=="control"]) #13.2
#chill.bars8$meantx <- mean(chill.bars8$rgr_prebudset[chill.bars8$tx=="treatment"]) #16.9
dvrbar8 <- ggplot(chill.bars8, aes(x=code, y=dvrmean, fill=code, alpha=tx)) +
geom_bar(stat="identity", position=position_dodge()) +
geom_errorbar(aes(ymin=ymin, ymax=ymax),width = 0.2, position=position_dodge(0.9)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
#legend.position = "none",
axis.text.x = element_text(face = "italic", angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")#,
#axis.title.y = element_blank(),
#axis.text.y = element_blank(),
#axis.ticks.y = element_blank()
) +
xlab("") +
ylab(ylab) +
#geom_hline(aes(yintercept = meancont), col="black", alpha=0.3, linetype="dashed") +
#geom_hline(aes(yintercept = meantx), col="black", alpha=1, linetype="dashed") +
#scale_y_continuous(breaks = sort(c(seq(min(5), max(35), length.out=5), 13.2, 16.9))) +
scale_fill_manual(name="Species", values=cols,
labels=chill.bars4$code) +
scale_x_discrete(labels=c("ACESAC"="Acer saccharinum",
"ALNRUG"="Alnus rugosa",
"BETPAP"="Betula papyrifera",
"BETPOP"="Betula populifolia",
"CORRAC"="Cornus racemosa",
"SALPUR"="Salix purpurea",
"SORAME"="Sorbus americana",
"VIBDEN"="Viburnum dentatum")) +
scale_alpha_manual(name="", values=c(0.1, 1), labels=chill.bars8$tx) +
guides(fill=FALSE) +
ggtitle("C. Eight weeks chilling") + coord_cartesian(xlim=c(1, 8), ylim=ylim, expand=TRUE)
quartz()
dvrbarplot <- grid.arrange(dvrbar4, dvrbar6, dvrbar8, ncol=3, widths=c(1, 1, 1.3))
ggsave(paste("figures/",x,"_speciesplot.png",sep=""),width=30, height=12,units="cm",bg = "white",dpi=500, plot=dvrbarplot)
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(dplyr)
library(lubridate)
library(tidyr)
library(RColorBrewer)
library(egg)
library(brms) ## just for initial glances during experiment!
library(rstan)
# Setting working directory
setwd("~/Documents/git/chillfreeze/analyses/input")
obs <- read.csv("chillobs.csv", header = TRUE)
## Start cleaning a bit...
obs$bb <- as.Date(obs$bb, "%m/%d/%y")
obs$bb <- yday(obs$bb)
obs$lo <- as.Date(obs$lo, "%m/%d/%y")
obs$lo <- yday(obs$lo)
obs$start <- as.Date(obs$start, format = "%m/%d/%y")
obs$budburst <- NA
obs$budburst <- ifelse(obs$start=="2018-12-24", obs$bb + 6, obs$budburst)
obs$budburst <- ifelse(obs$start=="2019-01-07", obs$bb - 7, obs$budburst)
obs$budburst <- ifelse(obs$start=="2019-01-21", obs$bb - 21, obs$budburst)
obs$leafout <- NA
obs$leafout <- ifelse(obs$start=="2018-12-24", obs$lo + 6, obs$leafout)
obs$leafout <- ifelse(obs$start=="2019-01-07", obs$lo - 7, obs$leafout)
obs$leafout <- ifelse(obs$start=="2019-01-21", obs$lo - 21, obs$leafout)
treats <- c(24, 44, 64, 84, 104, 124, 144, 164,
26, 46, 66, 86, 106, 126, 146, 166,
28, 48, 68, 88, 108, 128, 148, 168)
obs$inds <- substr(obs$id, 8, 10)
obs$tx <- ifelse(obs$inds %in% treats, 1, 0)
obs$chill <- NA
obs$chill <- ifelse(obs$start=="2018-12-24", 1, obs$chill)
obs$chill <- ifelse(obs$start=="2019-01-07", 2, obs$chill)
obs$chill <- ifelse(obs$start=="2019-01-21", 3, obs$chill)
obs$ht2 <- as.Date(obs$leafout + 28, origin = obs$start)
obs$ht.mid <- as.Date(obs$leafout + 60, origin = obs$start)
#whentomeasure <- subset(obs, select=c("id", "ht.mid"))
#whentomeasure <- whentomeasure[!duplicated(whentomeasure),]
#write.csv(whentomeasure, file="~/Desktop/whentomeasureheights.csv", row.names = FALSE)
## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ##
## Breakdown treatments and experiment - 19 February 2019 issues with greenhouse!
if(FALSE){
howfaralong <- obs
howfaralong$chilltx <- NA
howfaralong$chilltx <- ifelse(howfaralong$chill==1, "4wks", howfaralong$chilltx)
howfaralong$chilltx <- ifelse(howfaralong$chill==2, "6wks", howfaralong$chilltx)
howfaralong$chilltx <- ifelse(howfaralong$chill==3, "8wks", howfaralong$chilltx)
howfaralong$chilltx <- paste(howfaralong$chilltx, howfaralong$tx, sep="_")
howfaralong.leafout <- howfaralong[!is.na(howfaralong$lo),]
table(howfaralong.leafout$chilltx)
howfaralong.budburst <- howfaralong[is.na(howfaralong$lo) & !is.na(howfaralong$bb),]
table(howfaralong.budburst$chilltx)
howfaralong.frz <- howfaralong[(howfaralong$tx ==1 & howfaralong$frz!=""),]
table(howfaralong.frz$chilltx)
}
## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ##
## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ##
chill.stan <- subset(obs, select=c("id", "budburst", "leafout", "tx", "chill", "lo.ht", "thick1", "thick2", "tough1", "tough2",
"budset", "shoots", "roots", "ht.final", "mg.cm2", "phenol", "chlavg",
"ht.diff", "meristem", "ht.prebudset"))
chill.stan$chill1 = ifelse(chill.stan$chill == 2, 1, 0)
chill.stan$chill2 = ifelse(chill.stan$chill == 3, 1, 0)
with(chill.stan, table(chill1, chill2))
chill.stan$species <- substr(chill.stan$id, 0, 6)
chill.stan$dvr <- chill.stan$leafout - chill.stan$budburst ### Using this point of code for "drought" effect test
#chill.stan$ht.diff <- chill.stan$X60dayheight - chill.stan$lo.ht
#chill.stan$chlavg <- apply(chill.stan[,8:11], 1, mean)
chill.stan$tough <- ifelse(!is.na(chill.stan$tough2), (chill.stan$tough1 + chill.stan$tough2)/2, chill.stan$tough1)
chill.stan$thick <- (chill.stan$thick1 + chill.stan$thick2)/2
chill.stan$tough.date <- NA
chill.stan$tough.date <- ifelse(chill.stan$chill==1, (170+6), chill.stan$tough.date)
chill.stan$tough.date <- ifelse(chill.stan$chill==2, (184-7), chill.stan$tough.date)
chill.stan$tough.date <- ifelse(chill.stan$chill==3, (184-21), chill.stan$tough.date)
chill.stan$tough.age <- chill.stan$tough.date - chill.stan$lo
chill.stan$reltough <- (chill.stan$tough/chill.stan$tough.age)*1000
chill.stan$ht.late <- chill.stan$ht.prebudset - chill.stan$lo.ht
chill.stan$ht.date.new <- NA
chill.stan$ht.date.new <- ifelse(chill.stan$chill==1, (chill.stan$ht.date+6), chill.stan$tough.date)
chill.stan$ht.date.new <- ifelse(chill.stan$chill==2, (chill.stan$ht.date-7), chill.stan$tough.date)
chill.stan$ht.date.new <- ifelse(chill.stan$chill==3, (chill.stan$ht.date-21), chill.stan$tough.date)
chill.stan$budset <- as.Date(chill.stan$budset, "%m/%d/%y")
chill.stan$bset <- yday(chill.stan$budset)
chill.stan$budsetdoy <- NA
chill.stan$budsetdoy <- ifelse(chill.stan$chill==1, (chill.stan$budsetdoy+6), chill.stan$bset)
chill.stan$budsetdoy <- ifelse(chill.stan$chill==2, (chill.stan$budsetdoy-7), chill.stan$bset)
chill.stan$budsetdoy <- ifelse(chill.stan$chill==3, (chill.stan$budsetdoy-21), chill.stan$bset)
chill.stan$gslength <- chill.stan$budsetdoy - chill.stan$lo
chill.stan$rgr_prebudset <- (chill.stan$ht.prebudset - chill.stan$lo.ht)/(chill.stan$ht.date.new - chill.stan$leafout)*100
chill.stan$rgr_final <- (chill.stan$ht.final - chill.stan$lo.ht)/(chill.stan$gslength)*100
source("..//standardcurve.R")
chill.stan$folin <- folinfunc(as.numeric(chill.stan$phenol))
write.csv(chill.stan, file="~/Documents/git/chillfreeze/analyses/output/clean_dvr_traits.csv", row.names=FALSE)
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(bayesplot) ## for plotting
library(egg) ## for plotting
library(shinystan)
library(rstanarm)
library(rstan)
library(brms)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
# Set working directory
setwd("~/Documents/git/chillfreeze/analyses")
source('source/stan_utility.R')
#chill.stan <- read.csv("output/clean_dvr_60dayoutput.csv", header=TRUE)
#chill.stan <- read.csv("output/fakedata_height.csv", header=TRUE)
chill.stan <- read.csv("output/clean_dvr_traits.csv")
#chill.stan <- read.csv("output/clean_dvr_drought.csv")
chill.stan <- chill.stan[!is.na(chill.stan$gslength),]
#chill.stan <- read.csv("output/clean_dvr_60dayoutput.csv", header=TRUE)
#chill.stan <- read.csv("output/fakedata_height.csv", header=TRUE)
chill.stan <- read.csv("output/clean_dvr_traits.csv")
chill.stan <- chill.stan[!is.na(chill.stan$tough),]
114/375
375-114
375-151
151/375
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(dplyr)
library(lubridate)
library(tidyr)
library(RColorBrewer)
library(egg)
library(brms) ## just for initial glances during experiment!
library(rstan)
# Setting working directory
setwd("~/Documents/git/chillfreeze/analyses/input")
obs <- read.csv("chillobs.csv", header = TRUE)
## Start cleaning a bit...
obs$bb <- as.Date(obs$bb, "%m/%d/%y")
obs$bb <- yday(obs$bb)
obs$lo <- as.Date(obs$lo, "%m/%d/%y")
obs$lo <- yday(obs$lo)
obs$start <- as.Date(obs$start, format = "%m/%d/%y")
obs$budburst <- NA
obs$budburst <- ifelse(obs$start=="2018-12-24", obs$bb + 6, obs$budburst)
obs$budburst <- ifelse(obs$start=="2019-01-07", obs$bb - 7, obs$budburst)
obs$budburst <- ifelse(obs$start=="2019-01-21", obs$bb - 21, obs$budburst)
obs$leafout <- NA
obs$leafout <- ifelse(obs$start=="2018-12-24", obs$lo + 6, obs$leafout)
obs$leafout <- ifelse(obs$start=="2019-01-07", obs$lo - 7, obs$leafout)
obs$leafout <- ifelse(obs$start=="2019-01-21", obs$lo - 21, obs$leafout)
treats <- c(24, 44, 64, 84, 104, 124, 144, 164,
26, 46, 66, 86, 106, 126, 146, 166,
28, 48, 68, 88, 108, 128, 148, 168)
obs$inds <- substr(obs$id, 8, 10)
obs$tx <- ifelse(obs$inds %in% treats, 1, 0)
obs$chill <- NA
obs$chill <- ifelse(obs$start=="2018-12-24", 1, obs$chill)
obs$chill <- ifelse(obs$start=="2019-01-07", 2, obs$chill)
obs$chill <- ifelse(obs$start=="2019-01-21", 3, obs$chill)
obs$ht2 <- as.Date(obs$leafout + 28, origin = obs$start)
obs$ht.mid <- as.Date(obs$leafout + 60, origin = obs$start)
#whentomeasure <- subset(obs, select=c("id", "ht.mid"))
#whentomeasure <- whentomeasure[!duplicated(whentomeasure),]
#write.csv(whentomeasure, file="~/Desktop/whentomeasureheights.csv", row.names = FALSE)
## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ##
## Breakdown treatments and experiment - 19 February 2019 issues with greenhouse!
if(FALSE){
howfaralong <- obs
howfaralong$chilltx <- NA
howfaralong$chilltx <- ifelse(howfaralong$chill==1, "4wks", howfaralong$chilltx)
howfaralong$chilltx <- ifelse(howfaralong$chill==2, "6wks", howfaralong$chilltx)
howfaralong$chilltx <- ifelse(howfaralong$chill==3, "8wks", howfaralong$chilltx)
howfaralong$chilltx <- paste(howfaralong$chilltx, howfaralong$tx, sep="_")
howfaralong.leafout <- howfaralong[!is.na(howfaralong$lo),]
table(howfaralong.leafout$chilltx)
howfaralong.budburst <- howfaralong[is.na(howfaralong$lo) & !is.na(howfaralong$bb),]
table(howfaralong.budburst$chilltx)
howfaralong.frz <- howfaralong[(howfaralong$tx ==1 & howfaralong$frz!=""),]
table(howfaralong.frz$chilltx)
}
## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ##
## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ##
chill.stan <- subset(obs, select=c("id", "budburst", "leafout", "tx", "chill", "lo.ht", "thick1", "thick2", "tough1", "tough2",
"budset", "shoots", "roots", "ht.final", "mg.cm2", "phenol", "chlavg",
"ht.diff", "meristem", "ht.prebudset"))
chill.stan$chill1 = ifelse(chill.stan$chill == 2, 1, 0)
chill.stan$chill2 = ifelse(chill.stan$chill == 3, 1, 0)
with(chill.stan, table(chill1, chill2))
chill.stan$species <- substr(chill.stan$id, 0, 6)
chill.stan$dvr <- chill.stan$leafout - chill.stan$budburst ### Using this point of code for "drought" effect test
#chill.stan$ht.diff <- chill.stan$X60dayheight - chill.stan$lo.ht
#chill.stan$chlavg <- apply(chill.stan[,8:11], 1, mean)
chill.stan$tough <- ifelse(!is.na(chill.stan$tough2), (chill.stan$tough1 + chill.stan$tough2)/2, chill.stan$tough1)
chill.stan$thick <- (chill.stan$thick1 + chill.stan$thick2)/2
chill.stan$tough.date <- NA
chill.stan$tough.date <- ifelse(chill.stan$chill==1, (170+6), chill.stan$tough.date)
chill.stan$tough.date <- ifelse(chill.stan$chill==2, (184-7), chill.stan$tough.date)
chill.stan$tough.date <- ifelse(chill.stan$chill==3, (184-21), chill.stan$tough.date)
chill.stan$tough.age <- chill.stan$tough.date - chill.stan$lo
chill.stan$reltough <- (chill.stan$tough/chill.stan$tough.age)*1000
chill.stan$ht.late <- chill.stan$ht.prebudset - chill.stan$lo.ht
chill.stan$ht.date.new <- NA
chill.stan$ht.date.new <- ifelse(chill.stan$chill==1, (chill.stan$ht.date+6), chill.stan$tough.date)
chill.stan$ht.date.new <- ifelse(chill.stan$chill==2, (chill.stan$ht.date-7), chill.stan$tough.date)
chill.stan$ht.date.new <- ifelse(chill.stan$chill==3, (chill.stan$ht.date-21), chill.stan$tough.date)
chill.stan$budset <- as.Date(chill.stan$budset, "%m/%d/%y")
chill.stan$bset <- yday(chill.stan$budset)
chill.stan$budsetdoy <- NA
chill.stan$budsetdoy <- ifelse(chill.stan$chill==1, (chill.stan$budsetdoy+6), chill.stan$bset)
chill.stan$budsetdoy <- ifelse(chill.stan$chill==2, (chill.stan$budsetdoy-7), chill.stan$bset)
chill.stan$budsetdoy <- ifelse(chill.stan$chill==3, (chill.stan$budsetdoy-21), chill.stan$bset)
chill.stan$gslength <- chill.stan$budsetdoy - chill.stan$lo
chill.stan$rgr_prebudset <- (chill.stan$ht.prebudset - chill.stan$lo.ht)/(chill.stan$ht.date.new - chill.stan$leafout)*100
chill.stan$rgr_final <- (chill.stan$ht.final - chill.stan$lo.ht)/(chill.stan$gslength)*100
source("..//standardcurve.R")
chill.stan$folin <- folinfunc(as.numeric(chill.stan$phenol))
write.csv(chill.stan, file="~/Documents/git/chillfreeze/analyses/output/clean_dvr_traits.csv", row.names=FALSE)
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(bayesplot) ## for plotting
library(egg) ## for plotting
library(shinystan)
library(rstanarm)
library(rstan)
library(brms)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
# Set working directory
setwd("~/Documents/git/chillfreeze/analyses")
source('source/stan_utility.R')
#chill.stan <- read.csv("output/clean_dvr_60dayoutput.csv", header=TRUE)
#chill.stan <- read.csv("output/fakedata_height.csv", header=TRUE)
chill.stan <- read.csv("output/clean_dvr_traits.csv")
chill.stan <- chill.stan[!is.na(chill.stan$gslength),]
mod <- brm(gslength~tx, data=chill.stan)
mod
#chill.stan <- read.csv("output/clean_dvr_60dayoutput.csv", header=TRUE)
#chill.stan <- read.csv("output/fakedata_height.csv", header=TRUE)
chill.stan <- read.csv("output/clean_dvr_traits.csv")
chill.stan <- chill.stan[!is.na(chill.stan$ht.final),]
chill.stan$finalht.diff <- (chill.stan$ht.final-chill.stan$lo.ht)/chill.stan$gslength
mod2 <- brm(finalht.diff~tx, data=chill.stan)
mod2
chill.stan$finalht.diff <- ((log(chill.stan$ht.final)-log(chill.stan$lo.ht))/chill.stan$gslength)
range(chill.stan$finalht.diff, na.rm = TRUE)
chill.stan$finalht.diff <- ((log(chill.stan$ht.final)-log(chill.stan$lo.ht))/chill.stan$gslength) *100
range(chill.stan$finalht.diff, na.rm = TRUE)
chill.stan$finalht.diff <- ((log(chill.stan$ht.final)-log(chill.stan$lo.ht))/chill.stan$gslength) *1000
range(chill.stan$finalht.diff, na.rm = TRUE)
mod2 <- brm(finalht.diff~tx, data=chill.stan)
mod2
#chill.stan <- chill.stan[!is.na(chill.stan$gslength),]
chill.stan$roottoshoot <- chill.stan$roots/chill.stan$shoots
mod3 <- brm(roots~tx, data=chill.stan)
mod3
mod4 <- brm(shoots~tx, data=chill.stan)
mod4
mod5 <- brm(roottoshoot~tx, data=chill.stan)
mod5
(0.19/4)
(mean(fixef(orig.full, pars="elev.z", summary=FALSE))/4)
## housekeeping
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(brms)
## Set Working Directory
setwd("~/Documents/git/regionalrisk")
load("orig_full.Rdata")
fs <- read.csv("analyses/output/fs_newspace_orig.csv", header=TRUE)
#### Using Gelman-Hill method
invlogit <- function(x) {(1/(1+exp(-(x))))}
(mean(fixef(orig.full, pars="elev.z", summary=FALSE))/4)
(0.19/4)
(0.19/4)/(sd(fs$elev)*2)
(0.19/4)/(sd(fs$elev)*2)*100*200 ## -11.1 ELEVxCC ?
(0.28/4)/(sd(fs$distkm)*2)*100*150 ## 0.02 DISTxCC ?
(-0.06/4)/(sd(fs$mat)*2)*100*2 ## -1.5 MATxCC ?
### Okay now, we can calculate the interaction effects:
(-0.69/4)/(sd(fs$nao)*2)*100*0.3 ## -30.8 NAOxCC ?
(mean(fixef(orig.full, pars="nao.z", summary=FALSE)+mean(fixef(orig.full, pars="nao.z:cc.z", summary=FALSE)))/4)/(sd(fs$nao)*2)*100*0.3
(mean(fixef(orig.full, pars="mat.z", summary=FALSE)+mean(fixef(orig.full, pars="mat.z:cc.z", summary=FALSE)))/4)/(sd(fs$mat)*2)*100*2
(mean(fixef(orig.full, pars="dist.z", summary=FALSE)+mean(fixef(orig.full, pars="dist.z:cc.z", summary=FALSE)))/4)/(sd(fs$distkm)*2)*100*150
(mean(fixef(orig.full, pars="elev.z", summary=FALSE)+mean(fixef(orig.full, pars="elev.z:cc.z", summary=FALSE)))/4)/(sd(fs$elev)*2)*100*200
load("bbmod.Rdata")
simpbb <- mean(fixef(bb.mod, pars="cc.z"), summary=FALSE)
bb.mod
load("tmin.Rdata")
load("tminmod.Rdata")
load("fssimpmod.Rdata")
alnccz <- round((mean(fixef(orig.full, pars="cc.z", summary=FALSE))+mean(fixef(orig.full, pars="speciesALNGLU", summary=FALSE))), digits=2)
alnccz
betccz <- round((mean(fixef(orig.full, pars="cc.z", summary=FALSE))+mean(fixef(orig.full, pars="speciesBETPEN", summary=FALSE))), digits=2)
betccz
fagccz <- round((mean(fixef(orig.full, pars="cc.z", summary=FALSE))+mean(fixef(orig.full, pars="speciesFAGSYL", summary=FALSE))), digits=2)
fagccz
fraccz <- round((mean(fixef(orig.full, pars="cc.z", summary=FALSE))+mean(fixef(orig.full, pars="speciesFRAEXC", summary=FALSE))), digits=2)
fraccz
queccz <- round((mean(fixef(orig.full, pars="cc.z", summary=FALSE))+mean(fixef(orig.full, pars="speciesQUEROB", summary=FALSE))), digits=2)
queccz
fagccz <- round((mean(fixef(orig.full, pars="cc.z", summary=FALSE))+mean(fixef(orig.full, pars="speciesFAGSYL", summary=FALSE))), digits=4)
fagccz
fagccz <- round((mean(fixef(orig.full, pars="cc.z", summary=FALSE))+mean(fixef(orig.full, pars="speciesFAGSYL", summary=FALSE))), digits=3)
fagccz
rm(list=ls())
options(stringsAsFactors = FALSE)
## Set Working Directory
setwd("~/Documents/git/regionalrisk")
fs <- read.csv("analyses/output/fs_newspace_orig.csv", header=TRUE)
fs$spp <- as.numeric(as.factor(fs$species))
species <- unique(fs$species)
### alright now let's go through the predictors...
quartz() ## MST
par(mfrow=c(2,3))
for(i in 1:length(species)){
hist(fs$mst[(fs$spp==i)], xlim=c(-7, 17))
}
quartz() ## Distance
par(mfrow=c(2,3))
for(i in 1:length(species)){
hist(fs$distkm[(fs$spp==i)], xlim=c(0, 720))
}
quartz() ## Elev
par(mfrow=c(2,3))
for(i in 1:length(species)){
hist(fs$elev[(fs$spp==i)], xlim=c(0, 1900))
}
quartz() ## NAO
par(mfrow=c(2,3))
for(i in 1:length(species)){
hist(fs$nao[(fs$spp==i)], xlim=c(-0.6, 0.7))
}
### No glaring differences...
