scale_alpha_manual(name="Climate Change", values=c(0.2, 0.7),
labels=c("0"="1951-1983", "1"="1984-2016")) +
geom_point(aes(x=as.factor(species), alpha=as.factor(cc), y=est, group=cc,
col=as.factor(cc)),
position = position_dodge(width=0.75), size=1) +
geom_linerange(aes(x=as.factor(species), alpha=as.factor(cc), ymin=lower, ymax=upper, group=cc,
col=as.factor(cc)), position = position_dodge(width=0.75)) +
ggtitle("(b)") +
guides(alpha=guide_legend(override.aes=list(fill=hcl(c(15,195),100,0,alpha=c(0.2,0.7)))), col=FALSE, fill=FALSE)
load("~/Documents/git/regionalrisk/fstotmodlong.Rdata")
fsccsp<- ggpredict(fstotlong.mod, terms = c("cc", "species"), ci.lvl=0.98)
fsccsp$group <- as.character(fsccsp$group)
fsccsp$species <- NA
fsccsp$species<-ifelse(fsccsp$group=="BETPEN", "aaBETPEN", fsccsp$group)
fsccsp$species<-ifelse(fsccsp$group=="FRAEXC", "zFRAEXC", fsccsp$species)
f<-read.csv("output/fs_newspace_long.csv", header=TRUE)
#f$cc<-ifelse(f$year<1980, 0, 1)
f$species<-ifelse(f$species=="BETPEN", "aaBETPEN", f$species)
f$species<-ifelse(f$species=="FRAEXC", "zFRAEXC", f$species)
f<-f[!is.na(f$fs),]
#f$fsall<-ave(f$fs, f$lat.long, f$species, FUN=sum)
f$fstot<-ave(f$fs, f$lat.long, f$species, f$cc, FUN=sum)
fsccsp$est.conv <-  (fsccsp$predicted/4)/(2)
fsccsp$low.conv <-  (fsccsp$conf.low/4)/(2)
fsccsp$up.conv <-  (fsccsp$conf.high/4)/(2)
fsccsp$x <- ifelse(fsccsp$x<=0, 0, 1)
fsccsp<-subset(fsccsp, select=c("x", "predicted", "conf.low", "conf.high","species", "est.conv", "low.conv", "up.conv")) #
colnames(fsccsp) <- c("cc", "est", "lower", "upper",  "species","est.conv", "low.conv", "up.conv") # ,
plusf<-subset(f, select=c(species, cc, fstot))
plusf<-plusf[!duplicated(plusf),]
plusf <- full_join(plusf, fsccsp)
cols <-viridis_pal(option="viridis")(6)
falsespring<- ggplot(plusf, aes(x=species,alpha=cc, y=fstot)) + geom_boxplot(aes(alpha=as.factor(cc), fill=as.factor(species), col=as.factor(species)), outlier.shape=NA) +
scale_fill_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
scale_color_manual(name="Species", values=c("grey48","black", cols),
labels=c("0"="1951-1983", "1"="1984-2016",
"aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
theme(legend.text=element_text(size=7), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="Helvetica"),
plot.title = element_text(face="bold"),
legend.text.align = 0, axis.text.x = element_text(face = "italic", angle=35, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white"), legend.position = "none",
plot.margin = unit(c(1.5,1.5, 1.0, 1.5), "lines"),
axis.title.x = element_blank()) +
#axis.text.x.bottom = element_blank(), axis.ticks.x = element_blank()) + # top, right, bottom, left
scale_y_continuous(expand = c(0, 0)) +
scale_x_discrete(labels=c("aaBETPEN" = "Betula pendula", "AESHIP" = "Aesculus \nhippocastanum",
"ALNGLU" = "Alnus glutinosa", "FAGSYL"="Fagus sylvatica",
"QUEROB"="Quercus robur", "zFRAEXC"="Fraxinus \nexcelsior")) +
ylab("Number of false springs") + #coord_cartesian(ylim=c(0, 33)) +
#geom_hline(yintercept=7.66, linetype="dotted", col="black") +
#annotate("text", x = 5.75, y = 245, label = "Before 1984", family="Helvetica", size=3, fontface="bold") +
scale_alpha_manual(name="Climate Change", values=c(0.2, 0.7),
labels=c("0"="1951-1983", "1"="1984-2016")) +
geom_point(aes(x=as.factor(species), alpha=as.factor(cc), y=est, group=cc,
col=as.factor(cc)),
position = position_dodge(width=0.75), size=1) +
geom_linerange(aes(x=as.factor(species), alpha=as.factor(cc), ymin=lower, ymax=upper, group=cc,
col=as.factor(cc)), position = position_dodge(width=0.75)) +
ggtitle("(c)") +
guides(alpha=guide_legend(override.aes=list(fill=hcl(c(15,195),100,0,alpha=c(0.2,0.7)))), col=FALSE, fill=FALSE)
falsespring<- ggplot(plusf, aes(x=species,alpha=cc, y=fstot)) + geom_boxplot(aes(alpha=as.factor(cc), fill=as.factor(species), col=as.factor(species)), outlier.shape=NA) +
scale_fill_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
scale_color_manual(name="Species", values=c("grey48","black", cols),
labels=c("0"="1951-1983", "1"="1984-2016",
"aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
theme(legend.text=element_text(size=7), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="Helvetica"),
plot.title = element_text(face="bold"),
legend.text.align = 0, axis.text.x = element_text(face = "italic", angle=35, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white"), #legend.position = "none",
plot.margin = unit(c(1.5,1.5, 1.0, 1.5), "lines"),
axis.title.x = element_blank()) +
#axis.text.x.bottom = element_blank(), axis.ticks.x = element_blank()) + # top, right, bottom, left
scale_y_continuous(expand = c(0, 0)) +
scale_x_discrete(labels=c("aaBETPEN" = "Betula pendula", "AESHIP" = "Aesculus \nhippocastanum",
"ALNGLU" = "Alnus glutinosa", "FAGSYL"="Fagus sylvatica",
"QUEROB"="Quercus robur", "zFRAEXC"="Fraxinus \nexcelsior")) +
ylab("Number of false springs") + #coord_cartesian(ylim=c(0, 33)) +
#geom_hline(yintercept=7.66, linetype="dotted", col="black") +
#annotate("text", x = 5.75, y = 245, label = "Before 1984", family="Helvetica", size=3, fontface="bold") +
scale_alpha_manual(name="Climate Change", values=c(0.2, 0.7),
labels=c("0"="1951-1983", "1"="1984-2016")) +
geom_point(aes(x=as.factor(species), alpha=as.factor(cc), y=est, group=cc,
col=as.factor(cc)),
position = position_dodge(width=0.75), size=1) +
geom_linerange(aes(x=as.factor(species), alpha=as.factor(cc), ymin=lower, ymax=upper, group=cc,
col=as.factor(cc)), position = position_dodge(width=0.75)) +
ggtitle("(c)") +
guides(alpha=guide_legend(override.aes=list(fill=hcl(c(15,195),100,0,alpha=c(0.2,0.7)))), col=FALSE, fill=FALSE)
g_legend<-function(a.gplot){
tmp <- ggplot_gtable(ggplot_build(a.gplot))
leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
legend <- tmp$grobs[[leg]]
return(legend)}
mylegend<-g_legend(falsespring)
falsespring<- ggplot(plusf, aes(x=species,alpha=cc, y=fstot)) + geom_boxplot(aes(alpha=as.factor(cc), fill=as.factor(species), col=as.factor(species)), outlier.shape=NA) +
scale_fill_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
scale_color_manual(name="Species", values=c("grey48","black", cols),
labels=c("0"="1951-1983", "1"="1984-2016",
"aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
theme(legend.text=element_text(size=7), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="Helvetica"),
plot.title = element_text(face="bold"),
legend.text.align = 0, axis.text.x = element_text(face = "italic", angle=35, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white"), legend.position = "none",
plot.margin = unit(c(1.5,1.5, 1.0, 1.5), "lines"),
axis.title.x = element_blank()) +
#axis.text.x.bottom = element_blank(), axis.ticks.x = element_blank()) + # top, right, bottom, left
scale_y_continuous(expand = c(0, 0)) +
scale_x_discrete(labels=c("aaBETPEN" = "Betula pendula", "AESHIP" = "Aesculus \nhippocastanum",
"ALNGLU" = "Alnus glutinosa", "FAGSYL"="Fagus sylvatica",
"QUEROB"="Quercus robur", "zFRAEXC"="Fraxinus \nexcelsior")) +
ylab("Number of false springs") + #coord_cartesian(ylim=c(0, 33)) +
#geom_hline(yintercept=7.66, linetype="dotted", col="black") +
#annotate("text", x = 5.75, y = 245, label = "Before 1984", family="Helvetica", size=3, fontface="bold") +
scale_alpha_manual(name="Climate Change", values=c(0.2, 0.7),
labels=c("0"="1951-1983", "1"="1984-2016")) +
geom_point(aes(x=as.factor(species), alpha=as.factor(cc), y=est, group=cc,
col=as.factor(cc)),
position = position_dodge(width=0.75), size=1) +
geom_linerange(aes(x=as.factor(species), alpha=as.factor(cc), ymin=lower, ymax=upper, group=cc,
col=as.factor(cc)), position = position_dodge(width=0.75)) +
ggtitle("(c)") +
guides(alpha=guide_legend(override.aes=list(fill=hcl(c(15,195),100,0,alpha=c(0.2,0.7)))), col=FALSE, fill=FALSE)
quartz()
g1<-ggarrange(budburst, tmin, falsespring, nrow=3)
g2<-grid.arrange(mylegend)
grid.arrange(g1, g2, ncol=2, widths=c(2.5, 0.75))
f$fsall<-ave(f$fs.count, f$lat.long, f$species, FUN=sum)
f$fstot<-ave(f$fsall, f$lat.long, f$species, f$cc)
falsespring<- ggplot(plusf, aes(x=species,alpha=cc, y=fstot)) + geom_boxplot(aes(alpha=as.factor(cc), fill=as.factor(species), col=as.factor(species)), outlier.shape=NA) +
scale_fill_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
scale_color_manual(name="Species", values=c("grey48","black", cols),
labels=c("0"="1951-1983", "1"="1984-2016",
"aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
theme(legend.text=element_text(size=7), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="Helvetica"),
plot.title = element_text(face="bold"),
legend.text.align = 0, axis.text.x = element_text(face = "italic", angle=35, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white"), legend.position = "none",
plot.margin = unit(c(1.5,1.5, 1.0, 1.5), "lines"),
axis.title.x = element_blank()) +
#axis.text.x.bottom = element_blank(), axis.ticks.x = element_blank()) + # top, right, bottom, left
scale_y_continuous(expand = c(0, 0)) +
scale_x_discrete(labels=c("aaBETPEN" = "Betula pendula", "AESHIP" = "Aesculus \nhippocastanum",
"ALNGLU" = "Alnus glutinosa", "FAGSYL"="Fagus sylvatica",
"QUEROB"="Quercus robur", "zFRAEXC"="Fraxinus \nexcelsior")) +
ylab("Number of false springs") + #coord_cartesian(ylim=c(0, 33)) +
#geom_hline(yintercept=7.66, linetype="dotted", col="black") +
#annotate("text", x = 5.75, y = 245, label = "Before 1984", family="Helvetica", size=3, fontface="bold") +
scale_alpha_manual(name="Climate Change", values=c(0.2, 0.7),
labels=c("0"="1951-1983", "1"="1984-2016")) +
geom_point(aes(x=as.factor(species), alpha=as.factor(cc), y=est, group=cc,
col=as.factor(cc)),
position = position_dodge(width=0.75), size=1) +
geom_linerange(aes(x=as.factor(species), alpha=as.factor(cc), ymin=lower, ymax=upper, group=cc,
col=as.factor(cc)), position = position_dodge(width=0.75)) +
ggtitle("(c)") +
guides(alpha=guide_legend(override.aes=list(fill=hcl(c(15,195),100,0,alpha=c(0.2,0.7)))), col=FALSE, fill=FALSE)
g1<-ggarrange(budburst, tmin, falsespring, nrow=3)
plusf<-subset(f, select=c(species, cc, fstot))
plusf<-plusf[!duplicated(plusf),]
plusf <- full_join(plusf, fsccsp)
falsespring<- ggplot(plusf, aes(x=species,alpha=cc, y=fstot)) + geom_boxplot(aes(alpha=as.factor(cc), fill=as.factor(species), col=as.factor(species)), outlier.shape=NA) +
scale_fill_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
scale_color_manual(name="Species", values=c("grey48","black", cols),
labels=c("0"="1951-1983", "1"="1984-2016",
"aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
theme(legend.text=element_text(size=7), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="Helvetica"),
plot.title = element_text(face="bold"),
legend.text.align = 0, axis.text.x = element_text(face = "italic", angle=35, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white"), legend.position = "none",
plot.margin = unit(c(1.5,1.5, 1.0, 1.5), "lines"),
axis.title.x = element_blank()) +
#axis.text.x.bottom = element_blank(), axis.ticks.x = element_blank()) + # top, right, bottom, left
scale_y_continuous(expand = c(0, 0)) +
scale_x_discrete(labels=c("aaBETPEN" = "Betula pendula", "AESHIP" = "Aesculus \nhippocastanum",
"ALNGLU" = "Alnus glutinosa", "FAGSYL"="Fagus sylvatica",
"QUEROB"="Quercus robur", "zFRAEXC"="Fraxinus \nexcelsior")) +
ylab("Number of false springs") + #coord_cartesian(ylim=c(0, 33)) +
#geom_hline(yintercept=7.66, linetype="dotted", col="black") +
#annotate("text", x = 5.75, y = 245, label = "Before 1984", family="Helvetica", size=3, fontface="bold") +
scale_alpha_manual(name="Climate Change", values=c(0.2, 0.7),
labels=c("0"="1951-1983", "1"="1984-2016")) +
geom_point(aes(x=as.factor(species), alpha=as.factor(cc), y=est, group=cc,
col=as.factor(cc)),
position = position_dodge(width=0.75), size=1) +
geom_linerange(aes(x=as.factor(species), alpha=as.factor(cc), ymin=lower, ymax=upper, group=cc,
col=as.factor(cc)), position = position_dodge(width=0.75)) +
ggtitle("(c)") +
guides(alpha=guide_legend(override.aes=list(fill=hcl(c(15,195),100,0,alpha=c(0.2,0.7)))), col=FALSE, fill=FALSE)
g1<-ggarrange(budburst, tmin, falsespring, nrow=3)
#f$fsall<-ave(f$fs.count, f$lat.long, f$species, FUN=sum)
f$fstot<-ave(f$fs, f$lat.long, f$species, f$cc, FUN=sum)
plusf<-subset(f, select=c(species, cc, fstot))
plusf<-plusf[!duplicated(plusf),]
plusf <- full_join(plusf, fsccsp)
falsespring<- ggplot(plusf, aes(x=species,alpha=cc, y=fstot)) + geom_boxplot(aes(alpha=as.factor(cc), fill=as.factor(species), col=as.factor(species)), outlier.shape=NA) +
scale_fill_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
scale_color_manual(name="Species", values=c("grey48","black", cols),
labels=c("0"="1951-1983", "1"="1984-2016",
"aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
theme(legend.text=element_text(size=7), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="Helvetica"),
plot.title = element_text(face="bold"),
legend.text.align = 0, axis.text.x = element_text(face = "italic", angle=35, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white"), legend.position = "none",
plot.margin = unit(c(1.5,1.5, 1.0, 1.5), "lines"),
axis.title.x = element_blank()) +
#axis.text.x.bottom = element_blank(), axis.ticks.x = element_blank()) + # top, right, bottom, left
scale_y_continuous(expand = c(0, 0)) +
scale_x_discrete(labels=c("aaBETPEN" = "Betula pendula", "AESHIP" = "Aesculus \nhippocastanum",
"ALNGLU" = "Alnus glutinosa", "FAGSYL"="Fagus sylvatica",
"QUEROB"="Quercus robur", "zFRAEXC"="Fraxinus \nexcelsior")) +
ylab("Number of false springs") + #coord_cartesian(ylim=c(0, 33)) +
#geom_hline(yintercept=7.66, linetype="dotted", col="black") +
#annotate("text", x = 5.75, y = 245, label = "Before 1984", family="Helvetica", size=3, fontface="bold") +
scale_alpha_manual(name="Climate Change", values=c(0.2, 0.7),
labels=c("0"="1951-1983", "1"="1984-2016")) +
geom_point(aes(x=as.factor(species), alpha=as.factor(cc), y=est, group=cc,
col=as.factor(cc)),
position = position_dodge(width=0.75), size=1) +
geom_linerange(aes(x=as.factor(species), alpha=as.factor(cc), ymin=lower, ymax=upper, group=cc,
col=as.factor(cc)), position = position_dodge(width=0.75)) +
ggtitle("(c)") +
guides(alpha=guide_legend(override.aes=list(fill=hcl(c(15,195),100,0,alpha=c(0.2,0.7)))), col=FALSE, fill=FALSE)
g1<-ggarrange(budburst, tmin, falsespring, nrow=3)
grid.arrange(g1, g2, ncol=2, widths=c(2.5, 0.75))
png("figures/Boxplot_BBTminFS_noDots_modestslong.png",
width=6,
height=6, units="in", res = 350 )
grid.arrange(g1, g2, ncol=2, widths=c(2.5, 0.75))
dev.off()
png("figures/Figure2.png",
width=6,
height=6, units="in", res = 350 )
grid.arrange(g1, g2, ncol=2, widths=c(2.5, 0.75))
dev.off()
tiff("figures/Figure3.tiff",
width=6,
height=6, units="in", res = 350 )
grid.arrange(g1, g2, ncol=2, widths=c(2.5, 0.75))
dev.off()
########################################################################################
###################### NOW FOR THE MODEL Plots #########################################
########################################################################################
setwd("~/Documents/git/regionalrisk")
#load("orig_full.Rdata")
#load("dvr_full.Rdata")
#load("five_full.Rdata")
load("longtemps_full.Rdata")
modlongtemps<-as.data.frame(tidy(longtemps.full, prob=0.9))
names(modlongtemps)<-c("term", "estimate", "error", "10%", "90%")
modlongtemps50<-as.data.frame(tidy(longtemps.full, prob=0.5))
names(modlongtemps50)<-c("term", "estimate", "error", "25%", "75%")
modlongtemps <- full_join(modlongtemps, modlongtemps50)
modlongtemps98<-as.data.frame(tidy(longtemps.full, prob=0.98))
names(modlongtemps98)<-c("term", "estimate", "error", "2%", "98%")
modlongtemps <- full_join(modlongtemps, modlongtemps98)
modlongtemps <- subset(modlongtemps, select=c("term", "estimate", "2%", "10%", "25%", "75%", "90%", "98%"))
write.csv(modlongtemps, file="~/Documents/git/regionalrisk/analyses/output/longtemps_full_modeloutput.csv", row.names=FALSE)
#load("orig_full.Rdata")
#load("dvr_full.Rdata")
#load("five_full.Rdata")
load("longtemps_full.Rdata")
modlongtemps<-as.data.frame(tidy(longtemps.full, prob=0.9))
## housekeeping
rm(list=ls())
options(stringsAsFactors = FALSE)
## Libraries
library(rstan)
library(brms)
library(ggplot2)
library(egg)
library(RColorBrewer)
library(viridis)
library(ggeffects)
library(broom)
library(dplyr)
########################################################################################
###################### NOW FOR THE MODEL Plots #########################################
########################################################################################
setwd("~/Documents/git/regionalrisk")
#load("orig_full.Rdata")
#load("dvr_full.Rdata")
#load("five_full.Rdata")
load("longtemps_full.Rdata")
modlongtemps<-as.data.frame(tidy(longtemps.full, prob=0.9))
names(modlongtemps)<-c("term", "estimate", "error", "10%", "90%")
modlongtemps50<-as.data.frame(tidy(longtemps.full, prob=0.5))
names(modlongtemps50)<-c("term", "estimate", "error", "25%", "75%")
modlongtemps <- full_join(modlongtemps, modlongtemps50)
modlongtemps98<-as.data.frame(tidy(longtemps.full, prob=0.98))
names(modlongtemps98)<-c("term", "estimate", "error", "2%", "98%")
modlongtemps <- full_join(modlongtemps, modlongtemps98)
modlongtemps <- subset(modlongtemps, select=c("term", "estimate", "2%", "10%", "25%", "75%", "90%", "98%"))
write.csv(modlongtemps, file="~/Documents/git/regionalrisk/analyses/output/longtemps_full_modeloutput.csv", row.names=FALSE)
### Now to make the plots
modoutput <- modlongtemps98 #modelhere
modoutput$term <- ifelse(modoutput$term=="b_Intercept", "b_speciesAESHIP", modoutput$term)
modoutput<-modoutput[1:47,]
modoutput$term<-gsub(".*b_","",modoutput$term)
modoutput<-modoutput[!(modoutput$term=="sd_species__nao.z" | modoutput$term=="sd_species__mat.z" | modoutput$term=="sd_species__elev.z"
| modoutput$term=="sd_species__dist.z" | modoutput$term=="sd_species__space.z" | modoutput$term=="sd_species__cc.z" |
modoutput$term=="sigma"),]
modoutput$species <- ifelse(grepl("species",modoutput$term),gsub(".*species", "", modoutput$term), modoutput$term)
makeaeship <- c("nao.z", "mat.z", "dist.z", "elev.z", "space.z", "cc.z")
modoutput$species <- ifelse(modoutput$term%in%makeaeship, "AESHIP", modoutput$species)
modoutput$termclean <- gsub(":species.*", "", modoutput$term)
modoutput$estclean <- NA
modoutput$estclean <- ifelse(modoutput$termclean=="mat.z" & modoutput$species != "AESHIP",
modoutput$estimate[(modoutput$term=="mat.z")]+
modoutput$estimate, modoutput$estimate)
modoutput$estclean <- ifelse(modoutput$termclean=="nao.z" & modoutput$species != "AESHIP",
modoutput$estimate[(modoutput$term=="nao.z")]+
modoutput$estimate, modoutput$estclean)
modoutput$estclean <- ifelse(modoutput$termclean=="dist.z" & modoutput$species != "AESHIP",
modoutput$estimate[(modoutput$term=="dist.z")]+
modoutput$estimate, modoutput$estclean)
modoutput$estclean <- ifelse(modoutput$termclean=="elev.z" & modoutput$species != "AESHIP",
modoutput$estimate[(modoutput$term=="elev.z")]+
modoutput$estimate, modoutput$estclean)
modoutput$estclean <- ifelse(modoutput$termclean=="space.z" & modoutput$species != "AESHIP",
modoutput$estimate[(modoutput$term=="space.z")]+
modoutput$estimate, modoutput$estclean)
modoutput$estclean <- ifelse(modoutput$termclean=="cc.z" & modoutput$species != "AESHIP",
modoutput$estimate[(modoutput$term=="cc.z")]+
modoutput$estimate, modoutput$estclean)
modoutput$lowclean <- NA
modoutput$lowclean <- ifelse(modoutput$termclean=="mat.z" & modoutput$species != "AESHIP",
modoutput$'2%'[(modoutput$term=="mat.z")]+
modoutput$'2%', modoutput$'2%')
modoutput$lowclean <- ifelse(modoutput$termclean=="nao.z" & modoutput$species != "AESHIP",
modoutput$'2%'[(modoutput$term=="nao.z")]+
modoutput$'2%', modoutput$lowclean)
modoutput$lowclean <- ifelse(modoutput$termclean=="dist.z" & modoutput$species != "AESHIP",
modoutput$'2%'[(modoutput$term=="dist.z")]+
modoutput$'2%', modoutput$lowclean)
modoutput$lowclean <- ifelse(modoutput$termclean=="elev.z" & modoutput$species != "AESHIP",
modoutput$'2%'[(modoutput$term=="elev.z")]+
modoutput$'2%', modoutput$lowclean)
modoutput$lowclean <- ifelse(modoutput$termclean=="space.z" & modoutput$species != "AESHIP",
modoutput$'2%'[(modoutput$term=="space.z")]+
modoutput$'2%', modoutput$lowclean)
modoutput$lowclean <- ifelse(modoutput$termclean=="cc.z" & modoutput$species != "AESHIP",
modoutput$'2%'[(modoutput$term=="cc.z")]+
modoutput$'2%', modoutput$lowclean)
modoutput$highclean <- NA
modoutput$highclean <- ifelse(modoutput$termclean=="mat.z" & modoutput$species != "AESHIP",
modoutput$'98%'[(modoutput$term=="mat.z")]+
modoutput$'98%', modoutput$'98%')
modoutput$highclean <- ifelse(modoutput$termclean=="nao.z" & modoutput$species != "AESHIP",
modoutput$'98%'[(modoutput$term=="nao.z")]+
modoutput$'98%', modoutput$highclean)
modoutput$highclean <- ifelse(modoutput$termclean=="dist.z" & modoutput$species != "AESHIP",
modoutput$'98%'[(modoutput$term=="dist.z")]+
modoutput$'98%', modoutput$highclean)
modoutput$highclean <- ifelse(modoutput$termclean=="elev.z" & modoutput$species != "AESHIP",
modoutput$'98%'[(modoutput$term=="elev.z")]+
modoutput$'98%', modoutput$highclean)
modoutput$highclean <- ifelse(modoutput$termclean=="space.z" & modoutput$species != "AESHIP",
modoutput$'98%'[(modoutput$term=="space.z")]+
modoutput$'98%', modoutput$highclean)
modoutput$highclean <- ifelse(modoutput$termclean=="cc.z" & modoutput$species != "AESHIP",
modoutput$'98%'[(modoutput$term=="cc.z")]+
modoutput$'98%', modoutput$highclean)
modoutput$estavg <- ave(modoutput$estclean, modoutput$termclean)
modoutput$lowavg <- ave(modoutput$lowclean, modoutput$termclean)
modoutput$highavg <- ave(modoutput$highclean, modoutput$termclean)
modoutput$Jvar<-NA
modoutput$Jvar<-ifelse(modoutput$termclean=="nao.z", 8, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$termclean=="mat.z", 11, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$termclean=="elev.z", 9, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$termclean=="dist.z", 10, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$termclean=="space.z", 7, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$termclean=="cc.z", 6, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$termclean=="nao.z:cc.z", 2, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$termclean=="mat.z:cc.z", 5, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$termclean=="elev.z:cc.z", 3, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$termclean=="dist.z:cc.z", 4, modoutput$Jvar)
modoutput$Jvar<-ifelse(modoutput$termclean=="space.z:cc.z", 1, modoutput$Jvar)
estimates<-c("Mean Spring Temperature", "Distance from Coast", "Elevation", "NAO Index", "Space Parameter", "Climate Change",
"Mean Spring Temperature \nx Climate Change", "Distance from Coast \nx Climate Change",
"Elevation x \nClimate Change", "NAO Index x \nClimate Change", "Space Parameter \nx Climate Change")
estimates<-rev(estimates)
modoutput <- modoutput[!is.na(modoutput$Jvar),]
allspp <- c("nao.z:cc.z", "mat.z:cc.z", "elev.z:cc.z", "dist.z:cc.z", "space.z:cc.z")
modoutput$species<-ifelse(modoutput$species%in%allspp, "all", modoutput$species)
indspp <- subset(modoutput, select=c("species", "lowclean", "highclean", "estclean", "Jvar", "termclean"))
indspp <- indspp[indspp$species!="all",]
indspp <- indspp[!duplicated(indspp),]
allspp <- subset(modoutput, select=c("species", "lowavg", "highavg", "estavg", "Jvar", "termclean"))
allspp <- allspp[(allspp$species=="all" | (allspp$species=="AESHIP")),]
allspp <- allspp[!duplicated(allspp),]
allspp$species <- "aaall"
names(allspp)<-c("species", "lowclean", "highclean", "estclean", "Jvar", "termclean")
modoutput <- full_join(indspp, allspp)
modoutput$Jvar <- ifelse(modoutput$species=="AESHIP", modoutput$Jvar - 0.2, modoutput$Jvar)
modoutput$Jvar <- ifelse(modoutput$species=="ALNGLU", modoutput$Jvar - 0.25, modoutput$Jvar)
modoutput$Jvar <- ifelse(modoutput$species=="BETPEN", modoutput$Jvar - 0.3, modoutput$Jvar)
modoutput$Jvar <- ifelse(modoutput$species=="FAGSYL", modoutput$Jvar - 0.35, modoutput$Jvar)
modoutput$Jvar <- ifelse(modoutput$species=="FRAEXC", modoutput$Jvar - 0.4, modoutput$Jvar)
modoutput$Jvar <- ifelse(modoutput$species=="QUEROB", modoutput$Jvar - 0.45, modoutput$Jvar)
modoutput$species<-ifelse(modoutput$species=="BETPEN", "aaBETPEN", modoutput$species)
modoutput$species<-ifelse(modoutput$species=="FRAEXC", "zFRAEXC", modoutput$species)
my.pal <-viridis_pal(option="viridis")(6)
my.pal <- c("black", my.pal)
modoutput <- modoutput[(modoutput$species=="aaall"),]
regrisk<-ggplot(modoutput, aes(x=lowclean, xend=highclean, y=Jvar, yend=Jvar)) +
geom_vline(xintercept=0, linetype="dotted") + geom_point(aes(x=estclean, y=Jvar), col="black") +
geom_segment(arrow = arrow(length = unit(0.00, "npc")), col="black") +
guides(size=FALSE) +
scale_y_discrete(limits = sort(unique(modoutput$termclean)), labels=estimates) +
xlab("Change in Probability of False Springs") + ylab("") + theme_linedraw() +
theme(legend.text=element_text(size=7), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="sans"), legend.position = "none",
legend.text.align = 0,
plot.margin = unit(c(3,3,1,1), "lines")) +  #+ ggtitle("Original Parameters") +
coord_cartesian(xlim=c(-1.5, 1), ylim=c(1,11), clip = 'off') + #ggtitle("A.")
annotate("segment", x = 0.05, xend = 1.1, y = 11.75, yend = 11.75, colour = "black", size=0.2, arrow=arrow(length=unit(0.20,"cm"))) +
annotate("segment", x = -0.1, xend = -1.6, y = 11.75, yend = 11.75, colour = "black", size=0.2, arrow=arrow(length=unit(0.20,"cm"))) + ## FOR FIVE
#annotate("segment", x = -0.05, xend = -1.1, y = 11.75, yend = 11.75, colour = "black", size=0.2, arrow=arrow(length=unit(0.20,"cm"))) + ## for DVR and ORIG
annotate("text", x = 0.6, y = 12, colour = "black", size=3, label="More False Spring Risk") + ## FOR FIVE
#annotate("text", x = 0.55, y = 12, colour = "black", size=3, label="More False Spring Risk") + ## FOR DVR AND ORIG
annotate("text", x = -0.8, y = 12, colour = "black", size=3, label="Less False Spring Risk")  ## FOR FIVE
png("~/Documents/git/regionalrisk/analyses/figures/model_output_98_longtemps.png", ### makes it a nice png and saves it so it doesn't take forever to load as a pdf!
width=7,
height=6, units="in", res = 350 )
grid.arrange(regrisk)
dev.off()
