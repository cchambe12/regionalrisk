"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"cQUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
scale_color_manual(name="Species", values=cols,
labels=c("afBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"cQUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
theme(legend.text=element_text(size=5), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="Helvetica"),
legend.text.align = 0, axis.text.x = element_text(face = "italic", angle=35, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white"), #legend.position = "none",
plot.margin = unit(c(1.5,1.5, 1.0, 1.5), "lines"),
axis.title.x = element_blank()) +
#axis.text.x.bottom = element_blank(), axis.ticks.x = element_blank()) + # top, right, bottom, left
scale_y_continuous(expand = c(0, 0)) +
scale_x_discrete(labels=c("afBETPEN" = "Betula pendula \n(DVR = 11 days)", "AESHIP" = "Aesculus \nhippocastanum \n(DVR = 11 days)",
"ALNGLU" = "Alnus glutinosa \n(DVR = 12 days)", "FAGSYL"="Fagus sylvatica \n(DVR = 8 days)",
"cQUEROB"="Quercus robur \n(DVR = 7 days)", "zFRAEXC"="Fraxinus \nexcelsior \n(DVR = 7 days)")) +
ylab("Number of Years \nwith False Springs") + coord_cartesian(ylim=c(0,25)) +
#geom_hline(yintercept=7.66, linetype="dotted", col="black") +
#annotate("text", x = 5.75, y = 245, label = "Before 1984", family="Helvetica", size=3, fontface="bold") +
scale_alpha_manual(name="Climate Change", values=c(0.2, 0.7),
labels=c("0"="1951-1983", "1"="1984-2016")) +
guides(alpha=guide_legend(override.aes=list(fill=hcl(c(15,195),100,0,alpha=c(0.2,0.7)))), col=FALSE, fill=FALSE)
ggarrange(budburst, tmin, falsespring, ncol=1, nrow=3)
table(mat$sp,)
table(mat$species, mat$bb.avg)
table(mat$species, mat$bb)
table(mat$species, mat$bb.avg)
mat$med<-ave(mat$bb, mat$species, FUN=median)
table(mat$species, mat$med)
rm(list=ls())
options(stringsAsFactors = FALSE)
library(ggplot2)
library(dplyr)
library(tidyr)
library(egg)
library(RColorBrewer)
# Setting working directory
setwd("~/Documents/git/regionalrisk/analyses/")
########################
#### get the data
#xx<-read.csv("output/fs_yearsitespp.csv", header=TRUE)
#xx<-subset(xx, year>1950)
mat<-read.csv("output/BBdata_dvr.csv", header=TRUE)
mat$bb.avg<-ave(mat$bb, mat$species)
mat$cc<-ifelse(mat$year<1984, 0, 1)
mat$species<-ifelse(mat$species=="BETPEN", "aaBETPEN", mat$species)
mat$species<-ifelse(mat$species=="FRAEXC", "zFRAEXC", mat$species)
mat$species<-ifelse(mat$species=="ALNGLU", "abALNGLU", mat$species)
pre<-subset(mat, mat$cc==0)
for(i in unique(pre$species)){
pre<-pre[(pre$bb[pre$species==i]<quantile(pre$bb[pre$species==i], 0.75) & pre$bb[pre$species==i]>quantile(pre$bb[pre$species==i], 0.25)),]
}
post<-subset(mat, mat$cc==1)
for(i in unique(post$species)){
post<-post[(post$bb[post$species==i]<quantile(post$bb[post$species==i], 0.75) & post$bb[post$species==i]>quantile(post$bb[post$species==i], 0.25)),]
}
plus<-full_join(pre, post)
cols <- colorRampPalette(brewer.pal(7,"Accent"))(6)
budburst<- ggplot(mat, aes(x=species, y=bb, alpha=cc)) + geom_boxplot(aes(alpha=as.factor(cc), fill=as.factor(species), col=as.factor(species))) +
scale_fill_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"abALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
scale_color_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"abALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
theme(legend.text=element_text(size=5), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="Helvetica"),
legend.text.align = 0, axis.text.x = element_text(face = "italic", angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white"), #legend.position = "none",
plot.margin = unit(c(1.5,1.5,1.0,1.5), "lines"),
axis.title.x = element_blank(),
axis.text.x.bottom = element_blank(), axis.ticks.x = element_blank()) + # top, right, bottom, left
scale_y_continuous(expand = c(0, 0)) +
scale_x_discrete(labels=c("aaBETPEN" = "Betula pendula", "AESHIP" = "Aesculus \nhippocastanum",
"abALNGLU" = "Alnus glutinosa", "FAGSYL"="Fagus sylvatica",
"cQUEROB"="Quercus robur", "zFRAEXC"="Fraxinus \nexcelsior")) +
ylab("Day of Budburst") + coord_cartesian(ylim=c(50,165)) +
geom_hline(yintercept=107.96, linetype="dotted", col="black") +
#annotate("text", x = 5.75, y = 245, label = "Before 1984", family="Helvetica", size=3, fontface="bold") +
scale_alpha_manual(name="Climate Change", values=c(0.2, 0.7),
labels=c("0"="1951-1983", "1"="1984-2016")) +
guides(alpha=guide_legend(override.aes=list(fill=hcl(c(15,195),100,0,alpha=c(0.2,0.7)))), col=FALSE, fill=FALSE)
###### Tmin boxplots now...
tm<-read.csv("output/tminprep_boxplots_dvr.csv", header=TRUE)
tm$cc<-ifelse(tm$year<1984, 0, 1)
tm$species<-ifelse(tm$species=="BETPEN", "aaBETPEN", tm$species)
tm$species<-ifelse(tm$species=="FRAEXC", "zFRAEXC", tm$species)
tm$species<-ifelse(tm$species=="ALNGLU", "abALNGLU", tm$species)
tm<-tm[!is.na(tm$Tmin),]
pret<-subset(tm, tm$cc==0)
#for(i in unique(pret$species)){
# pret<-pret[(pret$Tmin[pret$species==i]<quantile(pret$Tmin[pret$species==i], 0.75) & pret$Tmin[pret$species==i]>quantile(pret$Tmin[pret$species==i], 0.25)),]
#}
postt<-subset(tm, tm$cc==1)
#for(i in unique(postt$species)){
#  postt<-postt[(postt$Tmin[postt$species==i]<quantile(postt$Tmin[postt$species==i], 0.75) & postt$Tmin[postt$species==i]>quantile(postt$Tmin[postt$species==i], 0.25)),]
#}
plust<-full_join(pret, postt)
cols <- colorRampPalette(brewer.pal(7,"Accent"))(6)
tmin<- ggplot(plust, aes(x=species, y=Tmin, alpha=cc)) + geom_boxplot(aes(alpha=as.factor(cc), fill=as.factor(species), col=as.factor(species))) +
scale_fill_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"abALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
scale_color_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"abALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
theme(legend.text=element_text(size=5), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="Helvetica"),
legend.text.align = 0, axis.text.x = element_text(face = "italic", angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white"), #legend.position = "none",
plot.margin = unit(c(1.5,1.5,1.0,1.5), "lines"),
axis.title.x = element_blank(),
axis.text.x.bottom = element_blank(), axis.ticks.x = element_blank()) + # top, right, bottom, left
scale_y_continuous(expand = c(0, 0)) +
scale_x_discrete(labels=c("aaBETPEN" = "Betula pendula", "AESHIP" = "Aesculus \nhippocastanum",
"abALNGLU" = "Alnus glutinosa", "FAGSYL"="Fagus sylvatica",
"QUEROB"="Quercus robur", "zFRAEXC"="Fraxinus \nexcelsior")) +
ylab("Minimum Temperature \nfrom Budburst to Leafout") + coord_cartesian(ylim=c(-5,18)) +
geom_hline(yintercept=7.69, linetype="dotted", col="black") +
#annotate("text", x = 5.75, y = 245, label = "Before 1984", family="Helvetica", size=3, fontface="bold") +
scale_alpha_manual(name="Climate Change", values=c(0.2, 0.7),
labels=c("0"="1951-1983", "1"="1984-2016")) +
guides(alpha=guide_legend(override.aes=list(fill=hcl(c(15,195),100,0,alpha=c(0.2,0.7)))), col=FALSE, fill=FALSE)
### And finally... False springs!
f<-read.csv("output/fs_newdvr_space.csv", header=TRUE)
f$cc<-ifelse(f$year<1980, 0, 1)
f$species<-ifelse(f$species=="BETPEN", "aaBETPEN", f$species)
f$species<-ifelse(f$species=="FRAEXC", "zFRAEXC", f$species)
f$species<-ifelse(f$species=="ALNGLU", "abALNGLU", f$species)
f<-f[!is.na(f$fs.count),]
f$fs<-ifelse(f$fs.count>0, 1, 0)
f$fs<-ave(f$fs,f$lat.long, f$species, f$cc, FUN=sum)
plusf<-subset(f, select=c(species, cc, fs))
plusf<-plusf[!duplicated(plusf),]
cols <- colorRampPalette(brewer.pal(7,"Accent"))(6)
falsespring<- ggplot(plusf, aes(x=species,alpha=cc, y=fs)) + geom_boxplot(aes(alpha=as.factor(cc), fill=as.factor(species), col=as.factor(species))) +
scale_fill_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"abALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
scale_color_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"abALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
theme(legend.text=element_text(size=5), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="Helvetica"),
legend.text.align = 0, axis.text.x = element_text(face = "italic", angle=35, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white"), #legend.position = "none",
plot.margin = unit(c(1.5,1.5, 1.0, 1.5), "lines"),
axis.title.x = element_blank()) +
#axis.text.x.bottom = element_blank(), axis.ticks.x = element_blank()) + # top, right, bottom, left
scale_y_continuous(expand = c(0, 0)) +
scale_x_discrete(labels=c("aaBETPEN" = "Betula pendula \n(DVR = 11 days)", "AESHIP" = "Aesculus \nhippocastanum \n(DVR = 11 days)",
"abALNGLU" = "Alnus glutinosa \n(DVR = 12 days)", "FAGSYL"="Fagus sylvatica \n(DVR = 8 days)",
"QUEROB"="Quercus robur \n(DVR = 7 days)", "zFRAEXC"="Fraxinus \nexcelsior \n(DVR = 7 days)")) +
ylab("Number of Years \nwith False Springs") + coord_cartesian(ylim=c(0,25)) +
#geom_hline(yintercept=7.66, linetype="dotted", col="black") +
#annotate("text", x = 5.75, y = 245, label = "Before 1984", family="Helvetica", size=3, fontface="bold") +
scale_alpha_manual(name="Climate Change", values=c(0.2, 0.7),
labels=c("0"="1951-1983", "1"="1984-2016")) +
guides(alpha=guide_legend(override.aes=list(fill=hcl(c(15,195),100,0,alpha=c(0.2,0.7)))), col=FALSE, fill=FALSE)
quartz()
ggarrange(budburst, tmin, falsespring, ncol=1, nrow=3)
pre$mean<-ave(pre$bb, pre$species)
table(pre$species, pre$mean)
pre<-subset(mat, mat$cc==0)
pre$mean<-ave(pre$bb, pre$species)
table(pre$species, pre$mean)
post<-subset(mat, mat$cc==1)
post$mean<-ave(post$bb, post$species)
table(post$species, post$mean)
tmin<- ggplot(plust, aes(x=species, y=Tmin, alpha=cc)) + geom_boxplot(aes(alpha=as.factor(cc), fill=as.factor(species), col=as.factor(species))) +
scale_fill_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"abALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
scale_color_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"abALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
theme(legend.text=element_text(size=5), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="Helvetica"),
legend.text.align = 0, axis.text.x = element_text(face = "italic", angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white"), #legend.position = "none",
plot.margin = unit(c(1.5,1.5,1.0,1.5), "lines"),
axis.title.x = element_blank(),
axis.text.x.bottom = element_blank(), axis.ticks.x = element_blank()) + # top, right, bottom, left
scale_y_continuous(expand = c(0, 0)) +
scale_x_discrete(labels=c("aaBETPEN" = "Betula pendula", "AESHIP" = "Aesculus \nhippocastanum",
"abALNGLU" = "Alnus glutinosa", "FAGSYL"="Fagus sylvatica",
"QUEROB"="Quercus robur", "zFRAEXC"="Fraxinus \nexcelsior")) +
ylab("Minimum Temperature \nfrom Budburst to Leafout") + coord_cartesian(ylim=c(-5,20)) +
geom_hline(yintercept=7.69, linetype="dotted", col="black") +
#annotate("text", x = 5.75, y = 245, label = "Before 1984", family="Helvetica", size=3, fontface="bold") +
scale_alpha_manual(name="Climate Change", values=c(0.2, 0.7),
labels=c("0"="1951-1983", "1"="1984-2016")) +
guides(alpha=guide_legend(override.aes=list(fill=hcl(c(15,195),100,0,alpha=c(0.2,0.7)))), col=FALSE, fill=FALSE)
ggarrange(budburst, tmin, falsespring, ncol=1, nrow=3)
budburst<- ggplot(mat, aes(x=species, y=bb, alpha=cc)) + geom_boxplot(aes(alpha=as.factor(cc), fill=as.factor(species), col=as.factor(species))) +
scale_fill_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"abALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
scale_color_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"abALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
theme(legend.text=element_text(size=7), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="Helvetica"),
legend.text.align = 0, axis.text.x = element_text(face = "italic", angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white"), #legend.position = "none",
plot.margin = unit(c(1.5,1.5,1.0,1.5), "lines"),
axis.title.x = element_blank(),
axis.text.x.bottom = element_blank(), axis.ticks.x = element_blank()) + # top, right, bottom, left
scale_y_continuous(expand = c(0, 0)) +
scale_x_discrete(labels=c("aaBETPEN" = "Betula pendula", "AESHIP" = "Aesculus \nhippocastanum",
"abALNGLU" = "Alnus glutinosa", "FAGSYL"="Fagus sylvatica",
"cQUEROB"="Quercus robur", "zFRAEXC"="Fraxinus \nexcelsior")) +
ylab("Day of Budburst") + coord_cartesian(ylim=c(50,165)) +
geom_hline(yintercept=107.96, linetype="dotted", col="black") +
#annotate("text", x = 5.75, y = 245, label = "Before 1984", family="Helvetica", size=3, fontface="bold") +
scale_alpha_manual(name="Climate Change", values=c(0.2, 0.7),
labels=c("0"="1951-1983", "1"="1984-2016")) +
guides(alpha=guide_legend(override.aes=list(fill=hcl(c(15,195),100,0,alpha=c(0.2,0.7)))), col=FALSE, fill=FALSE)
tmin<- ggplot(plust, aes(x=species, y=Tmin, alpha=cc)) + geom_boxplot(aes(alpha=as.factor(cc), fill=as.factor(species), col=as.factor(species))) +
scale_fill_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"abALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
scale_color_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"abALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
theme(legend.text=element_text(size=7), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="Helvetica"),
legend.text.align = 0, axis.text.x = element_text(face = "italic", angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white"), #legend.position = "none",
plot.margin = unit(c(1.5,1.5,1.0,1.5), "lines"),
axis.title.x = element_blank(),
axis.text.x.bottom = element_blank(), axis.ticks.x = element_blank()) + # top, right, bottom, left
scale_y_continuous(expand = c(0, 0)) +
scale_x_discrete(labels=c("aaBETPEN" = "Betula pendula", "AESHIP" = "Aesculus \nhippocastanum",
"abALNGLU" = "Alnus glutinosa", "FAGSYL"="Fagus sylvatica",
"QUEROB"="Quercus robur", "zFRAEXC"="Fraxinus \nexcelsior")) +
ylab("Minimum Temperature \nfrom Budburst to Leafout") + coord_cartesian(ylim=c(-5,20)) +
geom_hline(yintercept=7.69, linetype="dotted", col="black") +
#annotate("text", x = 5.75, y = 245, label = "Before 1984", family="Helvetica", size=3, fontface="bold") +
scale_alpha_manual(name="Climate Change", values=c(0.2, 0.7),
labels=c("0"="1951-1983", "1"="1984-2016")) +
guides(alpha=guide_legend(override.aes=list(fill=hcl(c(15,195),100,0,alpha=c(0.2,0.7)))), col=FALSE, fill=FALSE)
falsespring<- ggplot(plusf, aes(x=species,alpha=cc, y=fs)) + geom_boxplot(aes(alpha=as.factor(cc), fill=as.factor(species), col=as.factor(species))) +
scale_fill_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"abALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
scale_color_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"abALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
theme(legend.text=element_text(size=7), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="Helvetica"),
legend.text.align = 0, axis.text.x = element_text(face = "italic", angle=35, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white"), #legend.position = "none",
plot.margin = unit(c(1.5,1.5, 1.0, 1.5), "lines"),
axis.title.x = element_blank()) +
#axis.text.x.bottom = element_blank(), axis.ticks.x = element_blank()) + # top, right, bottom, left
scale_y_continuous(expand = c(0, 0)) +
scale_x_discrete(labels=c("aaBETPEN" = "Betula pendula \n(DVR = 11 days)", "AESHIP" = "Aesculus \nhippocastanum \n(DVR = 11 days)",
"abALNGLU" = "Alnus glutinosa \n(DVR = 12 days)", "FAGSYL"="Fagus sylvatica \n(DVR = 8 days)",
"QUEROB"="Quercus robur \n(DVR = 7 days)", "zFRAEXC"="Fraxinus \nexcelsior \n(DVR = 7 days)")) +
ylab("Number of Years \nwith False Springs") + coord_cartesian(ylim=c(0,25)) +
#geom_hline(yintercept=7.66, linetype="dotted", col="black") +
#annotate("text", x = 5.75, y = 245, label = "Before 1984", family="Helvetica", size=3, fontface="bold") +
scale_alpha_manual(name="Climate Change", values=c(0.2, 0.7),
labels=c("0"="1951-1983", "1"="1984-2016")) +
guides(alpha=guide_legend(override.aes=list(fill=hcl(c(15,195),100,0,alpha=c(0.2,0.7)))), col=FALSE, fill=FALSE)
ggarrange(budburst, tmin, falsespring, ncol=1, nrow=3)
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load Libraries
library(ggplot2)
library(dplyr)
library(tidyr)
library(egg)
library(brms)
library(grid)
library(gridExtra)
# Setting working directory
setwd("~/Documents/git/regionalrisk/analyses/")
bb<-read.csv("output/fs_newdvr_space.csv", header=TRUE)
xx<-read.csv("output/BBdata_dvr.csv", header=TRUE)
dxx<-bb
#dxx$fs<-ifelse(dxx$fs.count>0, 1, 0)
#dxx$fs.yr<-ave(dxx$fs.count, dxx$year, FUN=sum)
#dxx$fs.yrspp<-ave(dxx$fs.count, dxx$species, dxx$year, FUN=sum)
### Sites per species -
#length(unique(xx$PEP_ID[xx$species=="AESHIP"])) # lat.long: 10158 - eigen: 10158 - PEP: 10496
#length(unique(xx$PEP_ID[xx$species=="ALNGLU"])) # lat.long: 6775 - eigen: 6775 - PEP: 6915
#length(unique(xx$PEP_ID[xx$species=="BETPEN"])) # lat.long: 10139 - eigen: 10137 - PEP: 10465
#length(unique(xx$PEP_ID[xx$species=="FAGSYL"])) # lat.long: 9099 - eigen: 9097 - PEP: 9363
#length(unique(xx$PEP_ID[xx$species=="FRAEXC"])) # lat.long: 7327 - eigen: 7325 - PEP: 7503
#length(unique(xx$lat.long[xx$species=="QUEROB"])) # lat.long: 8831 - eigen: 8809 - PEP: 9044
#dxx$spp.prop<-NA
#dxx$spp.sites<-as.numeric(ave(dxx$lat.long, dxx$year, dxx$species, FUN=length))
#dxx$spp.prop<-ifelse(dxx$species=="AESHIP", dxx$fs.yrspp/dxx$spp.sites, dxx$spp.prop)
#dxx$spp.prop<-ifelse(dxx$species=="ALNGLU", dxx$fs.yrspp/dxx$spp.sites, dxx$spp.prop)
#dxx$spp.prop<-ifelse(dxx$species=="BETPEN", dxx$fs.yrspp/dxx$spp.sites, dxx$spp.prop)
#dxx$spp.prop<-ifelse(dxx$species=="FAGSYL", dxx$fs.yrspp/dxx$spp.sites, dxx$spp.prop)
#dxx$spp.prop<-ifelse(dxx$species=="FRAEXC", dxx$fs.yrspp/dxx$spp.sites, dxx$spp.prop)
#dxx$spp.prop<-ifelse(dxx$species=="QUEROB", dxx$fs.yrspp/dxx$spp.sites, dxx$spp.prop)
#dxx$spp.ave<-ave(dxx$spp.prop, dxx$species, FUN=median)
#dxx$num.sites<-as.numeric(ave(dxx$lat.long, dxx$year, FUN=length))
#dxx$fs.prop<-dxx$fs.yr/dxx$num.sites
#dxx$fs.ave<-ave(dxx$fs.prop, FUN=median)
xx<-inner_join(xx, dxx)
xx$bb.yr<-ave(xx$bb, xx$species, xx$year)
#xx$x<-scale(xx$bb.yr, center = FALSE, scale = TRUE)
#xx$sx<-xx$bb.yr-90.2963
#xx$tempsite<-ave(xx$mst, xx$lat.long, xx$year)
aeship<-subset(xx, species=="AESHIP")
ahip<-ggplot(aeship, aes(x=year, y=mst)) + geom_point(alpha=0.08) + xlab("Year") + ylab("Mean Spring Temperature") +
ggtitle(expression(paste(italic("C. Aesculus hippocastanum \n(Avg Day of Budburst = 95.29)")))) +
coord_cartesian(ylim=c(-5,15)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"),
plot.title=element_text(colour = "#FDD98D", size = 9),axis.title = element_text(size=9)) +
geom_line(aes(y=bb.yr/10), col="blue", stat="smooth", size=2, method="auto") +
scale_y_continuous(sec.axis = sec_axis(~.*10, name="Avg Day of Budburst", labels=c(0,35,70,105,140)))
alnglu<-subset(xx, species=="ALNGLU")
aglu<-ggplot(alnglu, aes(x=year, y=mst)) + geom_point(alpha=0.08) + xlab("Year") + ylab("Mean Spring Temperature") +
ggtitle(expression(paste(italic("B. Alnus glutinosa \n(Avg Day of Budburst = 98.32)")))) +
coord_cartesian(ylim=c(-5,15)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"),
plot.title=element_text(colour = "#CAB1C4", size = 9),axis.title = element_text(size=9)) +
geom_line(aes(y=bb.yr/10), col="blue", stat="smooth", size=2, method="auto") +
scale_y_continuous(sec.axis = sec_axis(~.*10, name="Avg Day of Budburst", labels=c(0,35,70,105,140)))
betpen<-subset(xx, species=="BETPEN")
bpen<-ggplot(betpen, aes(x=year, y=mst)) + geom_point(alpha=0.08) + xlab("Year") + ylab("Mean Spring Temperature") +
ggtitle(expression(paste(italic("A. Betula pendula \n(Avg Day of Budburst = 97.31)")))) +
coord_cartesian(ylim=c(-5,15)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"),plot.title=element_text(colour = "#7FC97F", size = 9),
axis.title = element_text(size=9)) +
geom_line(aes(y=bb.yr/10), col="blue", stat="smooth", size=2, method="auto") + scale_y_continuous(sec.axis = sec_axis(~.*10, name="Avg Day of Budburst", labels=c(0,35,70,105,140)))
fagsyl<-subset(xx, species=="FAGSYL")
fsyl<-ggplot(fagsyl, aes(x=year, y=mst)) + geom_point(alpha=0.08) + xlab("Year") + ylab("Mean Spring Temperature") +
ggtitle(expression(paste(italic("D. Fagus sylvatica \n(Avg Day of Budburst = 113.83)")))) +
coord_cartesian(ylim=c(-5,15)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"),
plot.title=element_text(colour = "#87A6A6", size = 9),axis.title = element_text(size=9)) +
geom_line(aes(y=bb.yr/10), col="blue", stat="smooth", size=2, method="auto") +
scale_y_continuous(sec.axis = sec_axis(~.*10, name="Avg Day of Budburst", labels=c(0,35,70,105,140)))
fraexc<-subset(xx, species=="FRAEXC")
fexc<-ggplot(fraexc, aes(x=year, y=mst)) + geom_point(alpha=0.08) + xlab("Year") + ylab("Mean Spring Temperature") +
ggtitle(expression(paste(italic("F. Fraxinus excelsior \n(Avg Day of Budburst = 117.80)")))) +
coord_cartesian(ylim=c(-5,15)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"),
plot.title=element_text(colour = "#BF5B17", size = 9),axis.title = element_text(size=9)) +
geom_line(aes(y=bb.yr/10), col="blue", stat="smooth", size=2, method="auto") +
scale_y_continuous(sec.axis = sec_axis(~.*10, name="Avg Day of Budburst", labels=c(0,35,70,105,140)))
querob<-subset(xx, species=="QUEROB")
qrob<-ggplot(querob, aes(x=year, y=mst)) + geom_point(alpha=0.08) + xlab("Year") + ylab("Mean Spring Temperature") +
ggtitle(expression(paste(italic("E. Quercus robur \n(Avg Day of Budburst = 111.74)")))) +
coord_cartesian(ylim=c(-5,15)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"),
plot.title=element_text(colour = "#CB1788", size = 9),axis.title = element_text(size=9)) +
geom_line(aes(y=bb.yr/10), col="blue", stat="smooth", size=2, method="auto") +
scale_y_continuous(sec.axis = sec_axis(~.*10, name="Avg Day of Budburst", labels=c(0,35,70,105,140)))
quartz()
mstplots<-ggarrange(ahip, bpen, aglu, qrob, fsyl, fexc, ncol=3, nrow=2)
png("figures/MSTBB_bySpp.png",
width=8,
height=5, units="in", res = 350 )
grid.draw(mstplots)
dev.off()
tm<-read.csv("output/tminprep_boxplots_dvr.csv", header=TRUE)
tm<-full_join(xx, tm)
tm<-na.omit(tm)
aeship<-subset(tm, species=="AESHIP")
ahip<-ggplot(aeship, aes(x=year, y=Tmin)) + geom_point(alpha=0.08) + xlab("Year") + ylab("Minimum Temperature from \nBudburst to Leafout") +
ggtitle(expression(paste(italic("C. Aesculus hippocastanum \n(Avg Day of Budburst = 95.29)")))) +
coord_cartesian(ylim=c(-5,20)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"),
plot.title=element_text(colour = "#FDD98D", size = 9),axis.title = element_text(size=9)) +
geom_line(aes(y=bb.yr/10), col="blue", stat="smooth", size=2, method="auto") +
scale_y_continuous(sec.axis = sec_axis(~.*10, name="Avg Day of Budburst", labels=c(0,30,60,90,120, 150)))
alnglu<-subset(tm, species=="ALNGLU")
aglu<-ggplot(alnglu, aes(x=year, y=Tmin)) + geom_point(alpha=0.08) + xlab("Year") + ylab("Minimum Temperature from \nBudburst to Leafout") +
ggtitle(expression(paste(italic("B. Alnus glutinosa \n(Avg Day of Budburst = 98.32)")))) +
coord_cartesian(ylim=c(-5,20)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"),
plot.title=element_text(colour = "#CAB1C4", size = 9),axis.title = element_text(size=9)) +
geom_line(aes(y=bb.yr/10), col="blue", stat="smooth", size=2, method="auto") +
scale_y_continuous(sec.axis = sec_axis(~.*10, name="Avg Day of Budburst", labels=c(0,30,60,90,120, 150)))
betpen<-subset(tm, species=="BETPEN")
bpen<-ggplot(betpen, aes(x=year, y=Tmin)) + geom_point(alpha=0.08) + xlab("Year") + ylab("Minimum Temperature from \nBudburst to Leafout") +
ggtitle(expression(paste(italic("A. Betula pendula \n(Avg Day of Budburst = 97.31)")))) +
coord_cartesian(ylim=c(-5,20)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"),plot.title=element_text(colour = "#7FC97F", size = 9),
axis.title = element_text(size=9)) +
geom_line(aes(y=bb.yr/10), col="blue", stat="smooth", size=2, method="auto") + scale_y_continuous(sec.axis = sec_axis(~.*10, name="Avg Day of Budburst", labels=c(0,30,60,90,120, 150)))
fagsyl<-subset(tm, species=="FAGSYL")
fsyl<-ggplot(fagsyl, aes(x=year, y=Tmin)) + geom_point(alpha=0.08) + xlab("Year") + ylab("Minimum Temperature from \nBudburst to Leafout") +
ggtitle(expression(paste(italic("D. Fagus sylvatica \n(Avg Day of Budburst = 113.83)")))) +
coord_cartesian(ylim=c(-5,20)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"),
plot.title=element_text(colour = "#87A6A6", size = 9),axis.title = element_text(size=9)) +
geom_line(aes(y=bb.yr/10), col="blue", stat="smooth", size=2, method="auto") +
scale_y_continuous(sec.axis = sec_axis(~.*10, name="Avg Day of Budburst", labels=c(0,30,60,90,120, 150)))
fraexc<-subset(tm, species=="FRAEXC")
fexc<-ggplot(fraexc, aes(x=year, y=Tmin)) + geom_point(alpha=0.08) + xlab("Year") + ylab("Minimum Temperature from \nBudburst to Leafout") +
ggtitle(expression(paste(italic("F. Fraxinus excelsior \n(Avg Day of Budburst = 117.80)")))) +
coord_cartesian(ylim=c(-5,20)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"),
plot.title=element_text(colour = "#BF5B17", size = 9),axis.title = element_text(size=9)) +
geom_line(aes(y=bb.yr/10), col="blue", stat="smooth", size=2, method="auto") +
scale_y_continuous(sec.axis = sec_axis(~.*10, name="Avg Day of Budburst", labels=c(0,30,60,90,120, 150)))
querob<-subset(tm, species=="QUEROB")
qrob<-ggplot(querob, aes(x=year, y=Tmin)) + geom_point(alpha=0.08) + xlab("Year") + ylab("Minimum Temperature from \nBudburst to Leafout") +
ggtitle(expression(paste(italic("E. Quercus robur \n(Avg Day of Budburst = 111.74)")))) +
coord_cartesian(ylim=c(-5,20)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"),
plot.title=element_text(colour = "#CB1788", size = 9),axis.title = element_text(size=9)) +
geom_line(aes(y=bb.yr/10), col="blue", stat="smooth", size=2, method="auto") +
scale_y_continuous(sec.axis = sec_axis(~.*10, name="Avg Day of Budburst", labels=c(0,30,60,90,120,150)))
quartz()
tminplot<-ggarrange(ahip, bpen, aglu, qrob, fsyl, fexc, ncol=3, nrow=2)
png("figures/TminBB_bySpp.png",
width=8,
height=5, units="in", res = 350 )
grid.draw(tminplot)
dev.off()
