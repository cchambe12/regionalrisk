scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) + ggtitle("B")
#nao.df<-bb%>%
#  group_by(lat.long, cc)%>%
#  summarise(count=n(), nao=mean(m.index), fs=mean(fs.count)) %>%
#  collect
nao.p<-ggplot(bb.samp, aes(x=m.index, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("NAO Index") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"), legend.position = "none") +
coord_cartesian(xlim=c(-1.5, 0.75), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) +ggtitle("C")
#space.df<-bb%>%
#  group_by(lat.long, cc)%>%
#  summarise(count=n(), space=mean(space), fs=mean(fs.count)) %>%
#  collect
space.p<-ggplot(bb.samp, aes(x=space, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("Space") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines")) +
coord_cartesian(xlim=c(-50, 100), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) +ggtitle("D")
ggarrange(elev.p, mat.p, nao.p, space.p, ncol=2, nrow=2)
#### Not separated by Species
bb.samp<-bb[sample(nrow(bb), 1200, replace=FALSE),]
elev.p<-ggplot(bb.samp, aes(x=elev, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("Elevation") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"), legend.position = "none") +
coord_cartesian(xlim=c(0, 1800), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) + ggtitle("A")
mat.p<-ggplot(bb.samp, aes(x=sp.temp, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("Mean Spring Temperature") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines")) +
coord_cartesian(xlim=c(-14, 15), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) + ggtitle("B")
nao.p<-ggplot(bb.samp, aes(x=m.index, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("NAO Index") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"), legend.position = "none") +
coord_cartesian(xlim=c(-1.5, 0.75), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) +ggtitle("C")
space.p<-ggplot(bb.samp, aes(x=space, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("Space") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines")) +
coord_cartesian(xlim=c(-50, 100), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) +ggtitle("D")
ggarrange(elev.p, mat.p, nao.p, space.p, ncol=2, nrow=2)
#### Not separated by Species
bb.samp<-bb[sample(nrow(bb), 7000, replace=FALSE),]
elev.p<-ggplot(bb.samp, aes(x=elev, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("Elevation") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"), legend.position = "none") +
coord_cartesian(xlim=c(0, 1800), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) + ggtitle("A")
mat.p<-ggplot(bb.samp, aes(x=sp.temp, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("Mean Spring Temperature") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines")) +
coord_cartesian(xlim=c(-14, 15), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) + ggtitle("B")
nao.p<-ggplot(bb.samp, aes(x=m.index, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("NAO Index") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"), legend.position = "none") +
coord_cartesian(xlim=c(-1.5, 0.75), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) +ggtitle("C")
space.p<-ggplot(bb.samp, aes(x=space, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("Space") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines")) +
coord_cartesian(xlim=c(-50, 100), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) +ggtitle("D")
ggarrange(elev.p, mat.p, nao.p, space.p, ncol=2, nrow=2)
View(bb)
check<-subset(bb, select=c("lat", "long", "elev", "space"))
check<-check[!duplicated(check),]
View(check)
check<-subset(bb, select=c("lat.long", "elev", "space"))
check<-check[!duplicated(check),]
rm(list=ls())
options(stringsAsFactors = FALSE)
library(ggplot2)
library(rstanarm)
library(dplyr)
library(tidyr)
library(brms)
library(ggstance)
# Setting working directory
setwd("~/Documents/git/regionalrisk/analyses/")
########################
#### get the data
dx<-read.csv("output/fs_matspspace_old.csv", header=TRUE)
dx<-subset(dx, year>1950)
dx<-dx%>%dplyr::select(lat, long, space)
dx<-dx[!duplicated(dx),]
xx<-read.csv("output/fs_yearsitespp.csv", header=TRUE)
xx<-subset(xx, year>1950)
df<-read.csv("output/mat_fulldata.csv", header=TRUE)
df<-subset(df, year>1950)
mat<-read.csv("output/fs_bb_sitedata.csv", header=TRUE)
mat<-subset(mat, year>1950)
nao<-read.csv("output/nao_year_sp.csv", header=TRUE)
nao<-subset(nao, year>1950)
### Clean up dataframes a bit
dx<-full_join(df, dx)
dx<-dx[!duplicated(dx),]
mat<-dplyr::select(mat, species, LAT, LON, ALT)
mat<-mat%>%rename(lat=LAT)%>%rename(long=LON)%>%rename(elev=ALT)
mat$lat.long<-paste(mat$lat, mat$long)
mat<-mat[!duplicated(mat),]
bb<-full_join(mat, dx)
#### Get elevation information
bb<-bb%>%rename(sp.temp=pre.bb)
bb$cc<-ifelse(bb$year<=1983&bb$year>1950, 0, 1)
xx<-dplyr::select(xx, lat, long, species, fs.count, year)
xx<-xx[!duplicated(xx),]
bb<-full_join(bb, xx)
bb<-bb[!duplicated(bb),]
bb$fs.count<-ave(bb$fs.count, bb$year, bb$lat.long, bb$species, FUN=last)
bb$elev<-ave(bb$elev, bb$lat.long)
bb<-bb[!duplicated(bb),]
bb<-na.omit(bb)
nao<-dplyr::select(nao, species, year, m.index)
nao<-nao[!duplicated(nao),]
bb<-full_join(bb, nao)
tar.var<-c("species", "year", "lat.long")
resp.var<-c("fs.count")
bb.sub<-bb[,c(tar.var, resp.var)]
bb.sub.nodup<-bb[!duplicated(bb.sub),]
dd<-bb.sub.nodup
dd$space<-round(dd$space, digits=3)
dd<-dd[!duplicated(dd),]
check<-subset(dd, select=c("lat.long", "elev", "space"))
check<-check[!duplicated(check),]
write.csv(dd, file="~/Documents/git/regionalrisk/analyses/output/regrisk.cleaned.csv", row.names = FALSE)
dd$sm.elev<-dd$elev/100
columnstokeep <- c("species", "m.index", "sp.temp", "cc", "space", "sm.elev", "fs.count")
#columnstokeep.map <- c("space","lat", "long")
#bb.map<-subset(bb, select=columnstokeep.map)
bb.stan <- subset(dd, select=columnstokeep)
bb.stan<-bb.stan[!duplicated(bb.stan),]
#bb.map<-bb.map[!duplicated(bb.map),]
bb.stan<-na.omit(bb.stan)
#bb.stan<-bb
write.csv(bb.stan, file="~/Documents/git/regionalrisk/analyses/output/bb.brm.nointer.csv", row.names = FALSE)
#### Not separated by Species
bb.samp<-dd[sample(nrow(dd), 7000, replace=FALSE),]
elev.p<-ggplot(bb.samp, aes(x=elev, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("Elevation") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"), legend.position = "none") +
coord_cartesian(xlim=c(0, 1800), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) + ggtitle("A")
#mat.df<-bb%>%
#  group_by(lat.long, cc)%>%
#  summarise(count=n(), mat=mean(sp.temp), fs=mean(fs.count)) %>%
#  collect
mat.p<-ggplot(bb.samp, aes(x=sp.temp, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("Mean Spring Temperature") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines")) +
coord_cartesian(xlim=c(-14, 15), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) + ggtitle("B")
#nao.df<-bb%>%
#  group_by(lat.long, cc)%>%
#  summarise(count=n(), nao=mean(m.index), fs=mean(fs.count)) %>%
#  collect
nao.p<-ggplot(bb.samp, aes(x=m.index, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("NAO Index") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"), legend.position = "none") +
coord_cartesian(xlim=c(-1.5, 0.75), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) +ggtitle("C")
#space.df<-bb%>%
#  group_by(lat.long, cc)%>%
#  summarise(count=n(), space=mean(space), fs=mean(fs.count)) %>%
#  collect
space.p<-ggplot(bb.samp, aes(x=space, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("Space") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines")) +
coord_cartesian(xlim=c(-50, 100), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) +ggtitle("D")
ggarrange(elev.p, mat.p, nao.p, space.p, ncol=2, nrow=2)
bb.samp<-dd[sample(nrow(dd), 5000, replace=FALSE),]
#elev.df<-bb%>%
#  group_by(lat.long, cc)%>%
#  summarise(count=n(), elev=mean(elev), fs=mean(fs.count)) %>%
#  collect
elev.p<-ggplot(bb.samp, aes(x=elev, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("Elevation") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"), legend.position = "none") +
coord_cartesian(xlim=c(0, 1800), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) + ggtitle("A")
#mat.df<-bb%>%
#  group_by(lat.long, cc)%>%
#  summarise(count=n(), mat=mean(sp.temp), fs=mean(fs.count)) %>%
#  collect
mat.p<-ggplot(bb.samp, aes(x=sp.temp, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("Mean Spring Temperature") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines")) +
coord_cartesian(xlim=c(-14, 15), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) + ggtitle("B")
#nao.df<-bb%>%
#  group_by(lat.long, cc)%>%
#  summarise(count=n(), nao=mean(m.index), fs=mean(fs.count)) %>%
#  collect
nao.p<-ggplot(bb.samp, aes(x=m.index, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("NAO Index") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"), legend.position = "none") +
coord_cartesian(xlim=c(-1.5, 0.75), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) +ggtitle("C")
#space.df<-bb%>%
#  group_by(lat.long, cc)%>%
#  summarise(count=n(), space=mean(space), fs=mean(fs.count)) %>%
#  collect
space.p<-ggplot(bb.samp, aes(x=space, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("Space") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines")) +
coord_cartesian(xlim=c(-50, 100), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) +ggtitle("D")
ggarrange(elev.p, mat.p, nao.p, space.p, ncol=2, nrow=2)
#### Not separated by Species
bb.samp<-dd[sample(nrow(dd), 3500, replace=FALSE),]
elev.p<-ggplot(bb.samp, aes(x=elev, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("Elevation") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"), legend.position = "none") +
coord_cartesian(xlim=c(0, 1800), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) + ggtitle("A")
#mat.df<-bb%>%
#  group_by(lat.long, cc)%>%
#  summarise(count=n(), mat=mean(sp.temp), fs=mean(fs.count)) %>%
#  collect
mat.p<-ggplot(bb.samp, aes(x=sp.temp, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("Mean Spring Temperature") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines")) +
coord_cartesian(xlim=c(-14, 15), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) + ggtitle("B")
#nao.df<-bb%>%
#  group_by(lat.long, cc)%>%
#  summarise(count=n(), nao=mean(m.index), fs=mean(fs.count)) %>%
#  collect
nao.p<-ggplot(bb.samp, aes(x=m.index, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("NAO Index") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"), legend.position = "none") +
coord_cartesian(xlim=c(-1.5, 0.75), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) +ggtitle("C")
#space.df<-bb%>%
#  group_by(lat.long, cc)%>%
#  summarise(count=n(), space=mean(space), fs=mean(fs.count)) %>%
#  collect
space.p<-ggplot(bb.samp, aes(x=space, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("Space") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines")) +
coord_cartesian(xlim=c(-50, 100), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) +ggtitle("D")
ggarrange(elev.p, mat.p, nao.p, space.p, ncol=2, nrow=2)
bb.samp<-dd[sample(nrow(dd), 3500, replace=FALSE),]
#elev.df<-bb%>%
#  group_by(lat.long, cc)%>%
#  summarise(count=n(), elev=mean(elev), fs=mean(fs.count)) %>%
#  collect
elev.p<-ggplot(bb.samp, aes(x=elev, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("Elevation") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"), legend.position = "none") +
coord_cartesian(xlim=c(0, 1800), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) + ggtitle("A")
#mat.df<-bb%>%
#  group_by(lat.long, cc)%>%
#  summarise(count=n(), mat=mean(sp.temp), fs=mean(fs.count)) %>%
#  collect
mat.p<-ggplot(bb.samp, aes(x=sp.temp, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("Mean Spring Temperature") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines")) +
coord_cartesian(xlim=c(-14, 15), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) + ggtitle("B")
#nao.df<-bb%>%
#  group_by(lat.long, cc)%>%
#  summarise(count=n(), nao=mean(m.index), fs=mean(fs.count)) %>%
#  collect
nao.p<-ggplot(bb.samp, aes(x=m.index, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("NAO Index") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"), legend.position = "none") +
coord_cartesian(xlim=c(-1.5, 0.75), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) +ggtitle("C")
#space.df<-bb%>%
#  group_by(lat.long, cc)%>%
#  summarise(count=n(), space=mean(space), fs=mean(fs.count)) %>%
#  collect
space.p<-ggplot(bb.samp, aes(x=space, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("Space") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines")) +
coord_cartesian(xlim=c(-50, 100), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) +ggtitle("D")
ggarrange(elev.p, mat.p, nao.p, space.p, ncol=2, nrow=2)
bb.samp<-dd[sample(nrow(dd), 3500, replace=FALSE),]
#elev.df<-bb%>%
#  group_by(lat.long, cc)%>%
#  summarise(count=n(), elev=mean(elev), fs=mean(fs.count)) %>%
#  collect
elev.p<-ggplot(bb.samp, aes(x=elev, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("Elevation") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"), legend.position = "none") +
coord_cartesian(xlim=c(0, 1800), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) + ggtitle("A")
#mat.df<-bb%>%
#  group_by(lat.long, cc)%>%
#  summarise(count=n(), mat=mean(sp.temp), fs=mean(fs.count)) %>%
#  collect
mat.p<-ggplot(bb.samp, aes(x=sp.temp, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("Mean Spring Temperature") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines")) +
coord_cartesian(xlim=c(-14, 15), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) + ggtitle("B")
#nao.df<-bb%>%
#  group_by(lat.long, cc)%>%
#  summarise(count=n(), nao=mean(m.index), fs=mean(fs.count)) %>%
#  collect
nao.p<-ggplot(bb.samp, aes(x=m.index, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("NAO Index") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"), legend.position = "none") +
coord_cartesian(xlim=c(-1.5, 0.75), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) +ggtitle("C")
#space.df<-bb%>%
#  group_by(lat.long, cc)%>%
#  summarise(count=n(), space=mean(space), fs=mean(fs.count)) %>%
#  collect
space.p<-ggplot(bb.samp, aes(x=space, y=fs.count)) + geom_line(aes(col=as.factor(cc)),stat="smooth",method="lm") + xlab("Space") + ylab("Average Number \n of False Springs") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines")) +
coord_cartesian(xlim=c(-50, 100), ylim=c(0, 9)) +
scale_color_manual(values=c("red4", "blue3"), labels=c("Before 1983", "After 1983"), name="") +
geom_jitter(alpha=0.1, aes(shape=as.factor(cc))) +
scale_shape_manual(values=c(3, 5), labels=c("Before 1983", "After 1983"), name="") + guides(shape = guide_legend(override.aes = list(alpha=1))) +
scale_y_continuous(expand = c(0, 0)) +ggtitle("D")
ggarrange(elev.p, mat.p, nao.p, space.p, ncol=2, nrow=2)
brm.full.nointer<-brm(fs.count~m.index+sp.temp+cc+sm.elev+m.index:cc + sp.temp:cc +sm.elev:cc +
(m.index+sp.temp+cc+sm.elev|species), data=bb.samp, chains=2,cores=2)
m<-brm.full.nointer
m.int<-posterior_interval(m)
sum.m<-summary(m)
cri.f<-as.data.frame(sum.m$fixed[,c("Estimate", "l-95% CI", "u-95% CI")])
cri.f<-cri.f[-1,] #removing the intercept
fdf1<-as.data.frame(rbind(as.vector(cri.f[,1]), as.vector(cri.f[,2]), as.vector(cri.f[,3])))
fdf2<-cbind(fdf1, c(0, 0, 0) , c("Estimate", "2.5%", "95%"))
names(fdf2)<-c(rownames(cri.f), "species", "perc")
cri.r<-(ranef(m, summary = TRUE, robust = FALSE,
probs = c(0.025, 0.975)))$species
cri.r2<-cri.r[, ,-1]
cri.r2<-cri.r2[,-2,]
dims<-dim(cri.r2)
twoDimMat <- matrix(cri.r2, prod(dims[1:2]), dims[3])
mat2<-cbind(twoDimMat, c(rep(1:6, length.out=18)), rep(c("Estimate", "2.5%", "95%"), each=6))
df<-as.data.frame(mat2)
names(df)<-c(rownames(cri.f), "species", "perc")
brm.full.nointer
mat2<-cbind(twoDimMat, c(rep(1:6, length.out=24)), rep(c("Estimate", "2.5%", "95%"), each=6))
mat2<-cbind(twoDimMat, c(rep(1:6, length.out=30)), rep(c("Estimate", "2.5%", "95%"), each=6))
mat2<-cbind(twoDimMat, c(rep(1:6, length.out=36)), rep(c("Estimate", "2.5%", "95%"), each=6))
mat2<-cbind(twoDimMat, c(rep(1:6, length.out=18)), rep(c("Estimate", "2.5%", "95%"), each=6))
df<-as.data.frame(mat2)
names(df)<-c(rownames(cri.f), "species", "perc")
View(df)
summary(brm.full.nointer)$summary
summary(brm.full.nointer)
sumer.wi <- summary(brm.full.nointer)
sumer.wi[c("m.index", "sp.temp", "sm.elev", "cc","nao"),]
View(sumer.wi)
sumer.wi <- summary(brm.full.nointer)$summary
summary(brm.full.nointer)
sumer.wi <- as.data.frame(summary(brm.full.nointer))
View(dd)
space<-subset(dd, select=c("space", "elev"))
space<-space[!duplicated(space),]
View(space)
