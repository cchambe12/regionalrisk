axis.title = element_blank(),
panel.background = element_rect(fill="grey95")) +
ggtitle("Aesculus hippocastanum", col="#7FC97F") + sc +
labs(color="Day of Budburst")
aes <- ggplot() +
geom_polygon(aes(x = mapWorld$long, y = mapWorld$lat, group = mapWorld$group),
color = 'gray', fill="lightgrey", size = .2) +
geom_jitter(width=3,aes(x=a.site$long, y=a.site$lat, color=a.site$bb), size=0.8, alpha=0.4) + theme_classic() +
coord_cartesian(ylim=c(30,70),xlim=c(-10,35))+
theme(panel.border = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
legend.position = "none",
axis.title = element_blank(),
panel.background = element_rect(fill="grey95")) +
annotate("text",label= "Aesculus hippocastanum", col="#7FC97F", x=5, y=70,fontface="bolditalic", size=3) + sc +
labs(color="Day of Budburst")
aes
aes <- ggplot() +
geom_polygon(aes(x = mapWorld$long, y = mapWorld$lat, group = mapWorld$group),
color = 'gray', fill="lightgrey", size = .2) +
geom_jitter(width=3,aes(x=a.site$long, y=a.site$lat, color=a.site$bb), size=0.8, alpha=0.4) + theme_classic() +
coord_cartesian(ylim=c(30,70),xlim=c(-10,35))+
theme(panel.border = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
legend.position = "none",
axis.title = element_blank(),
panel.background = element_rect(fill="grey95")) +
annotate("text",label= "Aesculus hippocastanum", col="#7FC97F", x=5, y=70,fontface="bold.italic", size=3) + sc +
labs(color="Day of Budburst")
aes
aes <- ggplot() +
geom_polygon(aes(x = mapWorld$long, y = mapWorld$lat, group = mapWorld$group),
color = 'gray', fill="lightgrey", size = .2) +
geom_jitter(width=3,aes(x=a.site$long, y=a.site$lat, color=a.site$bb), size=0.8, alpha=0.4) + theme_classic() +
coord_cartesian(ylim=c(30,70),xlim=c(-10,35))+
theme(panel.border = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
legend.position = "none",
axis.title = element_blank(),
panel.background = element_rect(fill="grey95")) +
annotate("text",label= "Aesculus hippocastanum", col="#7FC97F", x=5, y=70,fontface="bold.italic", size=3,
family="Helvetica") + sc +
labs(color="Day of Budburst")
aes
aln <- ggplot() +
geom_polygon(aes(x = mapWorld$long, y = mapWorld$lat, group = mapWorld$group),
color = 'gray', fill="lightgrey", size = .2) +
geom_jitter(width=3,aes(x=ag.site$long, y=ag.site$lat, color=ag.site$bb), size=0.8, alpha=0.4) + theme_classic() +
coord_cartesian(ylim=c(30,70),xlim=c(-10,35))+
theme(panel.border = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
panel.background = element_rect(fill="grey95")) +
annotate("text",label= "Alnus glutinosa", col="#FDD98D", x=0, y=70,fontface="bold.italic", size=3,
family="Helvetica") + sc +
labs(color="Day of Budburst")
bet <- ggplot() +
geom_polygon(aes(x = mapWorld$long, y = mapWorld$lat, group = mapWorld$group),
color = 'gray', fill="lightgrey", size = .2) +
geom_jitter(width=3,aes(x=b.site$long, y=b.site$lat, color=b.site$bb), size=0.8, alpha=0.4) + theme_classic() +
coord_cartesian(ylim=c(30,70),xlim=c(-10,35))+
theme(panel.border = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
legend.position = "none",
axis.title = element_blank(),
panel.background = element_rect(fill="grey95")) +
annotate("text",label= "Betula pendula", col="#CAB1C4", x=0, y=70,fontface="bold.italic", size=3,
family="Helvetica") + sc +
labs(color="Day of Budburst")
syl <- ggplot() +
geom_polygon(aes(x = mapWorld$long, y = mapWorld$lat, group = mapWorld$group),
color = 'gray', fill="lightgrey", size = .2) +
geom_jitter(width=3,aes(x=f.site$long, y=f.site$lat, color=f.site$bb), size=0.8, alpha=0.4) + theme_classic() +
coord_cartesian(ylim=c(30,70),xlim=c(-10,35))+
theme(panel.border = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
legend.position = "none",
axis.title = element_blank(),
panel.background = element_rect(fill="grey95")) +
annotate("text",label= "Fagus sylvatica", col="#CB1788", x=0, y=70,fontface="bold.italic", size=3,
family="Helvetica") + sc +
labs(color="Day of Budburst")
fra <- ggplot() +
geom_polygon(aes(x = mapWorld$long, y = mapWorld$lat, group = mapWorld$group),
color = 'gray', fill="lightgrey", size = .2) +
geom_jitter(width=3,aes(x=fe.site$long, y=fe.site$lat, color=fe.site$bb), size=0.8, alpha=0.4) + theme_classic() +
coord_cartesian(ylim=c(30,70),xlim=c(-10,35))+
theme(panel.border = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
panel.background = element_rect(fill="grey95")) +
annotate("text",label= "Fraxinus excelsior", col="#BF5B17", x=2, y=70,fontface="bold.italic", size=3,
family="Helvetica") + sc +
labs(color="Day of Budburst")
que <- ggplot() +
geom_polygon(aes(x = mapWorld$long, y = mapWorld$lat, group = mapWorld$group),
color = 'gray', fill="lightgrey", size = .2) +
geom_jitter(width=3,aes(x=q.site$long, y=q.site$lat, color=q.site$bb), size=0.8, alpha=0.4) +
theme_classic() +
coord_cartesian(ylim=c(30,70),xlim=c(-10,35))+
theme(panel.border = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
legend.position = "none",
axis.title = element_blank(),
panel.background = element_rect(fill="grey95")) +
annotate("text",label= "Quercus robur", col="#87A6A6", x=0, y=70,fontface="bold.italic", size=3,
family="Helvetica") + sc +
labs(color="Day of Budburst")
ggarrange(aes, bet, aln, que, syl, fra, ncol=3, nrow=2)
fra <- ggplot() +
geom_polygon(aes(x = mapWorld$long, y = mapWorld$lat, group = mapWorld$group),
color = 'gray', fill="lightgrey", size = .2) +
geom_jitter(width=3,aes(x=fe.site$long, y=fe.site$lat, color=fe.site$bb), size=0.8, alpha=0.4) + theme_classic() +
coord_cartesian(ylim=c(30,70),xlim=c(-10,35))+
theme(panel.border = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
panel.background = element_rect(fill="grey95")) +
annotate("text",label= "Fraxinus excelsior", col="#BF5B17", x=3, y=70,fontface="bold.italic", size=3,
family="Helvetica") + sc +
labs(color="Day of Budburst")
aes <- ggplot() +
geom_polygon(aes(x = mapWorld$long, y = mapWorld$lat, group = mapWorld$group),
color = 'gray', fill="lightgrey", size = .2) +
geom_jitter(width=3,aes(x=a.site$long, y=a.site$lat, color=a.site$bb), size=0.8, alpha=0.4) + theme_classic() +
coord_cartesian(ylim=c(30,70),xlim=c(-10,35))+
theme(panel.border = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
legend.position = "none",
axis.title = element_blank(),
panel.background = element_rect(fill="grey95")) +
annotate("text",label= "Aesculus hippocastanum", col="#7FC97F", x=8, y=70,fontface="bold.italic", size=3,
family="Helvetica") + sc +
labs(color="Day of Budburst")
aln <- ggplot() +
geom_polygon(aes(x = mapWorld$long, y = mapWorld$lat, group = mapWorld$group),
color = 'gray', fill="lightgrey", size = .2) +
geom_jitter(width=3,aes(x=ag.site$long, y=ag.site$lat, color=ag.site$bb), size=0.8, alpha=0.4) + theme_classic() +
coord_cartesian(ylim=c(30,70),xlim=c(-10,35))+
theme(panel.border = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
panel.background = element_rect(fill="grey95")) +
annotate("text",label= "Alnus glutinosa", col="#FDD98D", x=1, y=70,fontface="bold.italic", size=3,
family="Helvetica") + sc +
labs(color="Day of Budburst")
ggarrange(aes, bet, aln, que, syl, fra, ncol=3, nrow=2)
aes <- ggplot() +
geom_polygon(aes(x = mapWorld$long, y = mapWorld$lat, group = mapWorld$group),
color = 'gray', fill="lightgrey", size = .2) +
geom_jitter(width=3,aes(x=a.site$long, y=a.site$lat, color=a.site$bb), size=0.8, alpha=0.4) + theme_classic() +
coord_cartesian(ylim=c(30,70),xlim=c(-10,35))+
theme(panel.border = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
legend.position = "none",
axis.title = element_blank(),
panel.background = element_rect(fill="grey95")) +
annotate("text",label= "Aesculus \nhippocastanum", col="#7FC97F", x=8, y=70,fontface="bold.italic", size=3,
family="Helvetica") + sc +
labs(color="Day of Budburst")
ggarrange(aes, bet, aln, que, syl, fra, ncol=3, nrow=2)
aes <- ggplot() +
geom_polygon(aes(x = mapWorld$long, y = mapWorld$lat, group = mapWorld$group),
color = 'gray', fill="lightgrey", size = .2) +
geom_jitter(width=3,aes(x=a.site$long, y=a.site$lat, color=a.site$bb), size=0.8, alpha=0.4) + theme_classic() +
coord_cartesian(ylim=c(30,70),xlim=c(-10,35))+
theme(panel.border = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
legend.position = "none",
axis.title = element_blank(),
panel.background = element_rect(fill="grey95")) +
annotate("text",label= "Aesculus \n hippocastanum", col="#7FC97F", x=1, y=69,fontface="bold.italic", size=3,
family="Helvetica") + sc +
labs(color="Day of Budburst")
ggarrange(aes, bet, aln, que, syl, fra, ncol=3, nrow=2)
aes <- ggplot() +
geom_polygon(aes(x = mapWorld$long, y = mapWorld$lat, group = mapWorld$group),
color = 'gray', fill="lightgrey", size = .2) +
geom_jitter(width=3,aes(x=a.site$long, y=a.site$lat, color=a.site$bb), size=0.8, alpha=0.4) + theme_classic() +
coord_cartesian(ylim=c(30,70),xlim=c(-10,35))+
theme(panel.border = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
legend.position = "none",
axis.title = element_blank(),
panel.background = element_rect(fill="grey95")) +
annotate("text",label= "Aesculus \n hippocastanum", col="#7FC97F", x=1, y=69,fontface="bold.italic", size=3,
family="Helvetica", hjust=0) + sc +
labs(color="Day of Budburst")
ggarrange(aes, bet, aln, que, syl, fra, ncol=3, nrow=2)
aes <- ggplot() +
geom_polygon(aes(x = mapWorld$long, y = mapWorld$lat, group = mapWorld$group),
color = 'gray', fill="lightgrey", size = .2) +
geom_jitter(width=3,aes(x=a.site$long, y=a.site$lat, color=a.site$bb), size=0.8, alpha=0.4) + theme_classic() +
coord_cartesian(ylim=c(30,70),xlim=c(-10,35))+
theme(panel.border = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
legend.position = "none",
axis.title = element_blank(),
panel.background = element_rect(fill="grey95")) +
annotate("text",label= "Aesculus \nhippocastanum", col="#7FC97F", x=-10, y=69,fontface="bold.italic", size=3,
family="Helvetica", hjust=0) + sc +
labs(color="Day of Budburst")
ggarrange(aes, bet, aln, que, syl, fra, ncol=3, nrow=2)
aes <- ggplot() +
geom_polygon(aes(x = mapWorld$long, y = mapWorld$lat, group = mapWorld$group),
color = 'gray', fill="lightgrey", size = .2) +
geom_jitter(width=3,aes(x=a.site$long, y=a.site$lat, color=a.site$bb), size=0.8, alpha=0.4) + theme_classic() +
coord_cartesian(ylim=c(30,70),xlim=c(-10,35))+
theme(panel.border = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
legend.position = "none",
axis.title = element_blank(),
panel.background = element_rect(fill="grey95")) +
annotate("text",label= "Aesculus \nhippocastanum", col="#7FC97F", x=-12, y=68,fontface="bold.italic", size=3,
family="Helvetica", hjust=0) + sc +
labs(color="Day of Budburst")
ggarrange(aes, bet, aln, que, syl, fra, ncol=3, nrow=2)
aln <- ggplot() +
geom_polygon(aes(x = mapWorld$long, y = mapWorld$lat, group = mapWorld$group),
color = 'gray', fill="lightgrey", size = .2) +
geom_jitter(width=3,aes(x=ag.site$long, y=ag.site$lat, color=ag.site$bb), size=0.8, alpha=0.4) + theme_classic() +
coord_cartesian(ylim=c(30,70),xlim=c(-10,35))+
theme(panel.border = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
panel.background = element_rect(fill="grey95")) +
annotate("text",label= "Alnus glutinosa", col="gold2", x=1, y=70,fontface="bold.italic", size=3,
family="Helvetica") + sc +
labs(color="Day of Budburst")
ggarrange(aes, bet, aln, que, syl, fra, ncol=3, nrow=2)
### Let's just start with the PEP data and do some cleaning
bbchs<-c(7, 11)
rm(list=ls()) # remove everything currently held in the R memory
options(stringsAsFactors=FALSE)
graphics.off()
# Load libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(lubridate)
setwd("~/Documents/git/regionalrisk/analyses")
d<-read.csv("input/aeship_dvrcheck.csv", header=TRUE)
df<-subset(d, d$BBCH %in% bbchs)
### Let's just start with the PEP data and do some cleaning
bbchs<-c(7, 11)
df<-subset(d, d$BBCH %in% bbchs)
View(df)
df<-subset(df, df$YEAR>=2008)
View(df)
dx<-df%spread(BBCH, DAY)
dx<-df%>%spread(BBCH, DAY)
View(dx)
dx<-na.omit(dx)
View(dx)
dx$dvr<-dx$`11`-dx$`7`
View(dx)
ave(dx$dvr)
mean(dx$dvr)
sort(unique(dx$YEAR))
sort(unique(dx$PEP_ID))
table(dx$PEP_ID, dx$YEAR)
ave(dx$dvr, dx$PEP_ID)
rm(list=ls()) # remove everything currently held in the R memory
options(stringsAsFactors=FALSE)
graphics.off()
# Load libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(lubridate)
setwd("~/Documents/git/regionalrisk/analyses")
d<-read.csv("input/acepse_dvrcheck.csv", header=TRUE)
bbchs<-c(7, 11)
df<-subset(d, d$BBCH %in% bbchs)
df<-subset(df, df$YEAR>=2008)
dx<-df%>%spread(BBCH, DAY)
dx<-na.omit(dx)
dx$dvr<-dx$`11`-dx$`7`
mean(dx$dvr) ## 9.43 - range of years is 2008-2014; 62 sites; most years at one site is 4
ave(dx$dvr, dx$PEP_ID)
sort(unique(dx$YEAR))
length(unique(dx$PEP_ID))
table(dx$PEP_ID, dx$YEAR)
rm(list=ls()) # remove everything currently held in the R memory
options(stringsAsFactors=FALSE)
graphics.off()
# Load libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(lubridate)
### Load data
setwd("~/Documents/git/regionalrisk/analyses/output")
d<-read.csv("~/Documents/git/springfreeze/input/Budburst.clean.csv",header=TRUE)
View(d)
d<-subset(d, select=c("sp", "lday", "bday"))
d<-na.omit(d)
d$dvr<-d$lday-d$bday
d$dvr.sp<-ave(d$dvr, d$sp)
View(d)
d<-read.csv("~/Documents/git/springfreeze/input/Budburst.clean.csv",header=TRUE)
d<-subset(d, select=c("sp", "lday", "bday","tx"))
d<-subset(d, select=c("sp", "lday", "bday","treatcode"))
d<-na.omit(d)
d$dvr<-d$lday-d$bday
View(d)
d$dvr.sp<-ave(d$dvr, d$sp, d$treatcode)
View(d)
dx<-subset(d, select=c("sp", "dvr.sp", "treatcode"))
dx<-dx[!duplicated(dx),]
View(dx)
dx<-subset(d, select=c("sp", "dvr.sp", "treatcode", "dvr"))
dx<-dx[!duplicated(dx),]
dx$avg.dvr<-ave(dx$dvr, dx$sp)
View(dx)
rm(list=ls()) # remove everything currently held in the R memory
options(stringsAsFactors=FALSE)
graphics.off()
# Load libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(lubridate)
### Load data
setwd("~/Documents/git/regionalrisk/analyses/output")
bp<-read.csv("betpen_data.csv", header=TRUE)
fs<-read.csv("fagsyl_data.csv", header=TRUE)
fe<-read.csv("fraexc_data.csv", header=TRUE)
qr<-read.csv("querob_data.csv", header=TRUE)
ah<-read.csv("aeship_data.csv", header=TRUE)
ag<-read.csv("alnglu_data_dvr.csv", header=TRUE)
#d<-read.csv("~/Documents/git/springfreeze/input/Budburst.clean.csv",header=TRUE)
#tx<-c("CL0", "WL1")
#d<-d[(d$treatcode%in%tx),]
#d<-subset(d, select=c("sp", "lday", "bday","treatcode"))
#d<-na.omit(d)
#d$dvr<-d$lday-d$bday
#d$dvr.sp<-ave(d$dvr, d$sp, d$treatcode)
#dx<-subset(d, select=c("sp", "dvr.sp", "treatcode", "dvr"))
#dx<-dx[!duplicated(dx),]
#dx$avg.dvr<-ave(dx$dvr, dx$sp)
## Start looking at the data a bit...
bp$fs<- ifelse(bp$Tmin<=-2.2, 1, 0)
bp$lo<-ave(bp$PEP_ID, bp$year, FUN=max)
bp$bb<-bp$lo-10 # Based on Danf's BETPAP - most closely related. Choose WL0 based on keeping all species consistent
bp<-bp[!duplicated(bp),]
bp$fs.count<- ave(bp$fs, bp$PEP_ID, bp$year, FUN=sum)
betpen<-bp%>%dplyr::select(lat, long, PEP_ID, fs.count, year)
betpen<-betpen[!duplicated(betpen),]
betpen<-na.omit(betpen)
betpen$species<-"BETPEN"
betpen$fs<-ifelse(betpen$fs.count>=1, 1, 0) # 155251
#betpen<-dplyr::select(betpen, -fs.count)
ah$fs<- ifelse(ah$Tmin<=-2.2, 1, 0)
ah$lo<-ave(ah$PEP_ID, ah$year, FUN=max)
ah$bb<-ah$lo-7 # Based on Danf's ACESAC - most closely related. Choose WL0 based on keeping all species consistent
ah<-ah[!duplicated(ah),]
ah$fs.count<- ave(ah$fs, ah$PEP_ID, ah$year, FUN=sum)
aeship<-ah%>%dplyr::select(lat, long, PEP_ID, fs.count, year)
aeship<-aeship[!duplicated(aeship),]
aeship<-na.omit(aeship)
aeship$species<-"AESHIP"
aeship$fs<-ifelse(aeship$fs.count>=1, 1, 0)
#aeship<-dplyr::select(aeship, -fs.count) #156836
d<-full_join(betpen, aeship)
ag$fs<- ifelse(ag$Tmin<=-2.2, 1, 0)
ag$lo<-ave(ag$PEP_ID, ag$year, FUN=max)
ag$bb<-ag$lo-15 # Based on Danf's ALNINC - most closely related. Choose WL0 based on keeping all species consistent
ag<-ag[!duplicated(ag),]
ag$fs.count<- ave(ag$fs, ag$PEP_ID, ag$year, FUN=sum)
alnglu<-ag%>%dplyr::select(lat, long, PEP_ID, fs.count, year)
alnglu<-alnglu[!duplicated(alnglu),]
alnglu<-na.omit(alnglu)
alnglu$species<-"ALNGLU"
alnglu$fs<-ifelse(alnglu$fs.count>=1, 1, 0)
#alnglu<-dplyr::select(alnglu, -fs.count) #91182
d<-full_join(d, alnglu)
fe$fs<- ifelse(fe$Tmin<=-2.2, 1, 0)
fe$lo<-ave(fe$PEP_ID, fe$year, FUN=max)
fe$bb<-fe$lo-6 # Based on Danf's FRANIG - most closely related. Choose WL0 based on keeping all species consistent
fe<-fe[!duplicated(fe),]
fe$fs.count<- ave(fe$fs, fe$PEP_ID, fe$year, FUN=sum)
fraexc<-fe%>%dplyr::select(lat, long, PEP_ID, fs.count, year)
fraexc<-fraexc[!duplicated(fraexc),]
fraexc<-na.omit(fraexc)
fraexc$species<-"FRAEXC"
fraexc$fs<-ifelse(fraexc$fs.count>=1, 1, 0)
#fraexc<-dplyr::select(fraexc, -fs.count) #92665
d<-full_join(d, fraexc)
fs$fs<- ifelse(fs$Tmin<=-2.2, 1, 0)
fs$lo<-ave(fs$doy, fs$year, fs$PEP_ID, FUN=last)
fs$bb<-fs$lo-11 # Based on Danf's FAGGRA - most closely related. Choose WL0 based on keeping all species consistent
fs<-fs[!duplicated(fs),]
fs$foo<-paste(fs$year, fs$PEP_ID)
fs<-fs[!(fs$doy<fs$bb),]
fs$fs.count<- ave(fs$fs, fs$PEP_ID, fs$year, FUN=sum)
fagsyl<-fs%>%dplyr::select(lat, long, PEP_ID, fs.count, year)
fagsyl<-fagsyl[!duplicated(fagsyl),]
fagsyl<-na.omit(fagsyl)
fagsyl$species<-"FAGSYL"
fagsyl$fs<-ifelse(fagsyl$fs.count>=1, 1, 0)
#fagsyl<-dplyr::select(fagsyl, -fs.count) #129133
d<-full_join(d, fagsyl)
qr$fs<- ifelse(qr$Tmin<=-2.2, 1, 0)
qr$lo<-ave(qr$doy, qr$year, qr$PEP_ID, FUN=last)
qr$bb<-qr$lo-9 # Based on Danf's QUEALB - most closely related. Choose WL0 based on keeping all species consistent
qr<-qr[!duplicated(qr),]
qr$fs.count<- ave(qr$fs, qr$PEP_ID, qr$year, FUN=sum)
querob<-qr%>%dplyr::select(lat, long, PEP_ID, fs.count, year)
querob<-querob[!duplicated(querob),]
querob<-na.omit(querob)
querob$species<-"QUEROB"
querob$fs<-ifelse(querob$fs.count>=1, 1, 0)
#querob<-dplyr::select(querob, -fs.count) # 131635
d<-full_join(d, querob)
write.csv(d, file="~/Documents/git/regionalrisk/analyses/output/fs_dvr_cleaned.csv", row.names = FALSE)
rm(list=ls())
options(stringsAsFactors = FALSE)
library(ggplot2)
library(rstanarm)
library(dplyr)
library(tidyr)
library(brms)
library(jtools)
#library(ggmap)
#library(rworldmap)
#library(maps)
#library(mapdata)
#library(marmap)
#library(RColorBrewer)
#library(raster)
# Setting working directory
setwd("~/Documents/git/regionalrisk/analyses/")
dx<-read.csv("output/fs_space_new.csv", header=TRUE)
#xx<-read.csv("output/fs_yearsitespp.csv", header=TRUE)
#xx<-subset(xx, year>1950)
dx<-subset(dx, select=c("lat", "long", "lat.long", "eigen", "distkm", "elev", "mst", "nao", "year", "species", "cc"))
#xx<-read.csv("output/fs_yearsitespp_5.csv", header=TRUE)
xx<-read.csv("output/fs_dvr_cleaned.csv", header=TRUE)
xx<-subset(xx, select=c("lat", "long", "fs.count", "year", "species", "fs"))
bb<-full_join(dx, xx)
bb<-bb[!duplicated(bb),]
bb<-na.omit(bb)
write.csv(bb, file="~/Documents/git/regionalrisk/analyses/output/fs_newdvr_space.csv", row.names = FALSE)
