scale_y_continuous(sec.axis = sec_axis(~.-1.286667, name="Avg Day of Budburst", labels=c(0,85,105,135)))
all
all<-ggplot(dxx, aes(x=year, y=fs.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites with False Springs") +
geom_hline(yintercept=dxx$fs.ave, linetype="dashed", color="blue") + geom_line(aes(y=m.index+2.54), col="blue") +
scale_y_continuous(sec.axis = sec_axis(~.-1.286667, name="Avg Day of Budburst", labels=c(0,85,105,135)))
all
all<-ggplot(dxx, aes(x=year, y=fs.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites with False Springs") +
geom_hline(yintercept=dxx$fs.ave, linetype="dashed", color="blue") + geom_line(aes(y=m.index+1.286667), col="blue") +
scale_y_continuous(sec.axis = sec_axis(~.-1.286667, name="Avg Day of Budburst")
############### Look at each individual species now... ###################
aeship<-subset(xx, species=="AESHIP")
ahip<-ggplot(aeship, aes(x=year, y=spp.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites \n with False Springs") +
#geom_hline(yintercept=aeship$spp.ave, linetype="dashed", color="firebrick3")
coord_cartesian(ylim=c(0,0.65)) +
#geom_vline(xintercept=c(1968, 2012), linetype="dashed", color="darkgreen") + geom_vline(xintercept=c(1994), linetype="dashed", color="red") +
ggtitle(expression(paste(italic("Aesculus hippocastanum")))) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"),
plot.title=element_text(colour = "firebrick3"))+ #annotate("text",label= "Avg. Day of Budburst = 99.24", col="firebrick3", x=1980, y=0.65, size=2)
geom_line(aes(y=sx/2.54), col="blue", stat="smooth", alpha=0.6, method="auto") + scale_y_continuous(sec.axis = sec_axis(~.*2.54, name="Avg Day of Budburst", labels=c(0,85,105,135)))
alnglu<-subset(xx, species=="ALNGLU")
aglu<-ggplot(alnglu, aes(x=year, y=spp.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites \n with False Springs") +
coord_cartesian(ylim=c(0, 0.65)) +
#geom_vline(xintercept=c(1968, 2012), linetype="dashed", color="darkgreen") + geom_vline(xintercept=c(1994), linetype="dashed", color="red") +
ggtitle(expression(paste(italic("Alnus glutinosa")))) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), axis.ticks.y = element_blank(), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"),
plot.title=element_text(colour = "orangered1")) +
#+ annotate("text",label= "Avg. Day of Budburst = 98.91", col="orangered1", x=1980, y=0.65, size=2)
geom_line(aes(y=sx/2.54), col="blue", stat="smooth", alpha=0.6, method="auto") + scale_y_continuous(sec.axis = sec_axis(~.*2.54, name="Avg Day of Budburst", labels=c(0,85,105,135)))
betpen<-subset(xx, species=="BETPEN")
bpen<-ggplot(betpen, aes(x=year, y=spp.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites \n with False Springs") +
#geom_hline(yintercept=betpen$spp.ave, linetype="dashed", color="orange3")
coord_cartesian(ylim=c(0, 0.65)) +
#geom_vline(xintercept=c(1968, 2012), linetype="dashed", color="darkgreen") + geom_vline(xintercept=c(1994), linetype="dashed", color="red") +
ggtitle(expression(paste(italic("Betula pendula")))) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), axis.ticks.y = element_blank(), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"),
plot.title=element_text(colour = "orange3")) +
#+ annotate("text",label= "Avg. Day of Budburst = 98.77", col="orange3", x=1980, y=0.65, size=2)
geom_line(aes(y=sx/2.54), col="blue", stat="smooth", alpha=0.6, method="auto") + scale_y_continuous(sec.axis = sec_axis(~.*2.54, name="Avg Day of Budburst", labels=c(0,85,105,135)))
fagsyl<-subset(xx, species=="FAGSYL")
fsyl<-ggplot(fagsyl, aes(x=year, y=spp.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites \n with False Springs") +
#geom_hline(yintercept=fagsyl$spp.ave, linetype="dashed", color="sienna2")
coord_cartesian(ylim=c(0, 0.65)) +
#geom_vline(xintercept=c(1968, 2012), linetype="dashed", color="darkgreen") + geom_vline(xintercept=c(1994), linetype="dashed", color="red") +
ggtitle(expression(paste(italic("Fagus sylvatica"))))+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), axis.ticks.y = element_blank(), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"),
plot.title=element_text(colour = "sienna2")) +
#+ annotate("text",label= "Avg. Day of Budburst = 106.74", col="sienna2", x=1980, y=0.65, size=2)
geom_line(aes(y=sx/2.54), col="blue", stat="smooth", alpha=0.6, method="auto") + scale_y_continuous(sec.axis = sec_axis(~.*2.54, name="Avg Day of Budburst", labels=c(0,85,105,135)))
fraexc<-subset(xx, species=="FRAEXC")
fexc<-ggplot(fraexc, aes(x=year, y=spp.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites \n with False Springs") +
#geom_hline(yintercept=fraexc$spp.ave, linetype="dashed", color="green4")
coord_cartesian(ylim=c(0, 0.65)) +
#geom_vline(xintercept=c(1968, 2012), linetype="dashed", color="darkgreen") + geom_vline(xintercept=c(1994), linetype="dashed", color="red") +
ggtitle(expression(paste(italic("Fraxinus excelsior")))) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), axis.ticks.y = element_blank(), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"),
plot.title=element_text(colour = "green4"))+
#+ annotate("text",label= "Avg. Day of Budburst = 116.34", col="green4", x=1980, y=0.65, size=2)
geom_line(aes(y=sx/2.54), col="blue", stat="smooth", alpha=0.6, method="auto") + scale_y_continuous(sec.axis = sec_axis(~.*2.54, name="Avg Day of Budburst", labels=c(0,85,105,135)))
querob<-subset(xx, species=="QUEROB")
qrob<-ggplot(querob, aes(x=year, y=spp.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites \n with False Springs") +
#geom_hline(yintercept=querob$spp.ave, linetype="dashed", color="purple2")
coord_cartesian(ylim=c(0, 0.65)) +
#geom_vline(xintercept=c(1968, 2012), linetype="dashed", color="darkgreen") + geom_vline(xintercept=c(1994), linetype="dashed", color="red") +
ggtitle(expression(paste(italic("Quercus robur")))) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), axis.ticks.y = element_blank(), legend.key=element_blank(),
plot.margin = unit(c(1.5,1.5,1.5,1.5), "lines"),
plot.title=element_text(colour = "purple2"))+
#+ annotate("text",label= "Avg. Day of Budburst = 113.04", col="purple2", x=1980, y=0.65, size=2)
geom_line(aes(y=sx/2.54), col="blue", stat="smooth", alpha=0.6, method="auto") + scale_y_continuous(sec.axis = sec_axis(~.*2.54, name="Avg Day of Budburst", labels=c(0,85,105,135)))
quartz()
ggarrange(ahip, aglu, bpen, fsyl, fexc, qrob, ncol=3, nrow=2)
quartz()
ggplot(bb.check, aes(x=year, y=bb))+geom_point(aes(col=lat), alpha=0.2)+ geom_line(aes(y=bb, x=year), stat="smooth", method="lm") + coord_cartesian(ylim=c(0, 200)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"), axis.ticks.y = element_blank(), legend.key=element_blank()) +
facet_wrap(~species)
############# Add in Budburst data? ###########################
bb.aes<-read.csv("output/bbch_region_aesculus.csv", header=TRUE)
bb.ag<-read.csv("output/bbch_region_alnus.csv", header=TRUE)
bb.bp<-read.csv("output/bbch_region_betula.csv", header=TRUE)
bb.fsyl<-read.csv("output/bbch_region_fagus.csv", header=TRUE)
bb.fex<-read.csv("output/bbch_region_fraxinus.csv", header=TRUE)
bb.qr<-read.csv("output/bbch_region_quercus.csv", header=TRUE)
## Using BBCH 11 for analysis
# AESHIP
bb.aes$lat.long<-paste(bb.aes$LAT, bb.aes$LON)
bb.aes<-bb.aes%>%filter(BBCH==11)%>%filter(YEAR>=1950)
bb.aes$leafout<-ave(bb.aes$DAY) ## 111.24
bb.aes$bb<-bb.aes$DAY-12
bb.aes$cc<-ifelse(bb.aes$YEAR<=1983, 0, 1)
bb.aes$bb.cc<-ave(bb.aes$bb, bb.aes$cc) ## 0 = 114.27 & 1 = 107.28
bb.aes$decade<-substr(bb.aes$YEAR,3,3)
bb.aes$bb.decade<-NA
bb.aes$bb.decade<-ifelse(bb.aes$decade==5, 1, bb.aes$bb.dec)
bb.aes$bb.decade<-ifelse(bb.aes$decade==6, 2, bb.aes$bb.dec)
bb.aes$bb.decade<-ifelse(bb.aes$decade==7, 3, bb.aes$bb.dec)
bb.aes$bb.decade<-ifelse(bb.aes$decade==8, 4, bb.aes$bb.dec)
bb.aes$bb.decade<-ifelse(bb.aes$decade==9, 5, bb.aes$bb.dec)
bb.aes$bb.decade<-ifelse(bb.aes$decade==0, 6, bb.aes$bb.dec)
bb.aes$bb.decade<-ifelse(bb.aes$decade==1, 7, bb.aes$bb.dec)
bb.aes$bb.dec<-ave(bb.aes$bb, bb.aes$bb.decade)
## 50s=114.76; 60s=114.28; 70s=115.11; 80s=112.93; 90s=107.01; 00s=103.41; 10s=103.98
bb.aes$bb.yr<-ave(bb.aes$bb, bb.aes$YEAR)
bb.aes$bb.space<-ave(bb.aes$bb, bb.aes$lat.long)
bb.aes<-rename(bb.aes, year=YEAR)
bb.aes<-dplyr::select(bb.aes, species, year, bb, cc, bb.cc, decade, bb.dec, bb.yr, bb.space, LAT, LON, ALT)
bb.aes<-bb.aes[!duplicated(bb.aes),]
# ALNGLU
bb.ag$lat.long<-paste(bb.ag$LAT, bb.ag$LON)
bb.ag<-bb.ag%>%filter(BBCH==11)%>%filter(YEAR>=1950)
bb.ag$leafout<-ave(bb.ag$DAY)
bb.ag$bb<-bb.ag$DAY-12
bb.ag$cc<-ifelse(bb.ag$YEAR<=1983, 0, 1)
bb.ag$bb.cc<-ave(bb.ag$bb, bb.ag$cc) ## 0 = 114.88 & 1 = 106.93
bb.ag$decade<-substr(bb.ag$YEAR,3,3)
bb.ag$bb.decade<-NA
bb.ag$bb.decade<-ifelse(bb.ag$decade==5, 1, bb.ag$bb.dec)
bb.ag$bb.decade<-ifelse(bb.ag$decade==6, 2, bb.ag$bb.dec)
bb.ag$bb.decade<-ifelse(bb.ag$decade==7, 3, bb.ag$bb.dec)
bb.ag$bb.decade<-ifelse(bb.ag$decade==8, 4, bb.ag$bb.dec)
bb.ag$bb.decade<-ifelse(bb.ag$decade==9, 5, bb.ag$bb.dec)
bb.ag$bb.decade<-ifelse(bb.ag$decade==0, 6, bb.ag$bb.dec)
bb.ag$bb.decade<-ifelse(bb.ag$decade==1, 7, bb.ag$bb.dec)
bb.ag$bb.dec<-ave(bb.ag$bb, bb.ag$bb.decade)
## 50s=118.65; 60s=116.06; 70s=114.20; 80s=112.30; 90s=104.96; 00s=105.98; 10s=104.74
bb.ag$bb.yr<-ave(bb.ag$bb, bb.ag$YEAR)
bb.ag$bb.space<-ave(bb.ag$bb, bb.ag$lat.long)
bb.ag<-rename(bb.ag, year=YEAR)
bb.ag<-dplyr::select(bb.ag, species, year, bb, cc, bb.cc, decade, bb.dec, bb.yr, bb.space, LAT, LON, ALT)
bb.ag<-bb.ag[!duplicated(bb.ag),]
# BETPEN
bb.bp$lat.long<-paste(bb.bp$LAT, bb.bp$LON)
bb.bp<-bb.bp%>%filter(BBCH==11)%>%filter(YEAR>=1950)
bb.bp$leafout<-ave(bb.bp$DAY)
bb.bp$bb<-bb.bp$DAY-12
bb.bp$cc<-ifelse(bb.bp$YEAR<=1983, 0, 1)
bb.bp$bb.cc<-ave(bb.bp$bb, bb.bp$cc) ## 0 = 113.38 & 1 = 107.46
bb.bp$decade<-substr(bb.bp$YEAR,3,3)
bb.bp$bb.decade<-NA
bb.bp$bb.decade<-ifelse(bb.bp$decade==5, 1, bb.bp$bb.dec)
bb.bp$bb.decade<-ifelse(bb.bp$decade==6, 2, bb.bp$bb.dec)
bb.bp$bb.decade<-ifelse(bb.bp$decade==7, 3, bb.bp$bb.dec)
bb.bp$bb.decade<-ifelse(bb.bp$decade==8, 4, bb.bp$bb.dec)
bb.bp$bb.decade<-ifelse(bb.bp$decade==9, 5, bb.bp$bb.dec)
bb.bp$bb.decade<-ifelse(bb.bp$decade==0, 6, bb.bp$bb.dec)
bb.bp$bb.decade<-ifelse(bb.bp$decade==1, 7, bb.bp$bb.dec)
bb.bp$bb.dec<-ave(bb.bp$bb, bb.bp$bb.decade)
## 50s=114.31; 60s=113.13; 70s=113.73; 80s=112.75; 90s=105.77; 00s=105.59; 10s=103.90
bb.bp$bb.yr<-ave(bb.bp$bb, bb.bp$YEAR)
bb.bp$bb.space<-ave(bb.bp$bb, bb.bp$lat.long)
bb.bp<-rename(bb.bp, year=YEAR)
bb.bp<-dplyr::select(bb.bp, species, year, bb, cc, bb.cc, decade, bb.dec, bb.yr, bb.space, LAT, LON, ALT)
bb.bp<-bb.bp[!duplicated(bb.bp),]
# FAGSYL
bb.fsyl$lat.long<-paste(bb.fsyl$LAT, bb.fsyl$LON)
bb.fsyl<-bb.fsyl%>%filter(BBCH==11)%>%filter(YEAR>=1950)
bb.fsyl$leafout<-ave(bb.fsyl$DAY)
bb.fsyl$bb<-bb.fsyl$DAY-12
bb.fsyl$cc<-ifelse(bb.fsyl$YEAR<=1983, 0, 1)
bb.fsyl$bb.cc<-ave(bb.fsyl$bb, bb.fsyl$cc) ## 0 = 121.11 & 1 = 115.74
bb.fsyl$decade<-substr(bb.fsyl$YEAR,3,3)
bb.fsyl$bb.decade<-NA
bb.fsyl$bb.decade<-ifelse(bb.fsyl$decade==5, 1, bb.fsyl$bb.dec)
bb.fsyl$bb.decade<-ifelse(bb.fsyl$decade==6, 2, bb.fsyl$bb.dec)
bb.fsyl$bb.decade<-ifelse(bb.fsyl$decade==7, 3, bb.fsyl$bb.dec)
bb.fsyl$bb.decade<-ifelse(bb.fsyl$decade==8, 4, bb.fsyl$bb.dec)
bb.fsyl$bb.decade<-ifelse(bb.fsyl$decade==9, 5, bb.fsyl$bb.dec)
bb.fsyl$bb.decade<-ifelse(bb.fsyl$decade==0, 6, bb.fsyl$bb.dec)
bb.fsyl$bb.decade<-ifelse(bb.fsyl$decade==1, 7, bb.fsyl$bb.dec)
bb.fsyl$bb.dec<-ave(bb.fsyl$bb, bb.fsyl$bb.decade)
## 50s=120.11; 60s=120.27; 70s=122.27; 80s=120.94; 90s=115.74; 00s=114.00; 10s=111.63
bb.fsyl$bb.yr<-ave(bb.fsyl$bb, bb.fsyl$YEAR)
bb.fsyl$bb.space<-ave(bb.fsyl$bb, bb.fsyl$lat.long)
bb.fsyl<-rename(bb.fsyl, year=YEAR)
bb.fsyl<-dplyr::select(bb.fsyl, species, year, bb, cc, bb.cc, decade, bb.dec, bb.yr, bb.space, LAT, LON, ALT)
bb.fsyl<-bb.fsyl[!duplicated(bb.fsyl),]
# FRAEXC
bb.fex$lat.long<-paste(bb.fex$LAT, bb.fex$LON)
bb.fex<-bb.fex%>%filter(BBCH==11)%>%filter(YEAR>=1950)
all<-ggplot(dxx, aes(x=year, y=fs.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites with False Springs") +
geom_hline(yintercept=dxx$fs.ave, linetype="dashed", color="blue") + geom_line(aes(y=m.index+1.286667), col="blue") +
scale_y_continuous(sec.axis = sec_axis(~.-1.286667, name="Avg Day of Budburst"))
all
all<-ggplot(dxx, aes(x=year, y=fs.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites with False Springs") +
geom_hline(yintercept=dxx$fs.ave, linetype="dashed", color="blue") + geom_line(aes(y=m.index+1.286667), col="blue") +
scale_y_continuous(sec.axis = sec_axis(~.-1.286667, name="Avg Day of Budburst"))
all
dxx<-bb
dxx$fs.yr<-ave(dxx$fs, dxx$year, FUN=sum)
dxx$fs.yrspp<-ave(dxx$fs, dxx$species, dxx$year, FUN=sum)
### Sites per species -
#length(unique(dxx$lat.long[dxx$species=="AESHIP"])) # 10191
#length(unique(dxx$lat.long[dxx$species=="ALNGLU"])) # 6775
#length(unique(dxx$lat.long[dxx$species=="BETPEN"])) # 10168
#length(unique(dxx$lat.long[dxx$species=="FAGSYL"])) # 9127
#length(unique(dxx$lat.long[dxx$species=="FRAEXC"])) # 7327
#length(unique(dxx$lat.long[dxx$species=="QUEROB"])) # 8831
dxx$spp.prop<-NA
dxx$spp.sites<-as.numeric(ave(dxx$lat.long, dxx$year, dxx$species, FUN=length))
dxx$spp.prop<-ifelse(dxx$species=="AESHIP", dxx$fs.yrspp/dxx$spp.sites, dxx$spp.prop)
dxx$spp.prop<-ifelse(dxx$species=="ALNGLU", dxx$fs.yrspp/dxx$spp.sites, dxx$spp.prop)
dxx$spp.prop<-ifelse(dxx$species=="BETPEN", dxx$fs.yrspp/dxx$spp.sites, dxx$spp.prop)
dxx$spp.prop<-ifelse(dxx$species=="FAGSYL", dxx$fs.yrspp/dxx$spp.sites, dxx$spp.prop)
dxx$spp.prop<-ifelse(dxx$species=="FRAEXC", dxx$fs.yrspp/dxx$spp.sites, dxx$spp.prop)
dxx$spp.prop<-ifelse(dxx$species=="QUEROB", dxx$fs.yrspp/dxx$spp.sites, dxx$spp.prop)
dxx$spp.ave<-ave(dxx$spp.prop, dxx$species, FUN=median)
dxx$num.sites<-as.numeric(ave(dxx$lat.long, dxx$year, FUN=length))
dxx$fs.prop<-dxx$fs.yr/dxx$num.sites
dxx$fs.ave<-ave(dxx$fs.prop, FUN=median)
#xx<-inner_join(dxx, dx)
dxx<-inner_join(dxx, nx)
impcols<-c("year", "fs.prop", "m.index", "fs.ave")
dxx<-subset(dxx, select=impcols)
#xx$x<-scale(xx$bb.yr, center = FALSE, scale = TRUE)
#xx$sx<-scale((xx$bb.yr^3), center=FALSE, scale=TRUE)
#ggplot(dxx, aes(x=year, y=fs.yr)) + geom_point() + xlab("Year") + ylab("Number of False Springs")
all<-ggplot(dxx, aes(x=year, y=fs.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites with False Springs") +
geom_hline(yintercept=dxx$fs.ave, linetype="dashed", color="blue") + geom_line(aes(y=m.index+1.286667), col="blue") +
scale_y_continuous(sec.axis = sec_axis(~.-1.286667, name="Avg Day of Budburst"))
all
all<-ggplot(dxx, aes(x=year, y=fs.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites with False Springs") +
geom_hline(yintercept=dxx$fs.ave, linetype="dashed", color="blue") + geom_line(aes(y=m.index+1.286667), col="blue") +
scale_y_continuous(sec.axis = sec_axis(~.-1.286667, name="NAO index"))
all
all<-ggplot(dxx, aes(x=year, y=fs.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites with False Springs") +
geom_hline(yintercept=dxx$fs.ave, linetype="dashed", color="blue") + geom_line(aes(y=m.index+1.286667), col="blue") +
scale_y_continuous(sec.axis = sec_axis(~.-1.286667, name="NAO index")) + coord_cartesian(ylim = c(0, 0.5))
all
all<-ggplot(dxx, aes(x=year, y=fs.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites with False Springs") +
+ coord_cartesian(ylim = c(0, 0.5)) +
geom_hline(yintercept=dxx$fs.ave, linetype="dashed", color="blue") + geom_line(aes(y=m.index+1.286667), col="blue") +
scale_y_continuous(sec.axis = sec_axis(~.-1.286667, name="NAO index"))
all<-ggplot(dxx, aes(x=year, y=fs.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites with False Springs") +
coord_cartesian(ylim = c(0, 0.5)) +
geom_hline(yintercept=dxx$fs.ave, linetype="dashed", color="blue") + geom_line(aes(y=m.index+1.286667), col="blue") +
scale_y_continuous(sec.axis = sec_axis(~.-1.286667, name="NAO index"))
all
dxx$nao<-(dxx$m.index/2)+1.29
range(dxx$nao)
dxx$nao<-(dxx$m.index/5)+1.29
range(dxx$nao)
dxx$nao<-(dxx$m.index+1.29)/3
range(dxx$nao)
all<-ggplot(dxx, aes(x=year, y=fs.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites with False Springs") +
coord_cartesian(ylim = c(0, 0.5)) +
geom_hline(yintercept=dxx$fs.ave, linetype="dashed", color="blue") + geom_line(aes(y=nao/3), col="blue") +
scale_y_continuous(sec.axis = sec_axis(~.*3, name="NAO index"))
all
dxx$nao<-(dxx$m.index+1.29)
all<-ggplot(dxx, aes(x=year, y=fs.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites with False Springs") +
coord_cartesian(ylim = c(0, 0.5)) +
geom_hline(yintercept=dxx$fs.ave, linetype="dashed", color="blue") + geom_line(aes(y=nao/3), col="blue") +
scale_y_continuous(sec.axis = sec_axis(~.*3, name="NAO index"))
all
all<-ggplot(dxx, aes(x=year, y=fs.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites with False Springs") +
coord_cartesian(ylim = c(0, 0.8)) +
geom_hline(yintercept=dxx$fs.ave, linetype="dashed", color="blue") + geom_line(aes(y=nao/3), col="blue") +
scale_y_continuous(sec.axis = sec_axis(~.*3, name="NAO index"))
all
View(dxx)
dxx$nao<-(dxx$m.index+1.29)/3
all<-ggplot(dxx, aes(x=year, y=fs.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites with False Springs") +
coord_cartesian(ylim = c(0, 0.8)) +
geom_hline(yintercept=dxx$fs.ave, linetype="dashed", color="blue") + geom_line(aes(y=nao), col="blue") +
scale_y_continuous(sec.axis = sec_axis(~., name="NAO index"))
all
all<-ggplot(dxx, aes(x=year, y=fs.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites with False Springs") +
coord_cartesian(ylim = c(0, 0.7)) +
geom_hline(yintercept=dxx$fs.ave, linetype="dashed", color="blue") + geom_line(aes(y=nao), col="blue") +
scale_y_continuous(sec.axis = sec_axis(~., name="NAO index", labes=c("-1.28", "-0.70", "-0.09", "0.54")))
all<-ggplot(dxx, aes(x=year, y=fs.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites with False Springs") +
coord_cartesian(ylim = c(0, 0.7)) +
geom_hline(yintercept=dxx$fs.ave, linetype="dashed", color="blue") + geom_line(aes(y=nao), col="blue") +
scale_y_continuous(sec.axis = sec_axis(~., name="NAO index", labels=c("-1.28", "-0.70", "-0.09", "0.54")))
all
all<-ggplot(dxx, aes(x=year, y=fs.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites with False Springs") +
coord_cartesian(ylim = c(0, 0.7)) +
geom_hline(yintercept=dxx$fs.ave, linetype="dashed", color="blue") + geom_line(aes(y=nao), col="blue") +
scale_y_continuous(sec.axis = sec_axis(~., name="NAO index", labels=c(-1.28, -0.70, -0.09, 0.54)))
all
all<-ggplot(dxx, aes(x=year, y=fs.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites with False Springs") +
coord_cartesian(ylim = c(0, 0.7)) +
geom_hline(yintercept=dxx$fs.ave, linetype="dashed", color="blue") + geom_line(aes(y=nao), col="blue") +
scale_y_continuous(sec.axis = sec_axis(~., name="NAO index"))
all
all<-ggplot(dxx, aes(x=year, y=fs.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites with False Springs") +
coord_cartesian(ylim = c(0, 0.7)) +
geom_hline(yintercept=dxx$fs.ave, linetype="dashed", color="blue") + geom_line(aes(y=nao), col="blue") +
scale_y_continuous(sec.axis = sec_axis(~., name="NAO index"), labels=c(-1.28, -0.70, -0.09, 0.54))
all
all<-ggplot(dxx, aes(x=year, y=fs.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites with False Springs") +
coord_cartesian(ylim = c(0, 0.7)) +
geom_hline(yintercept=dxx$fs.ave, linetype="dashed", color="blue") + geom_line(aes(y=nao), col="blue") +
scale_y_continuous(sec.axis = sec_axis(~., name="NAO index"), labels=c(-1.3, -0.70, -0.10, 0.50))
all
all<-ggplot(dxx, aes(x=year, y=fs.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites with False Springs") +
coord_cartesian(ylim = c(0, 0.7)) +
geom_hline(yintercept=dxx$fs.ave, linetype="dashed", color="blue") + geom_line(aes(y=nao), col="blue") +
scale_y_continuous(sec.axis = sec_axis(~., name="NAO index"), labels=c("-1.3", "-0.70", "-0.10", "0.50"), breaks=c(0,0.2,0.4,0.6))
all
all<-ggplot(dxx, aes(x=year, y=fs.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites with False Springs") +
coord_cartesian(ylim = c(0, 0.7)) +
geom_hline(yintercept=dxx$fs.ave, linetype="dashed", color="blue") + geom_line(aes(y=nao), col="blue") +
scale_y_continuous(sec.axis = sec_axis(~., name="NAO index", labels=c(-1.3, -0.70, -0.10, 0.50)))
all
all<-ggplot(dxx, aes(x=year, y=fs.prop)) + geom_line() + xlab("Year") + ylab("Proportion of Sites with False Springs") +
coord_cartesian(ylim = c(0, 0.7)) +
geom_hline(yintercept=dxx$fs.ave, linetype="dashed", color="blue") + geom_line(aes(y=nao), col="blue") +
scale_y_continuous(sec.axis = sec_axis(~., name="NAO index", labels=c("-1.3", "-0.70", "-0.10", "0.50"), breaks=c(0,0.2,0.4,0.6)))
all
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load Libraries
library(ggplot2)
library(dplyr)
library(tidyr)
library(egg)
library(brms)
# Setting working directory
setwd("~/Documents/git/regionalrisk/analyses/")
bb<-read.csv("output/regrisk.cleaned.csv", header=TRUE)
dxx<-read.csv("output/fs_matspring.csv", header=TRUE)
x<-read.csv("output/fs_bb_sitedata.csv", header = TRUE)
dxx$fs.yr<-ave(dxx$fs, dxx$year, FUN=sum)
dxx$fs.yrspp<-ave(dxx$fs, dxx$species, dxx$year, FUN=sum)
dxx$spp.prop<-NA
dxx$spp.sites<-as.numeric(ave(dxx$lat.long, dxx$year, dxx$species, FUN=length))
dxx$spp.prop<-ifelse(dxx$species=="AESHIP", dxx$fs.yrspp/dxx$spp.sites, dxx$spp.prop)
dxx$spp.prop<-ifelse(dxx$species=="ALNGLU", dxx$fs.yrspp/dxx$spp.sites, dxx$spp.prop)
dxx$spp.prop<-ifelse(dxx$species=="BETPEN", dxx$fs.yrspp/dxx$spp.sites, dxx$spp.prop)
dxx$spp.prop<-ifelse(dxx$species=="FAGSYL", dxx$fs.yrspp/dxx$spp.sites, dxx$spp.prop)
dxx$spp.prop<-ifelse(dxx$species=="FRAEXC", dxx$fs.yrspp/dxx$spp.sites, dxx$spp.prop)
dxx$spp.prop<-ifelse(dxx$species=="QUEROB", dxx$fs.yrspp/dxx$spp.sites, dxx$spp.prop)
dxx$spp.ave<-ave(dxx$spp.prop, dxx$species, FUN=median)
dxx$num.sites<-as.numeric(ave(dxx$lat.long, dxx$year, FUN=length))
dxx$fs.prop<-dxx$fs.yr/dxx$num.sites
dxx$fs.ave<-ave(dxx$fs.prop, FUN=median)
x<-x%>%rename(lat=LAT)%>%rename(long=LON)%>%rename(elev=ALT)
x<-dplyr::select(x, species, year, bb, bb.yr, lat, long, elev)
x<-x[!duplicated(x),]
colnames(bb)
colnames(dxx)
colnames(x)
dxx<-subset(dxx, select=c("species", "year", "lat", "long", "fs.prop", "spp.prop"))
df<-full_join(bb, dxx)
df<-inner_join(bb, dxx)
df<-inner_join(df, x)
View(df)
ggplot(df, aes(x=sp.temp, y=fs.prop)) + geom_line()
ggplot(df, aes(x=sp.temp, y=fs.prop)) + geom_points()
ggplot(df, aes(x=sp.temp, y=fs.prop)) + geom_point()
ggplot(df, aes(x=sp.temp, y=fs.prop)) + geom_smooth()
ggplot(df, aes(x=sp.temp, y=fs.prop)) + geom_smooth(method="lm")
ggplot(df, aes(x=sp.temp, y=fs.count)) + geom_point(aes(col=species))
ggplot(df, aes(x=sp.temp, y=fs.prop)) + geom_point(aes(col=species))
ggplot(df, aes(x=cc, y=fs.prop)) + geom_boxplot()
ggplot(df, aes(x=as.factor(cc), y=fs.prop)) + geom_boxplot()
ggplot(df, aes(x=as.factor(cc), y=fs.count)) + geom_boxplot()
df<-df[!duplicated(df),]
table(df$cc, df$fs.count)
ggplot(df, aes(x=as.factor(cc), y=fs.count)) + geom_density()
ggplot(df, aes(x=as.factor(cc), y=fs.count)) + geom_boxplot()
dxx<-read.csv("output/fs_matspring.csv", header=TRUE)
dxx$fs.yr<-ave(dxx$fs, dxx$year, FUN=sum)
dxx$fs.yrspp<-ave(dxx$fs, dxx$species, dxx$year, FUN=sum)
dxx$spp.prop<-NA
dxx$spp.sites<-as.numeric(ave(dxx$lat.long, dxx$year, dxx$species, FUN=length))
dxx$spp.prop<-ifelse(dxx$species=="AESHIP", dxx$fs.yrspp/dxx$spp.sites, dxx$spp.prop)
dxx$spp.prop<-ifelse(dxx$species=="ALNGLU", dxx$fs.yrspp/dxx$spp.sites, dxx$spp.prop)
dxx$spp.prop<-ifelse(dxx$species=="BETPEN", dxx$fs.yrspp/dxx$spp.sites, dxx$spp.prop)
dxx$spp.prop<-ifelse(dxx$species=="FAGSYL", dxx$fs.yrspp/dxx$spp.sites, dxx$spp.prop)
dxx$spp.prop<-ifelse(dxx$species=="FRAEXC", dxx$fs.yrspp/dxx$spp.sites, dxx$spp.prop)
dxx$spp.prop<-ifelse(dxx$species=="QUEROB", dxx$fs.yrspp/dxx$spp.sites, dxx$spp.prop)
dxx$spp.ave<-ave(dxx$spp.prop, dxx$species, FUN=median)
dxx$num.sites<-as.numeric(ave(dxx$lat.long, dxx$year, FUN=length))
dxx$fs.prop<-dxx$fs.yr/dxx$num.sites
dxx$fs.ave<-ave(dxx$fs.prop, FUN=median)
dxx<-subset(dxx, select=c("species", "year", "lat", "long", "fs.prop", "spp.prop", "num.sites"))
df<-inner_join(bb, dxx)
df<-inner_join(df, x)
df<-df[!duplicated(df),]
ggplot(df, aes(x=num.sites, y=fs.count)) + geom_line(stat="smooth", method="auto", aes(col=as.factor(cc)))
ggplot(df, aes(x=year, y=fs.count)) + geom_line(stat="smooth", method="auto", aes(col=as.factor(cc)))
ggplot(df, aes(x=year, y=fs.prop)) + geom_line(stat="smooth", method="auto", aes(col=as.factor(cc)))
ggplot(df, aes(x=year, y=fs.prop)) + geom_point(aes(col=as.factor(cc)))
ggplot(df, aes(x=year, y=fs.prop)) + geom_line(aes(col=as.factor(cc)), stat="smooth", se=FALSE, method="lm")
ggplot(df, aes(x=year, y=fs.prop)) + geom_line(aes(col=as.factor(cc)), stat="smooth", se=FALSE, method="loess")
ggplot(df, aes(x=year, y=fs.prop)) + geom_line(aes(col=as.factor(cc)), stat="smooth", se=FALSE, method="auto")
ggplot(df, aes(x=elev, y=fs.prop)) + geom_point(aes(col=as.factor(cc)))
ggplot(df, aes(x=elev, y=fs.prop)) + geom_line(aes(col=as.factor(cc)), stat="smooth", method="auto", se=FALSE)
ggplot(df, aes(x=elev, y=fs.count)) + geom_line(aes(col=as.factor(cc)), stat="smooth", method="auto", se=FALSE)
ggplot(df, aes(x=elev, y=fs.count)) + geom_point()
ggplot(df, aes(x=space, y=fs.count)) + geom_point()
ggplot(df, aes(x=space, y=fs.count)) + geom_line(aes(col=as.factor(cc)), stat="identity", method="auto")
ggplot(df, aes(x=space, y=fs.count)) + geom_line(aes(col=as.factor(cc)), stat="smooth", method="auto")
ggplot(df, aes(x=fs.count, y=sp.temp)) + geom_bar(aes(col=as.factor(cc)), position="dodge")
ggplot(df, aes(x=fs.count, y=sp.temp)) + geom_bar(aes(col=as.factor(cc)), position="dodge") + coord_flip()
ggplot(df, aes(x=sp.temp, y=fs.count)) + geom_bar(aes(col=as.factor(cc)), position="dodge") + coord_flip()
ggplot(df, aes(x=fs.count, y=sp.temp)) + geom_bar(position="dodge") + coord_flip()
ggplot(df, aes(x=fs.count, y=sp.temp)) + geom_bar() + coord_flip()
ggplot(df, aes(x=fs.count, y=as.integer(round(sp.temp, digits=0)) + geom_bar(aes(col=as.factor(cc)), position="dodge") + coord_flip()
ggplot(df, aes(x=fs.count, y=as.integer(round(sp.temp, digits=0)))) + geom_bar(aes(col=as.factor(cc)), position="dodge") + coord_flip()
ggplot(df, aes(y=fs.count, x=as.integer(round(sp.temp, digits=0)))) + geom_bar(aes(col=as.factor(cc)), position="dodge")
mat<-as.integer(round(df$sp.temp, digits=0))
ggplot(df, aes(y=fs.count, x=mat)) + geom_bar(aes(col=as.factor(cc)), position="dodge")
df$mat<-as.integer(round(df$sp.temp, digits=0))
ggplot(df, aes(y=fs.count, x=mat)) + geom_bar(aes(col=as.factor(cc)), position="dodge")
class(df$mat)
class(df$fs.count)
unique(df$mat)
sort(unique(df$mat))
df$mat<-ifelse(df$mat<=-10, 1, df$mat)
df$mat<-ifelse(df$mat>-10&df$mat<=-6, 1, df$mat)
df$mat<-ifelse(df$mat>-6&df$mat<=-2, 1, df$mat)
df$mat<-ifelse(df$mat>-2&df$mat<=2, 1, df$mat)
df$mat<-ifelse(df$mat>2&df$mat<=6, 1, df$mat)
df$mat<-ifelse(df$mat>6&df$mat<=10, 1, df$mat)
df$mat<-ifelse(df$mat>10, 1, df$mat)
ggplot(df, aes(y=fs.count, x=mat)) + geom_bar(aes(col=as.factor(cc)), position="dodge")
df$mat<-as.integer(round(df$sp.temp, digits=0))
df$mat<-ifelse(df$mat<=-10, 1, df$mat)
df$mat<-ifelse(df$mat>-10&df$mat<=-6, 2, df$mat)
df$mat<-ifelse(df$mat>-6&df$mat<=-2, 3, df$mat)
df$mat<-ifelse(df$mat>-2&df$mat<=2, 4, df$mat)
df$mat<-ifelse(df$mat>2&df$mat<=6, 5, df$mat)
df$mat<-ifelse(df$mat>6&df$mat<=10, 6, df$mat)
df$mat<-ifelse(df$mat>10, 7, df$mat)
ggplot(df, aes(y=fs.count, x=mat)) + geom_bar(aes(col=as.factor(cc)), position="dodge")
ggplot(df, aes(y=fs.count, x=mat)) + geom_boxplot(aes(col=as.factor(cc)), position="dodge")
df$fs<-ave(df$fs.count, df$mat)
ggplot(df, aes(y=fs, x=mat)) + geom_bar(aes(col=as.factor(cc)), position="dodge")
df$fs<-as.integer(round(df$fs, digits=0))
ggplot(df, aes(y=fs, x=mat)) + geom_bar(aes(col=as.factor(cc)), position="dodge")
View(df)
df$mat<-ifelse(df$mat<=-10, 1, df$mat)
df$matx<-ifelse(df$mat>-10&df$mat<=-6, 2, df$mat)
df$matx<-ifelse(df$mat>-6&df$mat<=-2, 3, df$mat)
df$matx<-ifelse(df$mat>-2&df$mat<=2, 4, df$mat)
df$matx<-ifelse(df$mat>2&df$mat<=6, 5, df$mat)
df$matx<-ifelse(df$mat>6&df$mat<=10, 6, df$mat)
df$matx<-ifelse(df$mat>10, 7, df$mat)
df$fs<-ave(df$fs.count, df$mat)
df$fs<-as.integer(round(df$fs, digits=0))
ggplot(df, aes(y=fs, x=mat)) + geom_bar(aes(col=as.factor(cc)), position="dodge")
df$mat<-as.integer(round(df$sp.temp, digits=0))
df$mat<-ifelse(df$mat<=-10, 1, df$mat)
df$matx<-ifelse(df$mat>-10&df$mat<=-6, 2, df$mat)
df$matx<-ifelse(df$mat>-6&df$mat<=-2, 3, df$mat)
df$matx<-ifelse(df$mat>-2&df$mat<=2, 4, df$mat)
df$matx<-ifelse(df$mat>2&df$mat<=6, 5, df$mat)
df$matx<-ifelse(df$mat>6&df$mat<=10, 6, df$mat)
df$matx<-ifelse(df$mat>10, 7, df$mat)
df$fs<-ave(df$fs.count, df$matx)
df$mat<-as.integer(round(df$sp.temp, digits=0))
df$matx<-NA
df$mat<-ifelse(df$mat<=-10, 1, df$matx)
df$matx<-ifelse(df$mat>-10&df$mat<=-6, 2, df$matx)
df$matx<-ifelse(df$mat>-6&df$mat<=-2, 3, df$matx)
df$matx<-ifelse(df$mat>-2&df$mat<=2, 4, df$matx)
df$matx<-ifelse(df$mat>2&df$mat<=6, 5, df$matx)
df$matx<-ifelse(df$mat>6&df$mat<=10, 6, df$matx)
df$matx<-ifelse(df$mat>10, 7, df$mat)
df$fs<-ave(df$fs.count, df$matx)
df$mat<-as.integer(round(df$sp.temp, digits=0))
df$matx<-NA
df$matx<-ifelse(df$mat<=-10, 1, df$matx)
df$matx<-ifelse(df$mat>-10&df$mat<=-6, 2, df$matx)
df$matx<-ifelse(df$mat>-6&df$mat<=-2, 3, df$matx)
df$matx<-ifelse(df$mat>-2&df$mat<=2, 4, df$matx)
df$matx<-ifelse(df$mat>2&df$mat<=6, 5, df$matx)
df$matx<-ifelse(df$mat>6&df$mat<=10, 6, df$matx)
df$matx<-ifelse(df$mat>10, 7, df$mat)
df$fs<-ave(df$fs.count, df$matx)
df$mat<-as.integer(round(df$sp.temp, digits=0))
df$matx<-NA
df$matx<-ifelse(df$mat<=-10, 1, df$mat)
df$matx<-ifelse(df$mat>-10&df$mat<=-6, 2, df$mat)
df$matx<-ifelse(df$mat>-6&df$mat<=-2, 3, df$mat)
df$matx<-ifelse(df$mat>-2&df$mat<=2, 4, df$mat)
df$matx<-ifelse(df$mat>2&df$mat<=6, 5, df$mat)
df$matx<-ifelse(df$mat>6&df$mat<=10, 6, df$mat)
df$matx<-ifelse(df$mat>10, 7, df$mat)
df$fs<-ave(df$fs.count, df$matx)
df$mat<-as.integer(round(df$sp.temp, digits=0))
df$matx<-NA
df$matx<-ifelse(df$mat<=-10, 1, df$matx)
df$matx<-ifelse(df$mat>-10&df$mat<=-6, 2, df$matx)
df$matx<-ifelse(df$mat>-6&df$mat<=-2, 3, df$matx)
df$matx<-ifelse(df$mat>-2&df$mat<=2, 4, df$matx)
df$matx<-ifelse(df$mat>2&df$mat<=6, 5, df$matx)
df$matx<-ifelse(df$mat>6&df$mat<=10, 6, df$matx)
df$matx<-ifelse(df$mat>10, 7, df$matx)
df$fs<-ave(df$fs.count, df$matx)
df$fs<-as.integer(round(df$fs, digits=0))
ggplot(df, aes(y=fs, x=mat)) + geom_bar(aes(col=as.factor(cc)), position="dodge")
class(df$fs)
class(df$matx)
df$matx<-as.integer(df$matx)
ggplot(df, aes(y=fs, x=matx)) + geom_bar(aes(col=as.factor(cc)), position="dodge")
ggplot(df, aes(x=fs.count, y=sp.temp)) + geom_bar(aes(col=as.factor(cc)), position="dodge")
