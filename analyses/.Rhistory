scale_x_discrete(labels=c("aaBETPEN" = "Betula pendula", "AESHIP" = "Aesculus \nhippocastanum",
"ALNGLU" = "Alnus glutinosa", "FAGSYL"="Fagus sylvatica",
"QUEROB"="Quercus robur", "zFRAEXC"="Fraxinus \nexcelsior")) +
ylab("Minimum Temperature \nfrom Budburst to Leafout") + coord_cartesian(ylim=c(0,15)) +
#geom_hline(yintercept=mean(plust$Tmin), linetype="dotted", col="black") +
#annotate("text", x = 5.75, y = 245, label = "Before 1984", family="Helvetica", size=3, fontface="bold") +
scale_alpha_manual(name="Climate Change", values=c(0.2, 0.7),
labels=c("0"="1951-1983", "1"="1984-2016")) +
geom_point(aes(x=as.factor(species), alpha=as.factor(cc), y=est, group=cc,
col=as.factor(cc)),
position = position_dodge(width=0.75), size=1) +
geom_linerange(aes(x=as.factor(species), alpha=as.factor(cc), ymin=lower, ymax=upper, group=cc,
col=as.factor(cc)), position = position_dodge(width=0.75)) +
ggtitle("(b)") +
guides(alpha=guide_legend(override.aes=list(fill=hcl(c(15,195),100,0,alpha=c(0.2,0.7)))), col=FALSE, fill=FALSE)
load("~/Documents/git/regionalrisk/fstotmodlong.Rdata")
load("~/Documents/git/regionalrisk/fstotmodlongtest.Rdata")
#load("~/Documents/git/regionalrisk/fstotmod.Rdata")
#fsccsp<- ggpredict(fstot.mod, terms = c("cc", "species"), ci.lvl=0.98)
fsccsp<- ggpredict(fstotlongtest.mod, terms = c("cc", "species"), ci.lvl=0.98)
fsccsp$group <- as.character(fsccsp$group)
fsccsp$species <- NA
fsccsp$species<-ifelse(fsccsp$group=="BETPEN", "aaBETPEN", as.character(fsccsp$group))
fsccsp$species<-ifelse(fsccsp$group=="FRAEXC", "zFRAEXC", fsccsp$species)
f<-read.csv("output/fs_newspace_long.csv", header=TRUE)
#f$cc<-ifelse(f$year<1980, 0, 1)
f$species<-ifelse(f$species=="BETPEN", "aaBETPEN", f$species)
f$species<-ifelse(f$species=="FRAEXC", "zFRAEXC", f$species)
f<-f[!is.na(f$fs),]
f$fstot<-ave(f$fs, f$lat.long, f$species, f$cc, FUN=sum)
f.sub <- subset(f, select=c("fstot", "species", "cc"))
f.sub <- f.sub[!duplicated(f.sub),]
fsccsp$est.conv <-  (fsccsp$predicted/4)/(2)
fsccsp$low.conv <-  (fsccsp$conf.low/4)/(2)
fsccsp$up.conv <-  (fsccsp$conf.high/4)/(2)
fsccsp$x <- ifelse(fsccsp$x<=0, 0, 1)
fsccsp<-subset(fsccsp, select=c("x", "predicted", "conf.low", "conf.high","species", "est.conv", "low.conv", "up.conv")) #
colnames(fsccsp) <- c("cc", "est", "lower", "upper",  "species","est.conv", "low.conv", "up.conv") # ,
plusf<-subset(f, select=c(species, cc, fstot))
plusf<-plusf[!duplicated(plusf),]
plusf <- full_join(plusf, fsccsp)
cols <-viridis_pal(option="viridis")(6)
falsespring<- ggplot(plusf, aes(x=species,alpha=cc, y=fstot)) + geom_boxplot(aes(alpha=as.factor(cc), fill=as.factor(species), col=as.factor(species)), outlier.shape=NA) +
scale_fill_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
scale_color_manual(name="Species", values=c("grey48","black", cols),
labels=c("0"="1951-1983", "1"="1984-2016",
"aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
theme(legend.text=element_text(size=7), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="Helvetica"),
plot.title = element_text(face="bold", size=10),
legend.text.align = 0, axis.text.x = element_text(face = "italic", angle=35, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white"), legend.position = "none",
plot.margin = unit(c(1.5,1.5, 1.0, 1.5), "lines"),
axis.title.x = element_blank()) +
#axis.text.x.bottom = element_blank(), axis.ticks.x = element_blank()) + # top, right, bottom, left
scale_y_continuous(expand = c(0, 0)) +
scale_x_discrete(labels=c("aaBETPEN" = "Betula pendula", "AESHIP" = "Aesculus \nhippocastanum",
"ALNGLU" = "Alnus glutinosa", "FAGSYL"="Fagus sylvatica",
"QUEROB"="Quercus robur", "zFRAEXC"="Fraxinus \nexcelsior")) +
ylab("Number of false springs") + #coord_cartesian(ylim=c(0, 33)) +
#geom_hline(yintercept=7.66, linetype="dotted", col="black") +
#annotate("text", x = 5.75, y = 245, label = "Before 1984", family="Helvetica", size=3, fontface="bold") +
scale_alpha_manual(name="Climate Change", values=c(0.2, 0.7),
labels=c("0"="1951-1983", "1"="1984-2016")) +
geom_point(aes(x=as.factor(species), alpha=as.factor(cc), y=est, group=cc,
col=as.factor(cc)),
position = position_dodge(width=0.75), size=1) +
geom_linerange(aes(x=as.factor(species), alpha=as.factor(cc), ymin=lower, ymax=upper, group=cc,
col=as.factor(cc)), position = position_dodge(width=0.75)) +
ggtitle("(c)") +
guides(alpha=guide_legend(override.aes=list(fill=hcl(c(15,195),100,0,alpha=c(0.2,0.7)))), col=FALSE, fill=FALSE)
falsespring<- ggplot(plusf, aes(x=species,alpha=cc, y=fstot)) + geom_boxplot(aes(alpha=as.factor(cc), fill=as.factor(species), col=as.factor(species)), outlier.shape=NA) +
scale_fill_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
scale_color_manual(name="Species", values=c("grey48","black", cols),
labels=c("0"="1951-1983", "1"="1984-2016",
"aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
theme(legend.text=element_text(size=7), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="Helvetica"),
plot.title = element_text(face="bold", size=10),
legend.text.align = 0, axis.text.x = element_text(face = "italic", angle=35, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white"), #legend.position = "none",
plot.margin = unit(c(1.5,1.5, 1.0, 1.5), "lines"),
axis.title.x = element_blank()) +
#axis.text.x.bottom = element_blank(), axis.ticks.x = element_blank()) + # top, right, bottom, left
scale_y_continuous(expand = c(0, 0)) +
scale_x_discrete(labels=c("aaBETPEN" = "Betula pendula", "AESHIP" = "Aesculus \nhippocastanum",
"ALNGLU" = "Alnus glutinosa", "FAGSYL"="Fagus sylvatica",
"QUEROB"="Quercus robur", "zFRAEXC"="Fraxinus \nexcelsior")) +
ylab("Number of false springs") + #coord_cartesian(ylim=c(0, 33)) +
#geom_hline(yintercept=7.66, linetype="dotted", col="black") +
#annotate("text", x = 5.75, y = 245, label = "Before 1984", family="Helvetica", size=3, fontface="bold") +
scale_alpha_manual(name="Climate Change", values=c(0.2, 0.7),
labels=c("0"="1951-1983", "1"="1984-2016")) +
geom_point(aes(x=as.factor(species), alpha=as.factor(cc), y=est, group=cc,
col=as.factor(cc)),
position = position_dodge(width=0.75), size=1) +
geom_linerange(aes(x=as.factor(species), alpha=as.factor(cc), ymin=lower, ymax=upper, group=cc,
col=as.factor(cc)), position = position_dodge(width=0.75)) +
ggtitle("(c)") +
guides(alpha=guide_legend(override.aes=list(fill=hcl(c(15,195),100,0,alpha=c(0.2,0.7)))), col=FALSE, fill=FALSE)
g_legend<-function(a.gplot){
tmp <- ggplot_gtable(ggplot_build(a.gplot))
leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
legend <- tmp$grobs[[leg]]
return(legend)}
mylegend<-g_legend(falsespring)
falsespring<- ggplot(plusf, aes(x=species,alpha=cc, y=fstot)) + geom_boxplot(aes(alpha=as.factor(cc), fill=as.factor(species), col=as.factor(species)), outlier.shape=NA) +
scale_fill_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
scale_color_manual(name="Species", values=c("grey48","black", cols),
labels=c("0"="1951-1983", "1"="1984-2016",
"aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
theme(legend.text=element_text(size=7), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="Helvetica"),
plot.title = element_text(face="bold", size=10),
legend.text.align = 0, axis.text.x = element_text(face = "italic", angle=35, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white"), legend.position = "none",
plot.margin = unit(c(1.5,1.5, 1.0, 1.5), "lines"),
axis.title.x = element_blank()) +
#axis.text.x.bottom = element_blank(), axis.ticks.x = element_blank()) + # top, right, bottom, left
scale_y_continuous(expand = c(0, 0)) +
scale_x_discrete(labels=c("aaBETPEN" = "Betula pendula", "AESHIP" = "Aesculus \nhippocastanum",
"ALNGLU" = "Alnus glutinosa", "FAGSYL"="Fagus sylvatica",
"QUEROB"="Quercus robur", "zFRAEXC"="Fraxinus \nexcelsior")) +
ylab("Number of false springs") + #coord_cartesian(ylim=c(0, 33)) +
#geom_hline(yintercept=7.66, linetype="dotted", col="black") +
#annotate("text", x = 5.75, y = 245, label = "Before 1984", family="Helvetica", size=3, fontface="bold") +
scale_alpha_manual(name="Climate Change", values=c(0.2, 0.7),
labels=c("0"="1951-1983", "1"="1984-2016")) +
geom_point(aes(x=as.factor(species), alpha=as.factor(cc), y=est, group=cc,
col=as.factor(cc)),
position = position_dodge(width=0.75), size=1) +
geom_linerange(aes(x=as.factor(species), alpha=as.factor(cc), ymin=lower, ymax=upper, group=cc,
col=as.factor(cc)), position = position_dodge(width=0.75)) +
ggtitle("(c)") +
guides(alpha=guide_legend(override.aes=list(fill=hcl(c(15,195),100,0,alpha=c(0.2,0.7)))), col=FALSE, fill=FALSE)
quartz()
g1<-ggarrange(budburst, tmin, falsespring, nrow=3)
g2<-grid.arrange(mylegend)
grid.arrange(g1, g2, ncol=2, widths=c(2.5, 0.75))
plusf<-subset(f.sub, select=c(species, cc, fstot))
plusf<-plusf[!duplicated(plusf),]
plusf <- full_join(plusf, fsccsp)
cols <-viridis_pal(option="viridis")(6)
falsespring<- ggplot(plusf, aes(x=species,alpha=cc, y=fstot)) + geom_boxplot(aes(alpha=as.factor(cc), fill=as.factor(species), col=as.factor(species)), outlier.shape=NA) +
scale_fill_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
scale_color_manual(name="Species", values=c("grey48","black", cols),
labels=c("0"="1951-1983", "1"="1984-2016",
"aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
theme(legend.text=element_text(size=7), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="Helvetica"),
plot.title = element_text(face="bold", size=10),
legend.text.align = 0, axis.text.x = element_text(face = "italic", angle=35, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white"), legend.position = "none",
plot.margin = unit(c(1.5,1.5, 1.0, 1.5), "lines"),
axis.title.x = element_blank()) +
#axis.text.x.bottom = element_blank(), axis.ticks.x = element_blank()) + # top, right, bottom, left
scale_y_continuous(expand = c(0, 0)) +
scale_x_discrete(labels=c("aaBETPEN" = "Betula pendula", "AESHIP" = "Aesculus \nhippocastanum",
"ALNGLU" = "Alnus glutinosa", "FAGSYL"="Fagus sylvatica",
"QUEROB"="Quercus robur", "zFRAEXC"="Fraxinus \nexcelsior")) +
ylab("Number of false springs") + #coord_cartesian(ylim=c(0, 33)) +
#geom_hline(yintercept=7.66, linetype="dotted", col="black") +
#annotate("text", x = 5.75, y = 245, label = "Before 1984", family="Helvetica", size=3, fontface="bold") +
scale_alpha_manual(name="Climate Change", values=c(0.2, 0.7),
labels=c("0"="1951-1983", "1"="1984-2016")) +
geom_point(aes(x=as.factor(species), alpha=as.factor(cc), y=est, group=cc,
col=as.factor(cc)),
position = position_dodge(width=0.75), size=1) +
geom_linerange(aes(x=as.factor(species), alpha=as.factor(cc), ymin=lower, ymax=upper, group=cc,
col=as.factor(cc)), position = position_dodge(width=0.75)) +
ggtitle("(c)") +
guides(alpha=guide_legend(override.aes=list(fill=hcl(c(15,195),100,0,alpha=c(0.2,0.7)))), col=FALSE, fill=FALSE)
falsespring
load("~/Documents/git/regionalrisk/fstotmodlong.Rdata")
#load("~/Documents/git/regionalrisk/fstotmod.Rdata")
#fsccsp<- ggpredict(fstot.mod, terms = c("cc", "species"), ci.lvl=0.98)
fsccsp<- ggpredict(fstotlongtest.mod, terms = c("cc", "species"), ci.lvl=0.98)
fsccsp$group <- as.character(fsccsp$group)
fsccsp$species <- NA
fsccsp$species<-ifelse(fsccsp$group=="BETPEN", "aaBETPEN", as.character(fsccsp$group))
fsccsp$species<-ifelse(fsccsp$group=="FRAEXC", "zFRAEXC", fsccsp$species)
f<-read.csv("output/fs_newspace_long.csv", header=TRUE)
#load("~/Documents/git/regionalrisk/fstotmod.Rdata")
#fsccsp<- ggpredict(fstot.mod, terms = c("cc", "species"), ci.lvl=0.98)
fsccsp<- ggpredict(fstotlong.mod, terms = c("cc", "species"), ci.lvl=0.98)
fsccsp$group <- as.character(fsccsp$group)
fsccsp$species <- NA
fsccsp$species<-ifelse(fsccsp$group=="BETPEN", "aaBETPEN", as.character(fsccsp$group))
fsccsp$species<-ifelse(fsccsp$group=="FRAEXC", "zFRAEXC", fsccsp$species)
#f$cc<-ifelse(f$year<1980, 0, 1)
f$species<-ifelse(f$species=="BETPEN", "aaBETPEN", f$species)
f$species<-ifelse(f$species=="FRAEXC", "zFRAEXC", f$species)
f<-f[!is.na(f$fs),]
f$fstot<-ave(f$fs, f$lat.long, f$species, f$cc, FUN=sum)
f.sub <- subset(f, select=c("fstot", "species", "cc"))
f.sub <- f.sub[!duplicated(f.sub),]
fsccsp$est.conv <-  (fsccsp$predicted/4)/(2)
fsccsp$low.conv <-  (fsccsp$conf.low/4)/(2)
fsccsp$up.conv <-  (fsccsp$conf.high/4)/(2)
fsccsp$x <- ifelse(fsccsp$x<=0, 0, 1)
fsccsp<-subset(fsccsp, select=c("x", "predicted", "conf.low", "conf.high","species", "est.conv", "low.conv", "up.conv")) #
colnames(fsccsp) <- c("cc", "est", "lower", "upper",  "species","est.conv", "low.conv", "up.conv") # ,
plusf<-subset(f.sub, select=c(species, cc, fstot))
plusf<-plusf[!duplicated(plusf),]
plusf <- full_join(plusf, fsccsp)
cols <-viridis_pal(option="viridis")(6)
falsespring<- ggplot(plusf, aes(x=species,alpha=cc, y=fstot)) + geom_boxplot(aes(alpha=as.factor(cc), fill=as.factor(species), col=as.factor(species)), outlier.shape=NA) +
scale_fill_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
scale_color_manual(name="Species", values=c("grey48","black", cols),
labels=c("0"="1951-1983", "1"="1984-2016",
"aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
theme(legend.text=element_text(size=7), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="Helvetica"),
plot.title = element_text(face="bold", size=10),
legend.text.align = 0, axis.text.x = element_text(face = "italic", angle=35, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white"), legend.position = "none",
plot.margin = unit(c(1.5,1.5, 1.0, 1.5), "lines"),
axis.title.x = element_blank()) +
#axis.text.x.bottom = element_blank(), axis.ticks.x = element_blank()) + # top, right, bottom, left
scale_y_continuous(expand = c(0, 0)) +
scale_x_discrete(labels=c("aaBETPEN" = "Betula pendula", "AESHIP" = "Aesculus \nhippocastanum",
"ALNGLU" = "Alnus glutinosa", "FAGSYL"="Fagus sylvatica",
"QUEROB"="Quercus robur", "zFRAEXC"="Fraxinus \nexcelsior")) +
ylab("Number of false springs") + #coord_cartesian(ylim=c(0, 33)) +
#geom_hline(yintercept=7.66, linetype="dotted", col="black") +
#annotate("text", x = 5.75, y = 245, label = "Before 1984", family="Helvetica", size=3, fontface="bold") +
scale_alpha_manual(name="Climate Change", values=c(0.2, 0.7),
labels=c("0"="1951-1983", "1"="1984-2016")) +
geom_point(aes(x=as.factor(species), alpha=as.factor(cc), y=est, group=cc,
col=as.factor(cc)),
position = position_dodge(width=0.75), size=1) +
geom_linerange(aes(x=as.factor(species), alpha=as.factor(cc), ymin=lower, ymax=upper, group=cc,
col=as.factor(cc)), position = position_dodge(width=0.75)) +
ggtitle("(c)") +
guides(alpha=guide_legend(override.aes=list(fill=hcl(c(15,195),100,0,alpha=c(0.2,0.7)))), col=FALSE, fill=FALSE)
falsespring
f.sub <- subset(f, select=c("fstot", "species", "cc", "lat.long"))
f.sub <- f.sub[!duplicated(f.sub),]
plusf<-subset(f.sub, select=c(species, cc, fstot))
plusf<-plusf[!duplicated(plusf),]
plusf <- full_join(plusf, fsccsp)
cols <-viridis_pal(option="viridis")(6)
falsespring<- ggplot(plusf, aes(x=species,alpha=cc, y=fstot)) + geom_boxplot(aes(alpha=as.factor(cc), fill=as.factor(species), col=as.factor(species)), outlier.shape=NA) +
scale_fill_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
scale_color_manual(name="Species", values=c("grey48","black", cols),
labels=c("0"="1951-1983", "1"="1984-2016",
"aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
theme(legend.text=element_text(size=7), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="Helvetica"),
plot.title = element_text(face="bold", size=10),
legend.text.align = 0, axis.text.x = element_text(face = "italic", angle=35, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white"), legend.position = "none",
plot.margin = unit(c(1.5,1.5, 1.0, 1.5), "lines"),
axis.title.x = element_blank()) +
#axis.text.x.bottom = element_blank(), axis.ticks.x = element_blank()) + # top, right, bottom, left
scale_y_continuous(expand = c(0, 0)) +
scale_x_discrete(labels=c("aaBETPEN" = "Betula pendula", "AESHIP" = "Aesculus \nhippocastanum",
"ALNGLU" = "Alnus glutinosa", "FAGSYL"="Fagus sylvatica",
"QUEROB"="Quercus robur", "zFRAEXC"="Fraxinus \nexcelsior")) +
ylab("Number of false springs") + #coord_cartesian(ylim=c(0, 33)) +
#geom_hline(yintercept=7.66, linetype="dotted", col="black") +
#annotate("text", x = 5.75, y = 245, label = "Before 1984", family="Helvetica", size=3, fontface="bold") +
scale_alpha_manual(name="Climate Change", values=c(0.2, 0.7),
labels=c("0"="1951-1983", "1"="1984-2016")) +
geom_point(aes(x=as.factor(species), alpha=as.factor(cc), y=est, group=cc,
col=as.factor(cc)),
position = position_dodge(width=0.75), size=1) +
geom_linerange(aes(x=as.factor(species), alpha=as.factor(cc), ymin=lower, ymax=upper, group=cc,
col=as.factor(cc)), position = position_dodge(width=0.75)) +
ggtitle("(c)") +
guides(alpha=guide_legend(override.aes=list(fill=hcl(c(15,195),100,0,alpha=c(0.2,0.7)))), col=FALSE, fill=FALSE)
falsespring
load("~/Documents/git/regionalrisk/fstotmodlongtest.Rdata")
#load("~/Documents/git/regionalrisk/fstotmod.Rdata")
#fsccsp<- ggpredict(fstot.mod, terms = c("cc", "species"), ci.lvl=0.98)
fsccsp<- ggpredict(fstotlongtest.mod, terms = c("cc", "species"), ci.lvl=0.98)
fsccsp$group <- as.character(fsccsp$group)
fsccsp$species <- NA
fsccsp$species<-ifelse(fsccsp$group=="BETPEN", "aaBETPEN", as.character(fsccsp$group))
fsccsp$species<-ifelse(fsccsp$group=="FRAEXC", "zFRAEXC", fsccsp$species)
falsespring<- ggplot(plusf, aes(x=species,alpha=cc, y=fstot)) + geom_boxplot(aes(alpha=as.factor(cc), fill=as.factor(species), col=as.factor(species)), outlier.shape=NA) +
scale_fill_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
scale_color_manual(name="Species", values=c("grey48","black", cols),
labels=c("0"="1951-1983", "1"="1984-2016",
"aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
theme(legend.text=element_text(size=7), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="Helvetica"),
plot.title = element_text(face="bold", size=10),
legend.text.align = 0, axis.text.x = element_text(face = "italic", angle=35, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white"), legend.position = "none",
plot.margin = unit(c(1.5,1.5, 1.0, 1.5), "lines"),
axis.title.x = element_blank()) +
#axis.text.x.bottom = element_blank(), axis.ticks.x = element_blank()) + # top, right, bottom, left
scale_y_continuous(expand = c(0, 0)) +
scale_x_discrete(labels=c("aaBETPEN" = "Betula pendula", "AESHIP" = "Aesculus \nhippocastanum",
"ALNGLU" = "Alnus glutinosa", "FAGSYL"="Fagus sylvatica",
"QUEROB"="Quercus robur", "zFRAEXC"="Fraxinus \nexcelsior")) +
ylab("Number of false springs") + #coord_cartesian(ylim=c(0, 33)) +
#geom_hline(yintercept=7.66, linetype="dotted", col="black") +
#annotate("text", x = 5.75, y = 245, label = "Before 1984", family="Helvetica", size=3, fontface="bold") +
scale_alpha_manual(name="Climate Change", values=c(0.2, 0.7),
labels=c("0"="1951-1983", "1"="1984-2016")) +
geom_point(aes(x=as.factor(species), alpha=as.factor(cc), y=est, group=cc,
col=as.factor(cc)),
position = position_dodge(width=0.75), size=1) +
geom_linerange(aes(x=as.factor(species), alpha=as.factor(cc), ymin=lower, ymax=upper, group=cc,
col=as.factor(cc)), position = position_dodge(width=0.75)) +
ggtitle("(c)") +
guides(alpha=guide_legend(override.aes=list(fill=hcl(c(15,195),100,0,alpha=c(0.2,0.7)))), col=FALSE, fill=FALSE)
falsespring
# Setting working directory
setwd("~/Documents/git/regionalrisk/analyses/")
############################################
## housekeeping
rm(list=ls())
options(stringsAsFactors = FALSE)
library(ggplot2)
library(dplyr)
library(tidyr)
library(egg)
library(RColorBrewer)
library(viridis)
library(ggeffects)
# Setting working directory
setwd("~/Documents/git/regionalrisk/analyses/")
load("~/Documents/git/regionalrisk/fstotmodlongtest.Rdata")
#load("~/Documents/git/regionalrisk/fstotmod.Rdata")
#fsccsp<- ggpredict(fstot.mod, terms = c("cc", "species"), ci.lvl=0.98)
fsccsp<- ggpredict(fstotlongtest.mod, terms = c("cc", "species"), ci.lvl=0.98)
fsccsp$group <- as.character(fsccsp$group)
fsccsp$species <- NA
fsccsp$species<-ifelse(fsccsp$group=="BETPEN", "aaBETPEN", as.character(fsccsp$group))
fsccsp$species<-ifelse(fsccsp$group=="FRAEXC", "zFRAEXC", fsccsp$species)
f<-read.csv("output/fs_newspace_long.csv", header=TRUE)
#f$cc<-ifelse(f$year<1980, 0, 1)
f$species<-ifelse(f$species=="BETPEN", "aaBETPEN", f$species)
f$species<-ifelse(f$species=="FRAEXC", "zFRAEXC", f$species)
f<-f[!is.na(f$fs),]
f$fstot<-ave(f$fs, f$lat.long, f$species, f$cc, FUN=sum)
f.sub <- subset(f, select=c("fstot", "species", "cc", "lat.long"))
f.sub <- f.sub[!duplicated(f.sub),]
fsccsp$est.conv <-  (fsccsp$predicted/4)/(2)
fsccsp$low.conv <-  (fsccsp$conf.low/4)/(2)
fsccsp$up.conv <-  (fsccsp$conf.high/4)/(2)
fsccsp$x <- ifelse(fsccsp$x<=0, 0, 1)
fsccsp<-subset(fsccsp, select=c("x", "predicted", "conf.low", "conf.high","species", "est.conv", "low.conv", "up.conv")) #
colnames(fsccsp) <- c("cc", "est", "lower", "upper",  "species","est.conv", "low.conv", "up.conv") # ,
plusf<-subset(f.sub, select=c(species, cc, fstot))
plusf<-plusf[!duplicated(plusf),]
plusf <- full_join(plusf, fsccsp)
cols <-viridis_pal(option="viridis")(6)
falsespring<- ggplot(plusf, aes(x=species,alpha=cc, y=fstot)) + geom_boxplot(aes(alpha=as.factor(cc), fill=as.factor(species), col=as.factor(species)), outlier.shape=NA) +
scale_fill_manual(name="Species", values=cols,
labels=c("aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
scale_color_manual(name="Species", values=c("grey48","black", cols),
labels=c("0"="1951-1983", "1"="1984-2016",
"aaBETPEN"=expression(paste(italic("Betula pendula"))),
"AESHIP"=expression(paste(italic("Aesculus hippocastanum"))),
"ALNGLU"=expression(paste(italic("Alnus glutinosa"))),
"FAGSYL"=expression(paste(italic("Fagus sylvatica"))),
"QUEROB"=expression(paste(italic("Quercus robur"))),
"zFRAEXC"=expression(paste(italic("Fraxinus excelsior"))))) +
theme(legend.text=element_text(size=7), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="Helvetica"),
plot.title = element_text(face="bold", size=10),
legend.text.align = 0, axis.text.x = element_text(face = "italic", angle=35, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white"), legend.position = "none",
plot.margin = unit(c(1.5,1.5, 1.0, 1.5), "lines"),
axis.title.x = element_blank()) +
#axis.text.x.bottom = element_blank(), axis.ticks.x = element_blank()) + # top, right, bottom, left
scale_y_continuous(expand = c(0, 0)) +
scale_x_discrete(labels=c("aaBETPEN" = "Betula pendula", "AESHIP" = "Aesculus \nhippocastanum",
"ALNGLU" = "Alnus glutinosa", "FAGSYL"="Fagus sylvatica",
"QUEROB"="Quercus robur", "zFRAEXC"="Fraxinus \nexcelsior")) +
ylab("Number of false springs") + #coord_cartesian(ylim=c(0, 33)) +
#geom_hline(yintercept=7.66, linetype="dotted", col="black") +
#annotate("text", x = 5.75, y = 245, label = "Before 1984", family="Helvetica", size=3, fontface="bold") +
scale_alpha_manual(name="Climate Change", values=c(0.2, 0.7),
labels=c("0"="1951-1983", "1"="1984-2016")) +
geom_point(aes(x=as.factor(species), alpha=as.factor(cc), y=est, group=cc,
col=as.factor(cc)),
position = position_dodge(width=0.75), size=1) +
geom_linerange(aes(x=as.factor(species), alpha=as.factor(cc), ymin=lower, ymax=upper, group=cc,
col=as.factor(cc)), position = position_dodge(width=0.75)) +
ggtitle("(c)") +
guides(alpha=guide_legend(override.aes=list(fill=hcl(c(15,195),100,0,alpha=c(0.2,0.7)))), col=FALSE, fill=FALSE)
falsespring
########################
#### get the data
mat<-read.csv("output/BBdata.csv", header=TRUE) #### mean day of budburst is 104.88
bbdata$cc <- ifelse(bbdata$year<=1983, 0, 1)
bbdata$lat.long <- paste(bbdata$lat, bbdata$long)
bbdata.sub <- subset(bbdata, select=c("bb", "cc", "species"))
bbdata.sub <- bbdata.sub[!duplicated(bbdata.sub),]
bbdata <- mat
load("~/Documents/git/regionalrisk/bbmodsub.Rdata")
bbdata$cc <- ifelse(bbdata$year<=1983, 0, 1)
bbdata$lat.long <- paste(bbdata$lat, bbdata$long)
bbdata.sub <- subset(bbdata, select=c("bb", "cc", "species"))
bbdata.sub <- bbdata.sub[!duplicated(bbdata.sub),]
bbsub.mod <- brm(bb ~ cc + species + cc:species, data=bbdata.sub, control=list(max_treedepth = 15,adapt_delta = 0.99),
iter=4000, warmup = 2500, chains=4, cores=4)
require(brms)
bbsub.mod <- brm(bb ~ cc + species + cc:species, data=bbdata.sub, control=list(max_treedepth = 15,adapt_delta = 0.99),
iter=4000, warmup = 2500, chains=4, cores=4)
save(bbsub.mod, file="~/Documents/git/regionalrisk/bbmodsub.Rdata")
tmin <- read.csv("~/Documents/git/regionalrisk/analyses/output/tminprep_boxplots_long.csv")
#tmin <- read.csv("~/Documents/git/regionalrisk/analyses/output/tminprep_boxplots_long.csv")
tmin$cc <- ifelse(tmin$year<=1983, 0, 1)
tmin$lat.long <- paste(tmin$lat, tmin$long)
tmin.sub <- subset(tmin, select=c("cc", "Tmin", "species"))
tmin.sub <- tmin.sub[!duplicated(tmin.sub),]
tminlongsub.mod<- brm(Tmin ~ cc + species + cc:species, data=tmin, control=list(max_treedepth = 15,adapt_delta = 0.99),
iter=4000, warmup = 2500, chains=4, cores=4)
