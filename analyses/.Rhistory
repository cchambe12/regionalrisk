rename(long=x)%>%
rename(lat=y)%>%
rename(date=variable)%>%
rename(Tmin=value)
dx$date<-substr(dx$date, 2,11)
View(dx)
dx$date<-as.Date(substr(dx$date, 2,11))
dx$date<-as.Date(dx$date)
dx$year<-as.numeric(substr(dx$date, 0,4))
dx$month<-as.numeric(substr(dx$date, 6, 7))
dx$day<-as.numeric(substr(dx$date, 9,10))
View(dx)
dx$date<-as.Date(paste(dx$year, dx$month, dx$day, sep="-"))
View(dx)
write.csv(dx, file="~/Documents/git/regionalrisk/analyses/output/clim.test.csv", row.names = FALSE)
d<-full_join(dx, bb)
View(bb)
dx$bbch<-NA
bb<-bb%>%dplyr::rename("lat" = LAT)%>%dplyr::rename("long"=LON)
x<-paste(bb$YEAR, bb$DAY)
bb$date<-as.Date(strptime(x, format="%Y %j"))
bb$year<-as.numeric(substr(bb$date, 0,4))
bb$month<-as.numeric(substr(bb$date, 6, 7))
bb$day<-as.numeric(substr(bb$date, 9,10))
bb<-bb%>%dplyr::select(-National_ID, -YEAR)
d<-full_join(dx, bb)
View(d)
bx<-read.csv("output/bbch_region_aesculus.csv", header=TRUE)
bx<-filter(bb, YEAR==1950)
bx<-filter(bx, YEAR==1950)
bx<-bx%>%dplyr::rename("lat" = LAT)%>%dplyr::rename("long"=LON)
x<-paste(bx$YEAR, bx$DAY)
bx$date<-as.Date(strptime(x, format="%Y %j"))
bx$year<-as.numeric(substr(bx$date, 0,4))
bx$month<-as.numeric(substr(bx$date, 6, 7))
bx$day<-as.numeric(substr(bx$date, 9,10))
bx<-bx%>%dplyr::select(-National_ID, -YEAR)
d<-full_join(dx, bx)
View(d)
for(i in c(1:nrow(dx))) {
for(j in c(1:nrow(bx)))
dx$bbch[i]<-ifelse(dx$date[i] == bx$date[j] & dx$lat[i]==bx$lat[j] &
dx$long[i]==bx$long[j], bx$BBCH, 0)
print(paste(i,j))
}
bx<-bx%>%dplyr::select(lat, long, date, BBCH)
d<-left_join(dx, bx)
View(d)
dx$bbch<-NA
bx<-read.csv("output/bbch_region_aesculus.csv", header=TRUE)
bx<-bx%>%dplyr::rename("lat" = LAT)%>%dplyr::rename("long"=LON)
x<-paste(bx$YEAR, bx$DAY)
bx$date<-as.Date(strptime(x, format="%Y %j"))
bx$year<-as.numeric(substr(bx$date, 0,4))
bx$month<-as.numeric(substr(bx$date, 6, 7))
bx$day<-as.numeric(substr(bx$date, 9,10))
bx<-bx%>%dplyr::select(lat, long, date, BBCH)
d<-left_join(dx, bx)
View(d)
d$bbch<-tapply(d$date, list(d$bbch, d$lat, d$long), min)
d$bbch<-tapply(d$date, d$lat, d$long, list(d$bbch), min)
d$bbch<-tapply(d$date, list(d$bbch), min)
d$bbch<-tapply(d$date, list(d$BBCH), min)
prov<-unique(c(dx$lat, dx$long))
prov
prov<-unique(paste(d$lat, d$long))
prov
yrs<-unique(d$year)
for(i in c(1:nrow(d))){
for(j in yrs)
d$bud[i]<-tapply(c(d$date[j], prov),list(d$BBCH),min)
#clim$leaf[i]<-tapply(clim$date[j],list(clim$bbch),max)
print(paste(i,j))
}
d$bud[i]<-tapply(c(d$date[j], prov),list(d$BBCH),min)
for(i in c(1:nrow(d))){
for(j in yrs)
d$bud[i]<-tapply(prov,list(d$BBCH),min)
#clim$leaf[i]<-tapply(clim$date[j],list(clim$bbch),max)
print(paste(i,j))
}
for(i in prov){
for(j in yrs)
d$bud[i]<-tapply(d$date,list(d$BBCH),min)
#clim$leaf[i]<-tapply(clim$date[j],list(clim$bbch),max)
print(paste(i,j))
}
for(i in prov){
for(j in yrs)
d$bud[i]<-tapply(d$date[i],list(d$BBCH[i]),min)
#clim$leaf[i]<-tapply(clim$date[j],list(clim$bbch),max)
print(paste(i,j))
}
d$bud[i]<-tapply(d$date[i],list(d$BBCH),min)
for(i in prov){
for(j in yrs)
d$bud[i]<-tapply(d$BBCH,list(d$date),min)
#clim$leaf[i]<-tapply(clim$date[j],list(clim$bbch),max)
print(paste(i,j))
}
View(d)
d<-left_join(dx, bx)
View(d)
d<-within(d, bbch <-sum(BBCH, prov))
View(d)
for(i in prov){
for(j in yrs)
d$bud[i]<-tapply(d$date,list(d$BBCH),min)
#clim$leaf[i]<-tapply(clim$date[j],list(clim$bbch),max)
print(paste(i,j))
}
d$bud<-tapply(d$date, list(d$BBCH), min)
d$bud<-tapply(d$prov, list(d$BBCH), min)
d$prov<-paste(d$lat, d$long)
t.first <- d[match(unique(d$prov), d$date),]
View(t.first)
d <- d[order(d$prov, d$year), ]
View(d)
highest<-by(d, d$prov, d$year, tail, n=1)
highest<-by(d, d$prov, d$year, tail, max)
highest<-by(d, d$prov, d$year, tail, FUN=max)
test<-mutate(d, bbch = lag(BBCH) + bbch)
View(test)
d<-left_join(dx, bx)
d$prov<-paste(d$lat, d$long)
d <- d[order(d$prov, d$year), ]
d$bbch<-0
test<-mutate(d, bbch = lag(BBCH) + bbch)
View(test)
dx$bbch<-0
d<-left_join(dx, bx)
View(d)
d$grow<-ifelse(is.na(d$BBCH), NA, TRUE)
d$count <- ave(
d$grow, d$PEP_ID, d$year,
FUN=function(x) cumsum(c(1, head(x, -1)))
)
d$count <- ave(
d$grow, d$prov, d$year,
FUN=function(x) cumsum(c(1, head(x, -1)))
)
View(d)
d$count <- ave(
d$grow, d$prov, d$year,
FUN=function(x) cumsum(c(1, head(x, -1)))
)
bx<-read.csv("output/bbch_region_aesculus.csv", header=TRUE)
bx<-bx%>%dplyr::rename("lat" = LAT)%>%dplyr::rename("long"=LON)
x<-paste(bx$YEAR, bx$DAY)
bx$date<-as.Date(strptime(x, format="%Y %j"))
bx$year<-as.numeric(substr(bx$date, 0,4))
bx$month<-as.numeric(substr(bx$date, 6, 7))
bx$day<-as.numeric(substr(bx$date, 9,10))
bx<-bx%>%dplyr::select(lat, long, date, BBCH, PEP_ID)
d<-left_join(dx, bx)
d <- d[order(d$PEP_ID, d$year), ]
d$grow<-ifelse(is.na(d$BBCH), NA, TRUE)
d$count <- ave(
d$grow, d$PEP_ID, d$year,
FUN=function(x) cumsum(c(1, head(x, -1)))
)
View(d)
d$count<-ifelse(d$count==1, "start", d$count)
d$bud<-tapply(d$date,list(d$count),min)
d$count <- ave(
d$grow, d$PEP_ID, d$year,
FUN=function(x) cumsum(c(1, head(x, -1)))
)
test<-summarize(d, bud = min(count, PEP_ID, year, na.rm = T))
View(test)
d$bud<-by(d, c(d$PEP_ID, d$year), function(x) x[which.min(x$count), ] )
View(d)
d$bud<-by(d, c(d$PEP_ID, d$year), function(x) x[which.min(d$count), ] )
d$bud<-d[ , .SD[which.min(count)], by = c(date, PEP_ID)]
View(d)
d$pep_year<-paste(PEP_ID, year)
d$pep_year<-paste(d$PEP_ID, d$year)
d$bud<-d[ , .SD[which.min(count)], by = pep_year]
d$bud<-by(d, d$pep_year, function(x) x[which.min(x$count), ] )
d<-left_join(dx, bx)
d <- d[order(d$PEP_ID, d$year), ]
View(d)
d <- d[order(d$PEP_ID, d$date), ]
View(d)
d <- d[order(d$date), ]
d$prov<-paste(d$lat, d$long)
d <- d[order(d$date, d$prov), ]
View(d)
d <- d[order(d$prov, d$date), ]
View(d)
d$grow<-ifelse(is.na(d$BBCH), NA, TRUE)
d$count <- ave(
d$grow, d$prov, d$year,
FUN=function(x) cumsum(c(1, head(x, -1)))
)
d$count<-ifelse(d$count==1, "start", d$count)
View(d)
d$count <- ave(
d$grow, d$PEP_ID, d$year,
FUN=function(x) cumsum(c(1, head(x, -1)))
)
d$count<-ifelse(d$count==1, "start", d$count)
d$count<-group_by(d$PEP_ID, d$year)%>%ifelse(max(d$count), "end", d$count)
d$count<-group_by(d, PEP_ID, year)%>%ifelse(max(d$count), "end", d$count)
d$count<-group_by(d, PEP_ID, year)%>%ifelse(max(count), "end", count)
d$count<-group_by(d, PEP_ID, year)%>%ifelse(max, "end", count)
d$count<-group_by(d, PEP_ID, year)%>%ifelse(last(d$count), "end", d$count)
d$count<-ifelse(max(d$count), "end", d$count)
plz<-d
plz$pepyear<-paste(plz$PEP_ID, plz$year, sep=",")
plz$pepBB<-paste(plz$pepyear, plz$BBCH, sep=",")
test<-plz
#test<- within(test, count[test$count==2]<-2)
tt<-test%>%
filter(count!="start") %>%
group_by(pepBB) %>%
filter(date==max(date))
tt$count<-as.numeric(as.character(tt$count))
tt<-tt[!duplicated(tt), ]
tt$count<-ifelse(tt$count=="start", "start", 2)
tt<-within(tt, count[tt$count==2]<-"end")
dat <- merge(plz, tt, by = "pepBB", all.x = TRUE)
dat$count.x[which(dat$count.x==2 & dat$count.y=="end")]<-"end"
plz<-d
plz$pepyear<-paste(plz$PEP_ID, plz$year, sep=",")
plz$pepBB<-paste(plz$pepyear, plz$BBCH, sep=",")
test<-plz
#test<- within(test, count[test$count==2]<-2)
tt<-test%>%
filter(count!="start") %>%
group_by(pepBB) %>%
filter(date==max(date))
tt$count<-as.numeric(as.character(tt$count))
tt<-tt[!duplicated(tt), ]
tt$count<-ifelse(tt$count=="start", "start", 2)
tt<-within(tt, count[tt$count==2]<-"end")
dat <- merge(plz, tt, by = "pepBB", all.x = TRUE)
dat$count.x[which(dat$count.x==2 & dat$count.y=="end")]<-"end"
dat$count.x[which(dat$count.x=="start" & dat$count.y=="end")]<-"start"
dat.clean<-dat%>%
dplyr::select(pepBB, year.x, Tmin.x, lat.x, long.x, date.x, PEP_ID.x, BBCH.x, DAY.x, species.x, count.x, frz.x, pepyear.x)%>%
rename(year=year.x)%>%
rename(Tmin=Tmin.x)%>%
rename(lat=lat.x)%>%
rename(long=long.x)%>%
rename(date=date.x)%>%
rename(PEP_ID=PEP_ID.x)%>%
rename(BBCH=BBCH.x)%>%
rename(DAY=DAY.x)%>%
rename(species=species.x)%>%
rename(count=count.x)%>%
rename(frz=frz.x)%>%
rename(pepyear=pepyear.x)
plz<-dat.clean
plz$start<-ifelse(plz$count=="start", plz$date, NA)
class(plz$start)<-"Date"
plz$end<-ifelse(plz$count=="end", plz$date, NA)
class(plz$end)<-"Date"
dat.clean<-dat%>%
dplyr::select(pepBB, year.x, Tmin.x, lat.x, long.x, date.x, PEP_ID.x, BBCH.x, DAY.x, species.x, count.x, frz.x, pepyear.x)%>%
rename(year=year.x)%>%
rename(Tmin=Tmin.x)%>%
rename(lat=lat.x)%>%
rename(long=long.x)%>%
rename(date=date.x)%>%
rename(PEP_ID=PEP_ID.x)%>%
rename(BBCH=BBCH.x)%>%
rename(count=count.x)%>%
rename(pepyear=pepyear.x)
dat.clean<-dat%>%
dplyr::select(pepBB, year.x, Tmin.x, lat.x, long.x, date.x, PEP_ID.x, BBCH.x, count.x, pepyear.x)%>%
rename(year=year.x)%>%
rename(Tmin=Tmin.x)%>%
rename(lat=lat.x)%>%
rename(long=long.x)%>%
rename(date=date.x)%>%
rename(PEP_ID=PEP_ID.x)%>%
rename(BBCH=BBCH.x)%>%
rename(count=count.x)%>%
rename(pepyear=pepyear.x)
plz<-dat.clean
plz$start<-ifelse(plz$count=="start", plz$date, NA)
class(plz$start)<-"Date"
plz$end<-ifelse(plz$count=="end", plz$date, NA)
class(plz$end)<-"Date"
View(plz)
plz<-d
plz$pepyear<-paste(plz$PEP_ID, plz$year, sep=",")
plz$pepBB<-paste(plz$pepyear, plz$BBCH, sep=",")
test<-plz
tt<-test%>%
filter(count!="start") %>%
group_by(pepBB) %>%
filter(date==max(date))
View(tt)
plz<-d
plz$pepyear<-paste(plz$PEP_ID, plz$year, sep=",")
plz$pepBB<-paste(plz$pepyear, plz$BBCH, sep=",")
test<-plz
tt<-test%>%
filter(count!="start") %>%
group_by(pepBB)
View(test)
dd<-d%>%group_by(prov, year)%>%filter(count==max(count))
View(dd)
d$count <- ave(
d$grow, d$PEP_ID, d$year,
FUN=function(x) cumsum(c(1, head(x, -1)))
)
d$count<-as.numeric(as.character(d$count))
leaf<-d%>%group_by(prov, year)%>%filter(count==max(count))
bud<-d%>%group_by(prov, year)%>%filter(count==min(count))
View(leaf)
d$count<-as.numeric(as.character(d$count))
leaf<-d%>%group_by(prov, year)%>%filter(date==max(count))
leaf<-d%>%group_by(prov, year)%>%summarize(date=max(count))
View(leaf)
leaf<-d%>%group_by(prov, year, date)%>%summarize(count=max(count))
View(leaf)
leaf<-d%>%group_by(prov, year)%>%summarize(count=max(count))
View(leaf)
leaf<-d%>%group_by(prov, year, date)
leaf$end<-summarize(leaf, date=max(count))
leaf<-summarize(leaf, end=date(max(count)))
leaf<-summarize(leaf, end=max(count))
View(leaf)
leaf<-summarize(leaf, end=last(count))
leaf<-d%>%group_by(prov, year, date)
leaf<-summarize(leaf, end=last(count))
leaf<-d%>%group_by(prov, year, date)%>%filter(count==last(count))
View(leaf)
leaf$end<-leaf$date
View(leaf)
leaf<-dplyr::select(leaf, year, date, lat, long, BBCH, end)
ungroup(leaf)
leaf<-dplyr::select(leaf, year, date, lat, long, BBCH, end)
leaf<-ungroup(leaf)
leaf<-dplyr::select(leaf, year, date, lat, long, BBCH, end)
View(leaf)
d.test<-full_join(d, leaf)
View(d.test)
d.test<-full_join(d.test, bud)
View(d.test)
bud<-d%>%group_by(prov, year, date)%>%filter(count==first(count))
bud$start<-bud$date
bud<-ungroup(bud)
bud<-dplyr::select(bud, year, date, lat, long, BBCH, start)
d.test<-full_join(d.test, bud)
d.test$count<-ifelse(d.test$date>=d.test$bud & d.test$date<=d.test$leaf, TRUE, NA)
dxx<-full_join(bud, leaf)
View(dxx)
class(leaf$end)
leaf<-d%>%group_by(prov, year)%>%filter(count==last(count))
leaf$end<-leaf$date
leaf<-ungroup(leaf)
leaf<-dplyr::select(leaf, year, date, lat, long, BBCH, end)
leaf<-d%>%group_by(prov, year)%>%filter(count==last(count))
leaf<-d%>%group_by(prov, year, count)%>%filter(count==last(count))
leaf$end<-leaf$date
leaf<-ungroup(leaf)
leaf$end
leaf<-dplyr::select(leaf, year, date, lat, long, BBCH, end)
bud<-d%>%group_by(prov, year, count)%>%filter(count==first(count))
bud$start<-bud$date
bud<-ungroup(bud)
bud<-dplyr::select(bud, year, date, lat, long, BBCH, start)
dxx<-full_join(bud, leaf)
View(dxx)
leaf<-dplyr::select(leaf, year, date, lat, prov, end)
d$count<-as.numeric(as.character(d$count))
leaf<-d%>%group_by(prov, year, count)%>%filter(count==last(count))
leaf$end<-leaf$date
leaf<-ungroup(leaf)
leaf<-dplyr::select(leaf, year, date, prov, end)
bud<-d%>%group_by(prov, year, count)%>%filter(count==first(count))
bud$start<-bud$date
bud<-ungroup(bud)
bud<-dplyr::select(bud, year, date, lat, long, BBCH, start)
bud<-d%>%group_by(prov, year, count)%>%filter(count==first(count))
bud$start<-bud$date
bud<-ungroup(bud)
bud<-dplyr::select(bud, year, date, prov, start)
View(bud)
leaf<-d%>%group_by(prov, year, count)%>%filter(count==max(count))
leaf$end<-leaf$date
leaf<-ungroup(leaf)
leaf<-dplyr::select(leaf, year, date, prov, end)
bud<-d%>%group_by(prov, year, count)%>%filter(count==min(count))
bud$start<-bud$date
bud<-ungroup(bud)
bud<-dplyr::select(bud, year, date, prov, start)
dxx<-full_join(bud, leaf)
d.test<-full_join(d.test, dxx)
d.test$count<-ifelse(d.test$date>=d.test$bud & d.test$date<=d.test$leaf, TRUE, NA)
d.test$count<-ifelse(d.test$start==d.test$end, TRUE, NA)
d.test$count<-ifelse(d.test$date>=d.test$bud & d.test$date<=d.test$leaf, TRUE, d.test$count)
View(d.test)
dx<-read.csv("output/clim.test.csv", header=TRUE)
bx<-bx%>%dplyr::rename("lat" = LAT)%>%dplyr::rename("long"=LON)
x<-paste(bx$YEAR, bx$DAY)
bx$date<-as.Date(strptime(x, format="%Y %j"))
bx$year<-as.numeric(substr(bx$date, 0,4))
bx$month<-as.numeric(substr(bx$date, 6, 7))
bx$day<-as.numeric(substr(bx$date, 9,10))
bx<-bx%>%dplyr::select(lat, long, date, BBCH, PEP_ID)
d<-left_join(dx, bx)
d$prov<-paste(d$lat, d$long)
d <- d[order(d$prov, d$date), ]
d$grow<-ifelse(is.na(d$BBCH), NA, TRUE)
#d<-arrange(d, date)
d$count <- ave(
d$grow, d$PEP_ID, d$year,
FUN=function(x) cumsum(c(1, head(x, -1)))
)
d$count<-as.numeric(as.character(d$count))
leaf<-d%>%group_by(prov, year, count)%>%filter(count==max(count))
leaf$end<-leaf$date
leaf<-ungroup(leaf)
leaf<-dplyr::select(leaf, year, date, prov, end)
d.test<-full_join(d, leaf)
bud<-d%>%group_by(prov, year, count)%>%filter(count==min(count))
bud$start<-bud$date
bud<-ungroup(bud)
bud<-dplyr::select(bud, year, date, prov, start)
d.test<-full_join(d.test, dxx)
rm(list=ls()) # remove everything currently held in the R memory
options(stringsAsFactors=FALSE)
graphics.off()
setwd("~/Documents/git/regionalrisk/analyses")
bx<-read.csv("output/bbch_region_aesculus.csv", header=TRUE)
dx<-read.csv("output/clim.test.csv", header=TRUE)
bx<-bx%>%dplyr::rename("lat" = LAT)%>%dplyr::rename("long"=LON)
x<-paste(bx$YEAR, bx$DAY)
bx$date<-as.Date(strptime(x, format="%Y %j"))
bx$year<-as.numeric(substr(bx$date, 0,4))
bx$month<-as.numeric(substr(bx$date, 6, 7))
bx$day<-as.numeric(substr(bx$date, 9,10))
bx<-bx%>%dplyr::select(lat, long, date, BBCH, PEP_ID)
d<-left_join(dx, bx)
dx$date<-as.Date(dx$date)
d<-left_join(dx, bx)
d$prov<-paste(d$lat, d$long)
d <- d[order(d$prov, d$date), ]
d$grow<-ifelse(is.na(d$BBCH), NA, TRUE)
d$count <- ave(
d$grow, d$PEP_ID, d$year,
FUN=function(x) cumsum(c(1, head(x, -1)))
)
d$count<-as.numeric(as.character(d$count))
leaf<-d%>%group_by(prov, year, count)%>%filter(count==max(count))
View(leaf)
leaf$end<-leaf$date
leaf<-ungroup(leaf)
leaf<-dplyr::select(leaf, year, date, prov, end)
d.test<-full_join(d, leaf)
bud<-d%>%group_by(prov, year, count)%>%filter(count==min(count))
bud$start<-bud$date
bud<-ungroup(bud)
bud<-dplyr::select(bud, year, date, prov, start)
d.test<-full_join(d.test, dxx)
d.test<-full_join(d.test, bud)
View(d.test)
d.test$count<-ifelse(d.test$start==d.test$end, TRUE, NA)
d.test$count<-ifelse(d.test$date>=d.test$bud & d.test$date<=d.test$leaf, TRUE, d.test$count)
d.test$count<-ifelse(d.test$start==d.test$end, TRUE, FALSE)
d.test$count<-ifelse(d.test$date>=d.test$bud & d.test$date<=d.test$leaf, TRUE, d.test$count)
for(i in (1:nrow(d.test))){
d.test$count[i]<-ifelse(d.test$date[i]>=d.test$bud & d.test$date[i]<=d.test$leaf, TRUE, d.test[i]$count)
}
for(i in c(1:nrow(d.test))){
d.test$count[i]<-ifelse(d.test$date[i]>=d.test$bud & d.test$date[i]<=d.test$leaf, TRUE, d.test[i]$count)
}
leaf<-d%>%group_by(prov, year, count)%>%summarize(end==max(count))
leaf<-d%>%group_by(prov, year, count)%>%summarize(end=max(count))
leaf<-d%>%group_by(prov, year, count)%>%summarize(count=last(count))
leaf<-d%>%group_by(prov, year, count)%>%summarize(last(count))
leaf$end<-leaf$date
View(leaf)
leaf<-d%>%group_by(prov, year, count)%>%summarize(end=last(count))
leaf<-d%>%group_by(prov, year, count)%>%summarize_each(end=last(count))
leaf<-d%>%group_by(prov, year, count)%>%filter(end=last(count))
leaf<-d%>%group_by(prov, year, count)%>%filter(end==last(count))
leaf<-d%>%group_by(prov, year, date, count)%>%summarize(end=last(count))
leaf$end<-leaf$date
leaf<-ungroup(leaf)
leaf<-dplyr::select(leaf, year, date, prov, end)
d.test<-full_join(d, leaf)
View(leaf)
leaf<-d%>%group_by(prov, year, count)%>%summarize(end=last(count))
leaf$end<-leaf$date
leaf<-ungroup(leaf)
d.test<-full_join(d, leaf)
View(d.test)
leaf<-d%>%group_by(prov, year, count)%>%leaf[which(summarize(end=last(count))),]
leaf<-d%>%group_by(prov, year, count)
leaf<-leaf[which(summarize(end=last(count))),]
leaf<-leaf[which(count, FUN=last),]
leaf<-leaf[which(count, FUN=max),]
leaf<-leaf[which(max(count)),]
leaf<-leaf[which(max(leaf$count)),]
leaf<-leaf[within(max(leaf$count)),]
leaf<-leaf[max(leaf$count),]
leaf$prov.year<-paste(prov, year)
leaf$prov.year<-paste(leaf$prov, leaf$year)
leaf<-leaf$prov.year[max(leaf$count),]
leaf<-leaf$prov.year[max(leaf$count)]
leaf$end<-leaf[which(max(leaf$count), by=leaf$prov.year),]
leaf$end<-leaf[which(max(leaf$count, by=leaf$prov.year)),]
leaf$end<-leaf[which(max(leaf$count,leaf$prov.year)),]
leaf$end<-leaf[max(leaf$count,leaf$prov.year)),]
leaf$end<-leaf[max(leaf$count,leaf$prov.year),]
leaf$end<-leaf[max(count,prov.year),]
