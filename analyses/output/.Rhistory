simple$Jvar<-ifelse(simple$var=="speciesBETPEN:sp.temp", 8.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFAGSYL:sp.temp", 8.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFRAEXC:sp.temp", 8.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesQUEROB:sp.temp", 8.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="sm.elev", 8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesALNGLU:sm.elev", 7.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesBETPEN:sm.elev", 7.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFAGSYL:sm.elev", 7.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFRAEXC:sm.elev", 7.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesQUEROB:sm.elev", 7.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="space", 7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesALNGLU:space", 6.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesBETPEN:space", 6.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFAGSYL:space", 6.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFRAEXC:space", 6.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesQUEROB:space", 6.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="cc", 6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesALNGLU:cc", 5.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesBETPEN:cc", 5.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFAGSYL:cc", 5.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFRAEXC:cc", 5.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesQUEROB:cc", 5.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="(Intercept)", 5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesALNGLU", 5.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesBETPEN", 5.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFAGSYL", 5.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFRAEXC", 5.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesQUEROB", 5.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:cc", 4, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="sp.temp:cc", 3, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="sm.elev:cc", 2, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="space:cc", 1, simple$Jvar)
cols <- colorRampPalette(brewer.pal(7,"Accent"))(7)
estimates<-c("NAO Index", "Mean Spring Temperature", "Elevation", "Space Parameter", "Species",
"NAO Index x \nClimate Change", "Mean Spring Temperature \nx Climate Change",
"Elevation x \nClimate Chnage", "Space Parameter \nx Climate Change")
estimates<-rev(estimates)
expB<-ggplot(simple, aes(x=`2.5%`, xend=`97.5%`, y=Jvar, yend=Jvar, col=as.factor(species))) +
geom_vline(xintercept=0, linetype="dotted") + geom_point(aes(x=mean, y=Jvar, col=as.factor(species))) +
scale_colour_manual(name="Species", values=cols,
labels=c("1"=expression(paste(italic("Aesculus hippocastanum"))),
"2"=expression(paste(italic("Alnus glutinosa"))),
"3"=expression(paste(italic("Betula lenta"))),
"4"=expression(paste(italic("Fagus sylvatica"))),
"5"=expression(paste(italic("Fraxinus excelsior"))),
"6"=expression(paste(italic("Quercus robur"))),
"0"="Interactive Effect"))+
geom_segment(arrow = arrow(length = unit(0.00, "npc"))) +
scale_y_discrete(limits = sort(unique(simple$var)), labels=estimates) +
xlab("Change in Number of False Springs") + ylab("") +
theme(legend.text=element_text(size=5), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="sans"), legend.position = c(0.85,0.15),
legend.text.align = 0) #+ coord_cartesian(ylim=c(1,5), xlim=c(-20, 10))
quartz()
expB
plotting <- as.data.frame(summary(post.inter)$summary)
simple<-plotting
simple$var<- rownames(simple)
rownames(simple)<-1:45
simple<-simple[2:40,]
simple<-simple[!(simple$var=="speciesALNGLU"|simple$var=="speciesBETPEN"|simple$var=="speciesFAGSYL"|
simple$var=="speciesFRAEXC"|simple$var=="QUEROB"),]
simple<-subset(simple, select=c("var", "mean", "2.5%", "97.5%"))
simple$species<-c(1,1,1,1,1,1,2,3,4,5,6,2,3,4,5,6,2,3,4,5,6,2,3,4,5,6,2,3,4,5,6,2,3,4,5,6,0,0,0,0)
simple$Jvar<-NA
simple$Jvar<-ifelse(simple$var=="m.index", 9, simple$Jvar)
simple<-plotting
simple$var<- rownames(simple)
rownames(simple)<-1:45
simple<-simple[2:40,]
simple<-simple[!(simple$var=="speciesALNGLU"|simple$var=="speciesBETPEN"|simple$var=="speciesFAGSYL"|
simple$var=="speciesFRAEXC"|simple$var=="QUEROB"),]
simple<-subset(simple, select=c("var", "mean", "2.5%", "97.5%"))
simple$species<-c(1,1,1,1,1,6,2,3,4,5,6,2,3,4,5,6,2,3,4,5,6,2,3,4,5,6,2,3,4,5,6,0,0,0,0)
simple$Jvar<-NA
simple$Jvar<-ifelse(simple$var=="m.index", 9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:speciesALNGLU", 8.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:speciesBETPEN", 8.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:speciesFAGSYL", 8.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:speciesFRAEXC", 8.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:speciesQUEROB", 8.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="sp.temp", 8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesALNGLU:sp.temp", 7.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesBETPEN:sp.temp", 7.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFAGSYL:sp.temp", 7.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFRAEXC:sp.temp", 7.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesQUEROB:sp.temp", 7.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="sm.elev", 7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesALNGLU:sm.elev", 6.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesBETPEN:sm.elev", 6.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFAGSYL:sm.elev", 6.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFRAEXC:sm.elev", 6.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesQUEROB:sm.elev", 6.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="space", 6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesALNGLU:space", 5.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesBETPEN:space", 5.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFAGSYL:space", 5.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFRAEXC:space", 5.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesQUEROB:space", 5.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="cc", 5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesALNGLU:cc", 4.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesBETPEN:cc", 4.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFAGSYL:cc", 4.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFRAEXC:cc", 4.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesQUEROB:cc", 4.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:cc", 4, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="sp.temp:cc", 3, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="sm.elev:cc", 2, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="space:cc", 1, simple$Jvar)
cols <- colorRampPalette(brewer.pal(7,"Accent"))(7)
estimates<-c("NAO Index", "Mean Spring Temperature", "Elevation", "Space Parameter", "Species",
"NAO Index x \nClimate Change", "Mean Spring Temperature \nx Climate Change",
"Elevation x \nClimate Chnage", "Space Parameter \nx Climate Change")
estimates<-rev(estimates)
expB<-ggplot(simple, aes(x=`2.5%`, xend=`97.5%`, y=Jvar, yend=Jvar, col=as.factor(species))) +
geom_vline(xintercept=0, linetype="dotted") + geom_point(aes(x=mean, y=Jvar, col=as.factor(species))) +
scale_colour_manual(name="Species", values=cols,
labels=c("1"=expression(paste(italic("Aesculus hippocastanum"))),
"2"=expression(paste(italic("Alnus glutinosa"))),
"3"=expression(paste(italic("Betula lenta"))),
"4"=expression(paste(italic("Fagus sylvatica"))),
"5"=expression(paste(italic("Fraxinus excelsior"))),
"6"=expression(paste(italic("Quercus robur"))),
"0"="Interactive Effect"))+
geom_segment(arrow = arrow(length = unit(0.00, "npc"))) +
scale_y_discrete(limits = sort(unique(simple$var)), labels=estimates) +
xlab("Change in Number of False Springs") + ylab("") +
theme(legend.text=element_text(size=5), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="sans"), legend.position = c(0.85,0.15),
legend.text.align = 0) #+ coord_cartesian(ylim=c(1,5), xlim=c(-20, 10))
expB
simple<-plotting
simple$var<- rownames(simple)
rownames(simple)<-1:45
simple<-simple[2:40,]
simple<-simple[!(simple$var=="speciesALNGLU"|simple$var=="speciesBETPEN"|simple$var=="speciesFAGSYL"|
simple$var=="speciesFRAEXC"|simple$var=="speciesQUEROB"),]
simple<-subset(simple, select=c("var", "mean", "2.5%", "97.5%"))
simple$species<-c(1,1,1,1,1,2,3,4,5,6,2,3,4,5,6,2,3,4,5,6,2,3,4,5,6,2,3,4,5,6,0,0,0,0)
simple$Jvar<-NA
simple$Jvar<-ifelse(simple$var=="m.index", 9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:speciesALNGLU", 8.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:speciesBETPEN", 8.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:speciesFAGSYL", 8.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:speciesFRAEXC", 8.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:speciesQUEROB", 8.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="sp.temp", 8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesALNGLU:sp.temp", 7.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesBETPEN:sp.temp", 7.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFAGSYL:sp.temp", 7.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFRAEXC:sp.temp", 7.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesQUEROB:sp.temp", 7.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="sm.elev", 7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesALNGLU:sm.elev", 6.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesBETPEN:sm.elev", 6.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFAGSYL:sm.elev", 6.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFRAEXC:sm.elev", 6.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesQUEROB:sm.elev", 6.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="space", 6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesALNGLU:space", 5.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesBETPEN:space", 5.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFAGSYL:space", 5.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFRAEXC:space", 5.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesQUEROB:space", 5.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="cc", 5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesALNGLU:cc", 4.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesBETPEN:cc", 4.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFAGSYL:cc", 4.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFRAEXC:cc", 4.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesQUEROB:cc", 4.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:cc", 4, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="sp.temp:cc", 3, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="sm.elev:cc", 2, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="space:cc", 1, simple$Jvar)
cols <- colorRampPalette(brewer.pal(7,"Accent"))(7)
estimates<-c("NAO Index", "Mean Spring Temperature", "Elevation", "Space Parameter", "Species",
"NAO Index x \nClimate Change", "Mean Spring Temperature \nx Climate Change",
"Elevation x \nClimate Chnage", "Space Parameter \nx Climate Change")
estimates<-rev(estimates)
post.inter
load("~/Documents/git/regionalrisk/analyses/output/brm_slopes_fast.Rdata")
library(rstan)
library(rstanarm)
library(sjPlot)
library(sjmisc)
library(RColorBrewer)
library(dplyr)
library(broom)
brms<-as.data.frame(tidy(slopes.fast,robust = TRUE))
View(brms)
load("~/Documents/git/regionalrisk/analyses/scripts/brm_slopes_fast.Rdata")
brms<-as.data.frame(tidy(slopes.fast,robust = TRUE))
View(brms)
brms<-brms[2:46,]
brms$term<-gsub("b_.*","",term$var)
brms$term<-gsub("r_species.*","",term$var)
brms$term<-gsub("b_.*","",brms$term)
brms$term<-gsub("r_species.*","",brms$term)
brms<-as.data.frame(tidy(slopes.fast,robust = TRUE))
brms<-brms[2:46,]
brms$term<-gsub(".*b_","",brms$term)
brms$term<-gsub(".*r_species","",brms$term)
brms<-brms[!(11:16),]
brms<-as.data.frame(tidy(slopes.fast,robust = TRUE))
brms<-brms[2:46,]
brms$term<-gsub(".*b_","",brms$term)
brms$term<-gsub(".*r_species","",brms$term)
brms<-brms[!11:16,]
brms<-as.data.frame(tidy(slopes.fast,robust = TRUE))
brms<-brms[2:46,]
brms$term<-gsub(".*b_","",brms$term)
brms$term<-gsub(".*r_species","",brms$term)
brms<-brms[!(brms$term=="sd_species_m.index" |brms$term=="sd_species_sp.temp") | brms$term=="sd_species_sm.elev"
| brms$term=="sd_species_space" | brms$term=="sd_species_cc"),]
brms<-brms[!(brms$term=="sd_species_m.index" | brms$term=="sd_species_sp.temp" | brms$term=="sd_species_sm.elev"
| brms$term=="sd_species_space" | brms$term=="sd_species_cc"),]
brms<-brms[!(brms$term=="sd_species__m.index" | brms$term=="sd_species__sp.temp" | brms$term=="sd__species_sm.elev"
| brms$term=="sd_species__space" | brms$term=="sd_species__cc" | brms$term=="sigma"),]
brms<-brms[!(brms$term=="sd_species__m.index" | brms$term=="sd_species__sp.temp" | brms$term=="sd__species__sm.elev"
| brms$term=="sd_species__space" | brms$term=="sd_species__cc" | brms$term=="sigma"),]
brms<-brms[!(brms$term=="sd_species__m.index" | brms$term=="sd_species__sp.temp" | brms$term=="sd_species__sm.elev"
| brms$term=="sd_species__space" | brms$term=="sd_species__cc" | brms$term=="sigma"),]
brms$species<-c(0,0,0,0,0,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,0,0,0,0)
brms$species<-c(0,0,0,0,0,0,0,0,0, 1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6)
brms$Jvar<-NA
brms$Jvar<-ifelse(brms$term=="m.index", 9, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[AESHIP,m.index]", 8.9, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[ALNGLU,m.index]", 8.8, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[BETPEN,m.index]", 8.7, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[FAGSYL,m.index]", 8.6, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[FRAEXC,m.index]", 8.5, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[QUEROB,m.index]", 8.4, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="sp.temp", 8, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[AESHIP,sp.temp]", 7.9, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[ALNGLU,sp.temp]", 7.8, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[BETPEN,sp.temp]", 7.7, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[FAGSYL,sp.temp]", 7.6, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[FRAEXC,sp.temp]", 7.5, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[QUEROB,sp.temp]", 7.4, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="sm.elev", 7, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[AESHIP,sm.elev]", 6.9, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[ALNGLU,sm.elev]", 6.8, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[BETPEN,sm.elev]", 6.7, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[FAGSYL,sm.elev]", 6.6, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[FRAEXC,sm.elev]", 6.5, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[QUEROB,sm.elev]", 6.4, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="space", 6, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[AESHIP,space]", 5.9, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[ALNGLU,space]", 5.8, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[BETPEN,space]", 5.7, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[FAGSYL,space]", 5.6, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[FRAEXC,space]", 5.5, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[QUEROB,space]", 5.4, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="cc", 5, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[AESHIP,cc]", 4.9, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[ALNGLU,cc]", 4.8, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[BETPEN,cc]", 4.7, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[FAGSYL,cc]", 4.6, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[FRAEXC,cc]", 4.5, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[QUEROB,cc]", 4.4, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="m.index:cc", 4, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="sp.temp:cc", 3, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="cc:sm.elev", 2, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="cc:space", 1, brms$Jvar)
cols <- colorRampPalette(brewer.pal(9,"Set1"))(7)
estimates<-c("NAO Index", "Mean Spring Temperature", "Elevation", "Space Parameter", "Climate Change",
"NAO Index x \nClimate Change", "Mean Spring Temperature \nx Climate Change",
"Elevation x \nClimate Chnage", "Space Parameter \nx Climate Change")
estimates<-rev(estimates)
regrisk<-ggplot(brms, aes(x=lower, xend=upper, y=Jvar, yend=Jvar, col=as.factor(species))) +
geom_vline(xintercept=0, linetype="dotted") + geom_point(aes(x=estimate, y=Jvar, col=as.factor(species), size=as.factor(species))) +
scale_colour_manual(name="Species", values=cols,
labels=c("1"=expression(paste(italic("Aesculus hippocastanum"))),
"2"=expression(paste(italic("Alnus glutinosa"))),
"3"=expression(paste(italic("Betula lenta"))),
"4"=expression(paste(italic("Fagus sylvatica"))),
"5"=expression(paste(italic("Fraxinus excelsior"))),
"6"=expression(paste(italic("Quercus robur"))),
"0"="Overall Effects"))+
geom_segment(arrow = arrow(length = unit(0.00, "npc"))) +
scale_y_discrete(limits = sort(unique(brms$term)), labels=estimates) +
xlab("Change in Number of False Springs") + ylab("") + theme_linedraw() +
theme(legend.text=element_text(size=5), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="sans"), legend.position = c(0.85,0.25),
legend.text.align = 0) + #+ coord_cartesian(ylim=c(1,5), xlim=c(-20, 10))
scale_size_manual(values=c(3, 1, 1, 1, 1, 1, 1, 1, 1, 1), name="Species",
labels=c("1"=expression(paste(italic("Aesculus hippocastanum"))),
"2"=expression(paste(italic("Alnus glutinosa"))),
"3"=expression(paste(italic("Betula lenta"))),
"4"=expression(paste(italic("Fagus sylvatica"))),
"5"=expression(paste(italic("Fraxinus excelsior"))),
"6"=expression(paste(italic("Quercus robur"))),
"0"="Overall Effects"))
quartz()
regrisk
brms<-as.data.frame(tidy(slopes.fast,robust = TRUE))
load("~/Documents/git/regionalrisk/analyses/scripts/brm_biglm.Rdata")
brm.biglm
rm(list=ls()) # remove everything currently held in the R memory
options(stringsAsFactors=FALSE)
graphics.off()
# Load libraries
library(dplyr)
library(raster)
library(reshape2)
d<-read.csv("~/Documents/git/regionalrisk/analyses/output/regrisk.cleaned.2.csv", header=TRUE)
rm(list=ls()) # remove everything currently held in the R memory
options(stringsAsFactors=FALSE)
graphics.off()
# Load libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(lubridate)
library(ncdf4)
library(raster)
library(reshape2)
library(data.table)
setwd("~/Documents/git/regionalrisk/analyses")
d<-read.csv("output/bbch_region_aesculus.csv", header=TRUE)
### Let's just start with the PEP data and do some cleaning
df<-d%>%
filter(BBCH==11)%>%
filter(YEAR>1950)%>%
dplyr::select(YEAR, DAY, PEP_ID, LAT, LON)%>%
rename(year=YEAR)%>%
rename(lo=DAY)%>%
rename(lat=LAT)%>%
rename(long=LON)
df$bb<-df$lo-12
## Hmm... can we sequence from budburst to leafout to find the number of freezes between?
df<-dplyr::select(df, bb, year, PEP_ID, lat, long, lo)
df$pep.year<-paste(df$year, df$PEP_ID)
dxx<-data_frame()
days.btw<-array()
for(i in length(df$pep.year)){
days.btw[i] <- Map(seq, df$bb[i], df$lo[i], by = 1)
dxx <- data.frame(PEP_ID=df$PEP_ID, year=df$year, lat=df$lat, long=df$long,
pep.year = rep.int(df$pep.year, vapply(days.btw[i], length, 1L)),
doy = do.call(c, days.btw[i]))
}
dxx<-dxx[!duplicated(dxx),]
dxx<-dplyr::select(dxx, -pep.year)
x<-paste(dxx$year, dxx$doy)
dxx$date<-as.Date(strptime(x, format="%Y %j"))
dxx$Date<- as.character(dxx$date)
dtest<-dxx[sample(nrow(dxx), 100, replace=FALSE),]
## Climate Data time...
r<-brick("~/Desktop/tn_0.25deg_reg_v16.0.nc", varname="tn", sep="")
bb<-dtest
bb$lat.long<-paste(bb$lat, bb$long, sep=",")
bb<-bb[!duplicated(bb$lat.long),]
lats <- bb$lat
lons <- bb$long
coords <- data.frame(x=lons,y=lats)
points <- SpatialPoints(coords, proj4string = r@crs)
values <- extract(r,points)
dclim <- cbind.data.frame(coordinates(points),values)
dx<-melt(dclim, id.vars=c("x","y"))
dx<-dx%>%
rename(long=x)%>%
rename(lat=y)%>%
rename(date=variable)%>%
rename(Tmin=value)
dx$date<-substr(dx$date, 2,11)
dx$Date<-gsub("[.]","-", dx$date)
dxx<-dplyr::select(dxx, -date)
dx<-dplyr::select(dx, -date)
dtest<-dplyr::select(dtest, -date)
check<-inner_join(dx, dtest, by=c("Date", "lat", "long"))
View(check)
seelook<-d%>%dplyr::select(lat, long, PEP_ID)
seelook<-df%>%dplyr::select(lat, long, PEP_ID)
seelook<-seelook[!duplicated(seelook),]
View(seelook)
checksee<-check%>%dplyr::select(lat, long, PEP_ID)
checksee<-checksee[!duplicated(checksee),]
library(arsenal)
summary(compare(checksee, seelook))
check<-inner_join(dtest, dx, by=c("Date", "lat", "long"))
View(check)
dtest<-dxx[1:1000,]
View(dtest)
dxx<- dxx[order(dxx$PEP_ID, dxx$year, dxx$doy), ]
dtest<-dxx[1:1000,]
View(dtest)
dtest<-dxx[1:5000,]
bb<-dtest
bb$lat.long<-paste(bb$lat, bb$long, sep=",")
bb<-bb[!duplicated(bb$lat.long),]
lats <- bb$lat
lons <- bb$long
coords <- data.frame(x=lons,y=lats)
points <- SpatialPoints(coords, proj4string = r@crs)
values <- extract(r,points)
dclim <- cbind.data.frame(coordinates(points),values)
dx<-melt(dclim, id.vars=c("x","y"))
dx<-dx%>%
rename(long=x)%>%
rename(lat=y)%>%
rename(date=variable)%>%
rename(Tmin=value)
dx$date<-substr(dx$date, 2,11)
dx$Date<-gsub("[.]","-", dx$date)
dtest<-dplyr::select(dtest, -date)
dx<-dplyr::select(dx, -date)
check<-inner_join(dtest, dx, by=c("Date", "lat", "long"))
View(check)
check<-inner_join(dx, dtest, by=c("Date", "lat", "long"))
View(check)
check<- check[order(check$PEP_ID, check$year, check$doy), ]
View(check)
ah<-check
ah$fs<- ifelse(ah$Tmin<=-2.2, 1, 0)
ah$fs.count<- ave(ah$fs, ah$PEP_ID, ah$year, FUN=sum)
aeship<-ah%>%dplyr::select(lat, long, PEP_ID, fs.count, year)
aeship<-aeship[!duplicated(aeship),]
aeship<-na.omit(aeship)
aeship$species<-"AESHIP"
aeship$fs<-ifelse(aeship$fs.count>=1, 1, 0)
length(unique(aeship$PEP_ID))
fake<-dtest%>%dplyr::select(lat, long, PEP_ID, doy, year)
fake$bb<-ave(fake$doy, fake$PEP_ID, fake$year, FUN=first)
fake<-dtest%>%dplyr::select(lat, long, PEP_ID, bb, year)
fake<-fake%>%dplyr::select(lat, long, PEP_ID, bb, year)
fake<-fake[!duplicated(fake),]
View(aeship)
View(fake)
length(unique(fake$PEP_ID))
length(unique(dtest$PEP_ID))
length(unique(aeship$PEP_ID))
bb<-dxx
bb$lat.long<-paste(bb$lat, bb$long, sep=",")
bb<-bb[!duplicated(bb$lat.long),]
lats <- bb$lat
lons <- bb$long
coords <- data.frame(x=lons,y=lats)
points <- SpatialPoints(coords, proj4string = r@crs)
values <- extract(r,points)
dclim <- cbind.data.frame(coordinates(points),values)
dx<-melt(dclim, id.vars=c("x","y"))
dx<-dx%>%
rename(long=x)%>%
rename(lat=y)%>%
rename(date=variable)%>%
rename(Tmin=value)
dx$date<-substr(dx$date, 2,11)
dx$Date<-gsub("[.]","-", dx$date)
write.csv(dx, file="~/Desktop/tmin_aeship.csv", row.names=FALSE)
dx$Date<-gsub("[.]","-", dx$date)
colnames(dx)
head(dx)
sum(is.na(dx$Date))
sum(is.na(dx$Tmin))
dxx<-dplyr::select(dtest, -date)
dxx<-dplyr::select(dxx, -date)
colnames(dxx)
dx<-dplyr::select(dx, -date)
fake<-dxx%>%dplyr::select(lat, long, PEP_ID, doy, year)
fake$doy<-ave(fake$doy, fake$PEP_ID, fake$year, FUN=first)
fake<-fake[!duplicated(fake),]
fake$lat.long<-paste(fake$lat, fake$long)
length(unique(fake$lat.long))
check<-inner_join(dx, dxx, by=c("Date", "lat", "long"))
check<-check[!duplicated(check),]
check$lat.long<-paste(check$lat, check$long)
length(unique(check$lat.long))
colnames(check)
check$all<-paste(check$lat.long, check$Date)
check<-check[!duplicated(check$all),]
length(unique(check$year))
length(unique(doy))
length(unique(check$doy))
length(unique(check$PEP_ID))
ah<-check
ah$fs<- ifelse(ah$Tmin<=-2.2, 1, 0)
ah<-ah[!duplicated(ah),]
ah$fs.count<- ave(ah$fs, ah$PEP_ID, ah$year, FUN=sum)
aeship<-ah%>%dplyr::select(lat, long, PEP_ID, fs.count, year)
aeship<-aeship[!duplicated(aeship),]
aeship<-na.omit(aeship)
aeship$species<-"AESHIP"
aeship$fs<-ifelse(aeship$fs.count>=1, 1, 0)
ah<-read.csv("aeship_data.csv", header=TRUE)
### Load data
setwd("~/Documents/git/regionalrisk/analyses/output")
ah<-read.csv("aeship_data.csv", header=TRUE)
ah$fs<- ifelse(ah$Tmin<=-2.2, 1, 0)
ah<-ah[!duplicated(ah),]
ah$fs.count<- ave(ah$fs, ah$PEP_ID, ah$year, FUN=sum)
aeship<-ah%>%dplyr::select(lat, long, PEP_ID, fs.count, year)
aeship<-aeship[!duplicated(aeship),]
aeship<-na.omit(aeship)
ah<-read.csv("aeship_data.csv", header=TRUE)
check<-inner_join(dx, dxx, by=c("Date", "lat", "long"))
ah$lat.long<-paste(ah$lat, ah$long)
length(unique(ah$lat.long))
colnames(ah)
please<-inner_join(df, ah, by="lat.long")
df$lat.long<-paste(df$lat, df$long)
please<-inner_join(df, ah, by="lat.long")
head(df)
please<-full_join(df, ah)
df<-dplyr::select(df, lat.long, year)
df<-df[!duplicated(df),]
write.csv(check, file="~/Desktop/aes_gooddata.csv", row.names = FALSE)
